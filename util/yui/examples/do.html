<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>YUI 3.0</title>
<script type="text/javascript" src="../build/yui.js"></script>
<script type="text/javascript" src="../src/js/Do.js"></script>
<script type="text/javascript">


(function() {

var Y = YUI().use('aop', 'dump');

function TestObj(name) {
    if (name) {
        this.name = name;
    }
}

TestObj.prototype.printName = function () {
    Y.log('TestObj ' + this.name + " 'printName' " + Y.lang.dump(Y.array(arguments)));
    return true;
};

function bef(msg, obj, a3) {
    // Y.log(this.name + " before " + msg);
    // Y.log("before " + msg + ", scope: " + obj.testProp);
    //Y.log(arguments.length + ": before " + msg + ", obj: " + Y.lang.dump(obj));
    // Y.log(Y.lang.dump(a3));

    Y.log('bef: ' + Y.lang.dump(Y.array(arguments)));
    // Y.log('bef: ' + Y.lang.dump(arguments));

}

function TestScope(name) {
    this.testProp = name;
}

function alterArgs(msg, obj) {
    var msg = Y.log(msg = "altered args!");
    return ( new Y.Do.AlterArgs(msg, ["newarg"]) );
}

function causeError(msg, obj) {
    var msg = Y.log(msg = "ack!");
    return ( new Y.Do.Error(msg, false) );
}

function aft(msg, ret, obj) {
    // Y.log(this.name + " after " + msg);
    // Y.log("after " + msg + ", scope: " + obj.testProp);
    Y.log('after: ' + Y.lang.dump(Y.array(arguments)));
    // Y.log('after: ' + Y.lang.dump(arguments));
}

function alterReturn(msg, ret, obj) {
    var msg = Y.log(msg = "new return val!");
    return ( new Y.Do.AlterReturn(msg, "altered return") );
}

var t = new TestObj("testobj");
var s = new TestScope("testscope");

// will it work with prototypes?
// Y.Do.before(TestObj.prototype, "printName", bef);

Y.log("\n\nNo error:\n");
Y.Do.before(bef, t, "printName", s, 1, 2, 3);
//Y.before(bef, t, "printName", s);
Y.after(aft, t, "printName", s);
Y.log("-- " + t.printName("testing", "secondarg"));

Y.log("\n\nAlter Args:\n");
Y.before(alterArgs, t, "printName", s);
Y.log("-- " + t.printName("testing"));

Y.log("\n\nAlter Return:\n");
Y.after(alterReturn, t, "printName", s, 1, 2, 3);
Y.log("-- " + t.printName("testing"));

Y.log("\n\nError:\n");
Y.before(causeError, t, "printName", s, 'a', 'b');
// Y.Do.before(causeError, t, "printName", s);
Y.log("-- " + t.printName("testing"));

Y.log("\n");

Y.augment(TestObj, Y.Event.Target);

    // var obj = new Y.Event.Target();
    var obj = new TestObj('ETTest');

    obj.subscribe('foo', function() {
        console.info('foo!');
    });

    // obj.fire('foo');


function bef2(msg, obj, a3) {
    Y.log('bef2: ' + Y.lang.dump(Y.array(arguments)));
    // alert('bef: ' + Y.lang.dump(Y.array(arguments)));
}

obj.before(bef2, "printName", obj, 1, 2, 3);

Y.log("obj.printName-- " + obj.printName("ET Test", "second arg"));



/* Output:

No error:

before testing, scope: testscope
testobj 'printName' testing
after testing, scope: testscope
-- true


Alter Args:

before testing, scope: testscope
altered args!
testobj 'printName' newarg
after newarg, scope: testscope
-- true


Alter Return:

before testing, scope: testscope
altered args!
testobj 'printName' newarg
after newarg, scope: testscope
new return val!
-- altered return


Error:

before testing, scope: testscope
altered args!
ack!
-- false

*/




})();

</script>
<body>

<input id="addButton" type="button" value="Add link" />

</body>

</html>

