<?php 
$title="The Queue Utility";
$section="queue";
$component="Queue Utility";
$highlightSyntax = true;
$releasenotes = true;
include "../inc/header.inc";
?>
<div id="yui-main">
	<div class="yui-b">
		<div class="yui-ge">
			<div class="yui-u first" id="main">
			<!-- main column -->
			
				<h2><?php echo $component;?></h2>
			
				<div id="promo" class="component">
					<p>The Queue Utility allows you create a chain of function callbacks executed via <code>setTimeout</code> that are guaranteed to run in order.  Using this, you can enable progressive incremental rendering of your UI so your users can begin to see and interact with your page while the infrastructure is being built.  Similarly, process intensive operations that will lock up the UI while the JavaScript is being executed can be broken up into chunks, helping to keep your interface responsive.</p>
					<div class="yui-g">
						<div class="yui-u first">
							<div id="jumps">
								<h4>On This Page</h4>
								<ul>
									<li><a href="#start">Getting Started</a></li>
									<li><a href="#using">Using the <?php echo $component;?></a></li>
									<li><a href="#support">Support &amp; Community</a></li>
									<li><a href="#filingbugs">Bug Reports &amp; Feature Requests</a></li>
								</ul>
							</div>
						</div>
						<div class="yui-u">
							<?php include('../inc/quicklinks.inc'); ?>
						</div>
					</div>				
					<div class="clear"></div>
				</div><!-- /promo -->
				
				<h3 id="start">Getting Started</h3>
				
				<h4 id="dependencies">Include Dependencies</h4>
				
				<p>To use the <?php echo $component;?>, include the following source files in your web page with the script tag:</p>
				<textarea name="code" class="HTML" cols="60" rows="1">
<!-- Dependencies -->
<script src="http://yui.yahooapis.com/<?php echo($yuiCurrentVersion);?>/build/yui/yui.js" type="text/javascript"></script>

<!-- Source file -->
<script src="http://yui.yahooapis.com/<?php echo($yuiCurrentVersion);?>/build/queue/queue-min.js" type="text/javascript"></script>
				</textarea>

				<?php include "../inc/include-notice.inc"; ?>
				
				<h3 id="using">Using the <?php echo $component;?></h3>
			
				<p>This section describes how to use the <?php echo $component;?> in further detail.  It contains these subsections:</p>
				<ul class="topspace">
					<li><a href="#basics">The basics of timeout chaining</a>
					<li><a href="#interacting">Interacting with a Queue</a>
                        <ul>
                            <li><a href="#creating">Creating and adding to a Queue</a></li>
                            <li><a href="#stopping">Pausing and stopping a Queue</a></li>
                            <li><a href="#callbacks">About Queue callbacks</a></li>
                            <li><a href="#blocking">Blocking mode for callback execution</a></li>
                        </ul>
                    </li>
                    <li><a href="#events">Exposed events</a></li>
				</ul>
				
				<h4 id="basics">The basics of timeout chaining</h4>

                <p>Timeout chaining addresses the fact that the browser's JavaScript environment does not support <a href="http://en.wikipedia.org/wiki/Thread_(computer_science)">multithreading</a>.  This means lengthy or iterative code execution can cause the page to stop responding until the running JavaScript process completes.  This can be very detrimental to user experience.  In particular, if the blocking process occurs at initial page load, the user might not see anything rendered for a few seconds or see a UI that they can't interact with.</p>

                <p>To alleviate the situation, the function to perform the operation can be written to work in chunks.  Each execution of the function will pick up where the prior execution left off, then if the work isn't yet done, the browser's <code>setTimeout</code> can be used to schedule another execution after a few milliseconds.  The timeouts allow the browser to paint any DOM modifications the code may have made and handle any user interaction such as button clicks.  In code, the basic structure of a timeout chain is:</p>

				<textarea name="code" class="JScript" cols="60" rows="1">
(function () {

    /* do a chunk of the work */

    if (/* process completion check fails */) {
        // Schedule myself for re-execution, picking up where I left off
        setTimeout(arguments.callee,0);
    }
})();
                </textarea>

                <p>When dealing with <code>setTimeout</code>, it is easy to introduce race conditions.  Because all timeouts are scheduled against the same timer and only one can run at a time, when two timeouts are separately scheduled, it is possible for them to execute out of intended order.</p>

                <p><code>Y.Queue</code> builds on the basic chaining model, supporting simple chaining as well as process distribution across multiple functions that need to operate sequentially.  Each callback in the Queue will yield back to the browser after execution without introducing the possibility of a race condition with the other callbacks in the same Queue.</p>

				<h4 id="interacting">Interacting with a Queue</h4>

				<p>Queues manage an array of callbacks that can be either simple function references or <a href="callbacks">objects with specific keys</a>.  When <code>run</code>, each callback function is executed in turn via <code>setTimeout</code>.  When a callback is finished, it is shifted from the array and the next is scheduled to run.  It is possible to modify the Queue at any time by adding new callbacks or even modifying the configuration of existing callbacks.  Modifications can be done while the Queue is running, paused, or stopped, even from within a queued callback.  In addition, Queue instances fire a number of <a href="#events">events</a> as they run to completion.</p>
				
				<h5 id="creating">Creating and adding to a Queue</h5>

				<p><code>Y.Queue</code> can be called as a factory method or constructor.  You can seed the constructor call with any number of callbacks or just <code>add</code> them in after instantiation.  When you've built up your Queue, set it in motion by calling its <code>run</code> method.</p>

				<textarea name="code" class="JScript" cols="60" rows="1">
(function () {

var Y = new YUI().use("queue");

// Called as instance constructor
var q1 = new Y.Queue();
q1.add(myfunc1,myfunc2);
q1.add(myfunc3);
q1.run();

// Called as factory method
var q2 = Y.Queue(myfunc1,myfunc3);
q2.add(myfunc3);
q2.run();

})();
				</textarea>
                
				<h5 id="stopping">Pausing and stopping a Queue</h5>
                <p>Queues can be <code>pause</code>d to wait for an external process to complete, such as an XHR call via <a href="../io/"><code>Y.io</code></a>, or <code>stop</code>ped to terminate execution and flush the Queue.</p>

				<textarea name="code" class="JScript" cols="60" rows="1">
(function () {

var Y = new YUI().use("io","queue","json-parse");

// Use factory style construction, seed with all callbacks, and immediately run
Y.Queue(
    // Schedule all of these to run in order after this JavaScript thread finishes
    MyApp.doSomething,

    // The second callback will pause the Queue and send an XHR for data
    function () {
        var q = this; // for closure protection
        q.pause();

        // Send the asynchronous XHR
        Y.io(MyApp.getDataUri(), { on: {
            success : function (xid,o) {
                try {
                    var data = Y.JSON.parse(o.responseText);
                }
                catch (e) {
                    MyApp.showErrorStatus();
                    q.stop();
                }

                MyApp.processData(data);

                // In the XHR callback, restart the Queue if successful
                q.run();
            },
            failure : function () {
                MyApp.showErrorStatus();
                // Stop the Queue if anything goes wrong
                q.stop();
            }
        }});
    },

    // The third callback will do partial, yielding updates until complete
    {
        fn:    Y.bind(MyApp.updateUI,MyApp),
        until: function () {
            return MyApp.remainingData >= 0;
        }
    },
    MyApp.doSomethingElse).run();

})();
				</textarea>

				<h5 id="callbacks">About Queue callbacks</h5>
                <p>Callbacks can be simple function references or object literals with the following keys:</p>
                <dl>
                    <dt><code>fn</code></dt>
                    <dd><strong>Required</strong>.  The callback function to execute.  Note, if you want this function executed from a particular context, wrap the function using <code>Y.bind(fn, context)</code>.  Default context is the Queue instance.</dd>

                    <dt><code>timeout</code></dt>
                    <dd>Milliseconds between the completion of the previous callback and the initiation of this one.  This seeds the <code>setTimeout</code> call internally.  Default is 0.  Setting this to -1 will cause the callback to be executed in <a href="#blocking">blocking mode</a>.</dd>

                    <dt><code>until</code></dt>
                    <dd>A function returning true or false.  The callback will not be shifted from the Queue until the function returns true.  Use this to break up process intensive operations where calculating the completion criteria is not known up front or evaluating a success metric is non-trivial.</dd>

                    <dt><code>iterations</code></dt>
                    <dd>The number of times to execute the callback before shifting it from the Queue.  Default is 1.  This configuration is incompatible with <code>until</code>.  If both are set, <code>iterations</code> will be ignored.</dd>
                </dl>
				
                <h5 id="blocking">Blocking mode for callback execution</h5>

                <p>The main goal of the <?php echo($component); ?> is to prevent locking up the UI while a process intensive operation executes from start to finish.  However, you can also use the <?php echo($component); ?> to describe an algorithm and allow external configuration to drive how certain steps of that algorithm are executed.  As such, there may be times when you want to execute a couple callbacks serially in the same JavaScript thread, or to set up an iterative callback (using <code>until</code> or <code>iterations</code>) that will either execute via timeouts or all in one go depending upon an externally set configuration option.</p>
                <p>To support this, you can set the <code>timeout</code> configuration of a specific callback to -1, and that callback will be executed in the same thread as the prior callback, and will continue to execute in that same thread until it is completed.</p>
                <p>This is not a recommended setting.  There are few use cases in which it is preferable to incur the overhead of callback queuing when you might just as well execute the callback functions inline in your JavaScript.</p>

				<h4 id="events">Exposed events</h4>
                <table>
                <thead>
                    <tr>
                        <th>Event</th>
                        <th>When</th>
                        <th>Params</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>addCallback</code></td>
                        <td>Callbacks are added to the Queue.</td>
                        <td>Array of callbacks added</td>
                    </tr>
                    <tr>
                        <td><code>beforeCallback</code></td>
                        <td>Before each callback function is executed.</td>
                        <td>Object literal with keys <code>fn</code> and <code>callback</code> containing the function about to be executed and the callback provided to <code>add(callback)</code>.</td>
                    </tr>
                    <tr>
                        <td><code>afterCallback</code></td>
                        <td>After each callback function is executed.</td>
                        <td>Object literal with keys <code>fn</code> and <code>callback</code> containing the function just executed and the callback provided to <code>add(callback)</code>.</td>
                    </tr>
                    <tr>
                        <td><code>shiftCallback</code></td>
                        <td>After a callback is shifted from the Queue.</td>
                        <td>The callback provided to <code>add(callback)</code>.</td>
                    </tr>
                    <tr>
                        <td><code>pause</code></td>
                        <td>After the Queue is paused.</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><code>stop</code></td>
                        <td>After the Queue is stopped.</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><code>complete</code></td>
                        <td>After the last callback is finished executing.  <em>NOT</em> when the Queue is <code>stop</code>ped.</td>
                        <td></td>
                    </tr>
                </tbody>
                </table>
				
<?php # include "../inc/mobileSection.inc";?>
<?php include "../inc/support.inc"; ?>

		</div>
<div class="yui-u sidebar">

	<?php include "../inc/cheatsheet.inc"; ?>
			
			<div id="examples">
<?php include("../inc/examplesNav/".$section.".inc"); ?>
		   </div>
		   
		   	<div id="morereading">
				<h3>More Reading about the YUI <?php echo $component;?>:</h3>
				
				<ul>
					<li><a href="http://informationr.net/ir/12-2/TB0701.html">Artisinal Animation</a>, by Terrence Brooks</li>
				  	<li>From <a href="http://simon.incutio.com/slides/2006/xtech/yui-notes.html#animation">The Yahoo! User Interface Library</a>, by Simon Willison</li>
					<li><a href="http://www.hedgerwow.com/360/mwd/accordion/demo.php?page=1">Accordion Menu made with YUI</a>, by Hedger Wang</li>

			   </ul>
		   </div>
		   
<?php 
$thisURI="http://developer.yahoo.com/yui/<?php echo $section;?>/";
require_once('../inc/badge.inc');
?>
<h3 id="delicious">YUI <?php echo $component;?> on del.icio.us:</h3>
<div class="delicious">
<?php require('../inc/badge-html.inc'); ?>
</div>

		 </div>
      </div>

</div>
</div>

<?php include "../inc/side.inc" ?>
<?php include "../inc/footer.inc" ?>




