<?php 
$title="The Attribute Utility";
$section="attribute";
$component="Attribute Utility";
$highlightSyntax = true;
$releasenotes = true;
include "../inc/header.inc";
?>
<div id="yui-main">
    <div class="yui-b">
        <div class="yui-ge">
            <div class="yui-u first" id="main">
            <!-- main column -->

                <h2><?php echo $component;?></h2>

                <div id="promo" class="component">
                    <p>The Attribute utility allows you to add attributes to any class through an augmentable Attribute interface. The Attribute interface
                       provides <code>get</code> and <code>set</code> methods for attribute access, in addition to supporting Attribute value change events, 
                       allowing you listen for changes in attribute values, and optionally prevent changes from occuring.</p>

                    <p>Attributes added through the Attribute interface can be configured to with custom get, set and validation handlers and can also be specified as 
                    read-only or write-once. It also provides the ability to configure attibutes to protect their stored values, using a deep or shallow clone when returning
                    values through <code>get</code>.</p>

					<div class="yui-g">
						<div class="yui-u first">
							<div id="jumps">
								<h4>On This Page</h4>
								<ul>
									<li><a href="#start">Getting Started</a></li>
									<li><a href="#using">Using the <?php echo $component;?></a>
										<ul class="topspace">
										<li><a href="#augment">Augmenting Your Class With Attribute</a></li>
										<li><a href="#adding">Adding Attributes</a></li>
                                        <li><a href="#configuration">Attribute Configuration Properties</a></li>
										<li><a href="#events">Attribute Change Events</a></li>
										<li><a href="#subattrs">Getting/Setting Sub Attribute Values</a></li>
										</ul></li>
									<li><a href="#support">Support &amp; Community</a></li>
									<li><a href="#filingbugs">Bug Reports &amp; Feature Requests</a></li>
								</ul>
							</div>
						</div>
						<div class="yui-u">
							<?php
							include('../inc/quicklinks.inc');
							?>
						</div>
					</div>
					<div class="clear"></div>
				</div><!-- /promo -->

				<h3 id="start">Getting Started</h3>

				<h4 id="dependencies">Include Dependencies</h4>

				<p>To use the <?php echo $component;?>, include the following source files in your web page with the script tag:</p>
<textarea name="code" class="HTML" cols="60" rows="1">&lt;!-- Dependencies --&gt;
&lt;script src=&quot;http://yui.yahooapis.com/<?php echo($yuiCurrentVersion);?>/build/yui/yui.js&quot; type="text/javascript"&gt;&lt;/script&gt;

&lt;!-- Source file --&gt;
&lt;script src=&quot;http://yui.yahooapis.com/<?php echo($yuiCurrentVersion);?>/build/attribute/attribute-min.js&quot; type="text/javascript"&gt;&lt;/script&gt;
</textarea>

                <?php
                include "../inc/include-notice.inc";
                ?>

                <h4 id="yui">The YUI Instance</h4>

                <p>Once you have the source and dependancy files for Attribute on your page, you can create a new YUI instance (it is recommended you create this in your own 
                sandboxed anonymous function to avoid polluting the global namespace), and populate it with the modules you need. In the case of Attribute,
                you only need to include the "attribute" module as shown below, using YUI's <code>use</code> method:</p>

<textarea name="code" class="JScript" cols="60" rows="1">(function() {
    var Y = YUI().use("attribute");
    ... 
})();
</textarea>

                <p>The call to <code>use</code> will populate the local YUI instance (<code>Y</code>), with the classes which make up Attribute (e.g. Y.Attribute); which you 
                can then augment to any custom classes which you need to add Attribute support to.</p>

                <p>See the <a href="../yui/index.html">YUI Global</a> documentation for more on creating instances of YUI, and the <code>use</code> method.</p>

                <h3 id="using">Using the <?php echo $component;?></h3>

                <p>This section describes how to use the <?php echo $component;?> in further detail.  It contains these subsections:</p>
                <ul class="topspace">
                    <li><a href="#augment">Augmenting Your Class With Attribute</a></li>
                    <li><a href="#adding">Adding Attributes</a></li>
                    <li><a href="#configuration">Attribute Configuration Properties</a></li>
                    <li><a href="#events">Attribute Change Events</a></li>
                    <li><a href="#subattrs">Setting/Getting Sub Attribute Values</a></li>
                </ul>

            <h4 id="apply">Augmenting Your Class With Attribute</h4>

                <p>The Attribute class is designed to be augmented to an existing class (referred to as the 'host' class throughout this document) and adds attribute 
                management support to it. For example, assuming you have a class constructor, <code>MyClass</code>, to which you'd like to add attribute support, 
                you can simply augment your class with Attribute, as shown below:</p>

<textarea name="code" class="JScript" cols="60" rows="1">(function() {
    var Y = YUI().use("attribute");

    function MyClass() {
        ...
    }

    Y.augment(MyClass, Y.Attribute);
})();
</textarea>

                <p>Instances of your class will now have Attribute methods available, which your class can use to add/configure attributes and which users of your
                class can use to get and set attribute values. See the <a href="../api/Attribute.html">Attribute api documentation</a> for a complete list of 
                methods which Attribute will add to your class.</p>

               <h4 id="adding">Adding Attributes</h4>

               <p>Once augmented with Attribute, your class can either use the protected <code>_initAtts</code> method to setup attributes en mass, or use the 
               public <code>addAtt</code> method, to add them individually. <code>_initAtts</code> is tailored towards use by host classes, since in addition
               to being able to initialize multiple attributes in one call, it also accepts an additional name/value hash, which can be used to allow the 
               user to set multiple attribute values when instantiating Attribute driven classes, as shown below:</p>

<textarea name="code" class="JScript" cols="60" rows="1">...
function MyClass(userValues) {
        
    // Use _initAtts, to setup default attributes for
    // your class, and merge in user provided values.

    this._initAtts(MyClass.ATTRIBUTE_CONFIG, userValues);
}

MyClass.ATTRIBUTE_CONFIG = {
    attrA : {
        // ... Configuration for attribute "attrA" ...
    },

    attrB : {
        // ... Configuration for attribute "attrB" ...
    }
};
</textarea>

               <p><strong>NOTE:</strong> The default attribute configuration is not required 
               to be a static property (<code>ATTRIBUTE_CONFIG</code> above) on the host class, 
               but it's a logical place to define it, since we're defining the default set 
               of attributes for this particular class.</p>

               <p>Users of your class, can now pass attribute values into the constructor,
               or set values using the <code>set</code> method as shown below:

<textarea name="code" class="JScript" cols="60" rows="1">// Set attrA during instantiation
var o = new MyClass({
    attrA:5
});

// Set attrB later on
o.set("attrB", "Hello World!");
</textarea>

               <h4 id="configuration">Attribute Configuration Properties</h4>

               <p>Each attribute you add can be configured with the properties listed in the table below (all properties are optional and case-sensitive):</p>

                <table>
                    <caption>Attribute Configuration Properties</caption>
                    <thead>
						<tr>
							<th>Property Name</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</tbody>
					<tbody>
						<tr>
							<td><code>value</code></td>
							<td>Any</td>
							<td>The default value for this attribute</td>
						</tr>
						<tr>
							<td><code>get</code></td>
							<td>Function</td>
							<td>
                                Custom 'get' handler, which is invoked when the user calls Attribute's get method. It can
                                be used to manipulate the stored value returned to the user. The function will be passed 
                                the currently stored value of the attribute as the only argument. If configured, the value 
                                returned by this function, will be the value returned to the user.
                            </td>
						</tr>
						<tr>
							<td><code>set</code></td>
							<td>Function</td>
							<td>
                                Custom 'set' handler, which is invoked when the user calls Attribute's set method. It can
                                be used to manipulate the value which is stored for the attribute. The function will be passed 
                                the value which the user passed to the set method, as the only argument. If configured, the value 
                                returned by this function, will be the value stored as the attribute value.

                                <p>get and set can be used to normalize values on input/output for the user while storing the 
                                value in a format most effective for internal operation.</p>
                            </td>
						</tr>
						<tr>
							<td><code>validator</code></td>
							<td>Function</td>
							<td>
                                Validation function, which if defined, is called after the custom 'set' handler, but before the attribute value is 
                                stored. The validation function is passed the value which the user is trying to set (after any modification by the 
                                'set' handler. If the function returns <code>false</code> the attribute's stored value is not updated. If it returns
                                true, the attribute's stored value is updated.
                            </td>
						</tr>
						<tr>
							<td><code>readOnly</code></td>
							<td>boolean</td>
							<td>
                                Configures the attribute to be read-only. Users will not be able to set the value of the attribute using
                                Attribute's public API.
                            </td>
						</tr>
						<tr>
							<td><code>writeOnce</code></td>
							<td>boolean</td>
							<td>
                                Configures the attribute to be write-once. Users will only be able to set the value of the attribute using
                                Attribute's set method once. Once a value has been set for the attribute, calling set will not change it's value.
                            </td>
                        </tr>
                        <tr>
                            <td><code>clone</code></td>
                            <td>int</td>
                            <td>
                             By default attribute values returned by the get method
                             are not cloned. If you wish to protect stored object
                             values from being changed by reference, you can configure the attribute
                             to clone the value returned by get. The clone property accepts the following
                             values (defined as static constants on the Attribute class):
                             <dl>
                                <dt>Attribute.CLONE.DEEP</dt>
                                <dd>Will result in a deep cloned value being returned
                                (using YUI's clone method). The entire object will be protected, but can 
                                be expensive for complex objects.</dd>

                                <dt>Attribute.CLONE.SHALLOW</dt>
                                <dd>Will result in a shallow cloned value being returned (using YUI's merge method). Only top level
                                properties of the object will be protected.</dd>

                                <dt>Attribute.CLONE.IMMUTABLE</dt>
                                <dd>Will result in a deep cloned value being returned when using the get method. 
                                Additionally users will not be able to set sub values of the attribute using set's sub-attribute 
                                notation (obj.set("x.y.z, 5)). However the value of the attribute can be changed, making it different from a readOnly 
                                attribute.</dd>

                                <dt>Attribute.CLONE.NONE</dt>
                                <dd>
                                    The value will not be cloned, resulting in a reference to the stored value being passed back, 
                                    if the value is an object. This is the default behavior if the attribute is not configured with a clone value.</dd>
                             </dl>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h5 id="howtoconfig">Configuring Attributes</h5>

                <p>The above attribute properties are set using an object literal, which is passed to either <code>_initAtts</code> or <code>addAtt</code> as the 
                configuration argument. For example, expanding on the code snippet above:</p>

<textarea name="code" class="JScript" cols="60" rows="1">this._initAtts( {

    attrA : {
        // Configuration for attribute "attrA"

        value: 5,

        set: function(val) {
            return Math.min(val, 10); 
        },

        validator: function(val) {
            return Y.Lang.isNumber(val);
        }
    },

    attrB : {
        // Configuration for attribute "attrB"
    }

}, userValues);
</textarea>

                <p>Or, if using <code>addAtt</code>:</p>

<textarea name="code" class="JScript" cols="60" rows="1">this.addAtt("attrA", {
    // Configuration for attribute "attrA"

    value: 5,

    set: function(val) {
        return Math.min(val, 10); 
    },

    validator: function(val) {
        return Y.Lang.isNumber(val);
    }
});
</textarea> 

                <h4 id="events">Attribute Change Events</h4>

                <p>The availability of attribute change events are one of the key benefits of using 
                attributes to store state for your objects, instead of regular object properties. 
                Attribute change events are fired whenever <code>set</code> is invoked for an 
                attribute, allowing you to execute code in response to a change in the attribute's 
                value.</p>

                <h5>Listening for Change Events</h5>

                <p>Attribute change events are Custom Events, having the type: "[attributeName]Change", where
                [attributeName] is the name of the attribute which you're monitoring for changes.</p>

                <p>For example, if you were interested in listening for changes to an attribute named 
                "enabled", you would subscribe to events of type "enabledChange".</p>

<textarea name="code" class="JScript" cols="60" rows="1">o.on("enabledChange", function(event) {
    // Do something just before "enabled" is about to be set
});
</textarea>

                <p><em>NOTE:</em> Context and additional arguments for the listener function can either be 
                defined using YUI's <code>bind</code> method, or by passing in the context and 
                additional arguments to the <code>on</code> method.</p>

                <p>Attribute change event listeners can be registered using either the <code>on</code> 
                (as shown above) or <code>after</code> Attribute methods.</p>
 
                <h5>On vs. After</h5>

                <h6>On</h6>

                <p>Listeners registered using the <code>on</code> method, are notifed <strong>before</strong> the stored state of the attribute has been updated. 
                Funtions registered as "on" listeners recieve an <code>Event</code> object as the first argument (actually an
                instance of <a href="../api/Event.Facade.html"><code>Event.Facade</code></a>) which contains information 
                about the attribute being modified.</p>

                <p>Since these listeners are invoked before any state change has occured, they have the ability to
                prevent the change in state from occuring, by invoking <code>event.preventDefault()</code> on 
                the event object passed to them</p>

<textarea name="code" class="JScript" cols="60" rows="1">o.on("enabledChange", function(event) {

    // get, will return the current attribute value
    var currentVal = this.get("enabled");

    if (someCondition) {
        // Prevent "enabled" from being changed
        event.preventDefault();
    }

});
</textarea>

                <h6>After</h6>

                <p>Listeners registered using the <code>after</code> method, are notified <strong>after</strong> 
                the stored state of the attribute has been updated. As with "on" listeners, the subscribed Function 
                receives an <code>Event</code> object as the first parameter.</p>

                <p>Based on the definition above, "after" listeners are not invoked if state change is prevented, 
                for example, by one of the "on" listeners calling <code>preventDefault</code> on the event object</p>

<textarea name="code" class="JScript" cols="60" rows="1">o.after("enabledChange", function(event) {

    // get, will return the updated attribute value
    var updatedVal = this.get("enabled");

    // Calling preventDefault() in an "after" listener has no impact
    event.preventDefault();

});
</textarea>

                <h5>The Event Object</h5>

                <p>The event facade passed to attribute change event listeners, has a number of attributes which provide information about the attribute being modified,
                as well methods used to manage event propagation. These are described below:</p>

                <dl>
                    <dt>newVal</dt>
                    <dd>The value which the attribute will be set to (in the case of "on" listeners), or has been set to (in the case of "after" listeners)</dd>
                    <dt>prevVal</dt>
                    <dd>The value which the attribute is currently set to (in the case of "on" listeners), or was previously set to (in the case of "after" listeners)</dd>
                    <dt>attrName</dt>
                    <dd>The name of the attribute which is being set</dd>
                    <dt>subAttrName</dt>
                    <dd>Attribute also allows you to set individual properties of attributes having values which are objects through the 
                    <code>set</code> method (e.g. <code>o.set("X.a.b", 5)</code>, discussed below). This event property will contain the complete dot notation path for the object property which was changed
                    <p>For example, during <code>o.set("X.a.b", 5);</code>, <code>event.subAttrName</code> will be "X.a.b", the path of the property modified, and <code>event.attrName</code> will be "X", the attribute name.</dd>
                    <dt>preventDefault()<dt>
                    <dd>This method can be called in an "on" listener function to prevent the attribute's value from being updated (the default behavior). Calling this method in an "after" listener has no impact, since the default behavior has already been invoked.</dd>
                    <dt>stopImmediatePropagation()</dt>
                    <dd>This method can be called in "on" or "after" listener functions, and will prevent the rest of the listener stack from
                    being notified, but will not prevent the attribute's value from being updated (viz. will not prevent the default behavior).</dd>
                </dl>

                <h4 id="subattrs">Getting/Setting Sub Attribute Values</h4>

                <p>If you have attribute values which are objects (as opposed to primitive values, such as numbers or booleans), the <code>set</code> method will let
                you set properties of the object directly, using a dot notation syntax. For example, if you have an attribute, "strings" with the following value:</p>

<textarea name="code" class="JScript" cols="60" rows="1">o.set("strings", {
    ui : {
        acccept_label : "OK",
        decline_label : "Cancel",
    },
    errors : {
        e1000 : "Not Supported",
        e1001 : "Network Error"
    }
});
</textarea>
                
                <p>You can set individual properties on the "strings" attribute value object, without having to get and reset the whole strings attribute. This is done
                by using the dot notation to reference properties within the attribute's value:</p>

<textarea name="code" class="JScript" cols="60" rows="1">// Set existing properties
o.set("strings.ui.accept_label", "Yes");
o.set("strings.ui.decline_label", "No");

// Add a new property
o.set("strings.errors.e2000", "New Error");

// Cannot set new intermediate properties:
// "strings.messages" does not exist so can't set
// "strings.messages.intro"
o.set("strings.messages.intro", "Welcome");
</textarea>

                <p>Setting sub attribute values, will fire an attribute change event for the 
                main attribute ("stringsChange" in the above example), however the event object passed
                to the listeners with have a "subAttrName" property set to reflect the full path to the 
                attribute set (e.g. event.subAttrName will be "strings.ui.accept_label" for the first 
                of the above examples).</p>

                <p>You can also retrieve sub attribute values using the same dot notation syntax</p>

<textarea name="code" class="JScript" cols="60" rows="1">// Get the string for the accept label
var lbl = o.get("strings.ui.accept_label");
</textarea>

                <p>It should be noted that get, set and validator attribute configuration functions are 
                only defined for the top level attribute ("string" in this case) and will get invoked 
                when getting/setting sub attribute values</p>

<?php # include "../inc/mobileSection.inc";?>
<?php include "../inc/support.inc"; ?>

		</div>
<div class="yui-u sidebar">

<?php # include "../inc/cheatsheet.inc"; ?>
		 	
			<div id="examples">
<?php include("../inc/examplesNav/".$section.".inc"); ?>
		   </div>
<?php 
$thisURI="http://developer.yahoo.com/yui/<?php echo $section;?>/";
require_once('../inc/badge.inc');
?>
<h3 id="delicious">YUI <?php echo $component;?> on del.icio.us:</h3>
<div class="delicious">
<?php require('../inc/badge-html.inc'); ?>
</div>

		 </div>
      </div>
</div>
</div>

<?php include "../inc/side.inc" ?>
<?php include "../inc/footer.inc" ?>
