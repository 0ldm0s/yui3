<?php 
$title="The JSON Utility";
$section="json";
$component="JSON Utility";
$highlightSyntax = true;
$releasenotes = true;
include "../inc/header.inc";
?>
<div id="yui-main">
	<div class="yui-b">
		<div class="yui-ge">
			<div class="yui-u first" id="main">
			<!-- main column -->
			
				<h2><?php echo $component;?></h2>
			
				<div id="promo" class="component">
  <p>The JSON Utility is a YUI implementation of <a href="http://json.org">Douglas Crockford's work</a> on JSON (JavaScript Object Notation).  JSON is a safe, efficient, and reliable data interchange format.  The JSON Utility provides methods for working with JSON in JavaScript, providing JSON-to-string and string-to-JSON conversion and validation.</p>

					<div class="yui-g">
						<div class="yui-u first">
							<div id="jumps">
								<h4>On This Page</h4>
								<ul>
									<li><a href="#start">Getting Started</a></li>
									<li><a href="#using">Using the <?php echo $component;?></a>
										<ul class="topspace">
                                            <li><a href="#parse">Parsing JSON strings</a></li>
                                            <li><a href="#stringify">Creating JSON strings</a></li>
										</ul>
                                    </li>
									<li><a href="#support">Support &amp; Community</a></li>
									<li><a href="#filingbugs">Bug Reports &amp; Feature Requests</a></li>
								</ul>
							</div>
						</div>
						<div class="yui-u">
							<?php
							include('../inc/quicklinks.inc');
							?>
						</div>
					</div>				
					<div class="clear"></div>
				</div><!-- /promo -->
				
				<?php
                    $componentShort = "JSON";
                    $requiredModules = array("json");
                    include("../inc/gettingStarted.inc");
                ?>
				
				<h3 id="using">Using the <?php echo $component;?></h3>
			
				<p>This section describes how to use the <?php echo $component;?> in further detail.  It contains these subsections:</p>
				<ul class="topspace">
					<li><a href="#modules">JSON modules overview</a></li>
					<li><a href="#parse">Parsing JSON strings into native JavaScript values</a>
                        <ul>
					        <li><a href="#reviver">Using the optional &quot;reviver&quot; parameter</a></li>
					        <li><a href="#avoid_eval">Don't use <code>eval</code></a></li>
                        </ul></li>
					<li><a href="#stringify">Creating JSON strings from JavaScript objects</a>
                        <ul>
                            <li><a href="#whitelist">Using a whitelist</a></li>
                            <li><a href="#replacer">Using a custom &quot;replacer&quot;</a></li>
                            <li><a href="#depth">Limiting object inspection depth</a></li>
                        </ul></li>
				</ul>
				
				<h4 id="modules">JSON modules overview</h4>

                <p>The JSON Utility adds the namespace <code>JSON</code> to your YUI instance.  The utility methods are static, hung off this namespace.</p>
                <p>To minimize the code footprint when some functionality is not required, JSON has been broken up into the following modules:</p>
                <dl>
                    <dt><code>json-parse</code></dt>
                    <dd>Adds <code>Y.JSON.parse(..)</code> method to the YUI instance.  Use this module if all you will be doing is parsing JSON strings.</dd>

                    <dt><code>json-stringify</code></dt>
                    <dd>Adds <code>Y.JSON.stringify(..)</code> method and its supporting methods and properties to the YUI instance.  Use this module if all you will be doing is serializing JavaScript objects to JSON strings.</dd>

                    <dt><code>json</code></dt>
                    <dd>A rollup of <code>json-parse</code> and <code>json-stringify</code> modules.  Use this if you need to both parse JSON strings and serialize objects to JSON strings.</dd>
                </dl>

				<h4 id="parse">Parsing JSON strings into native JavaScript values</h4>

                <p>Provided a string containing data in JSON format, simply pass the string to <code>parse</code> and capture the return value.  You'll need to wrap the call in a <code>try/catch</code> block because invalid JSON will cause <code>parse</code> to throw a JavaScript error.</p>
				<textarea name="code" class="JScript" cols="60" rows="1">
(function () {

var Y = new YUI().use('json-parse');

var jsonString = '{"products":['+
    '{"id":1,"price":.99,"inStock":true,"name":"grapes"},'+
    '{"id":2,"price":3.5,"inStock":false,"name":"passion fruit"},'+
    '{"id":3,"price":2.5,"inStock":true,"name":"bananas"}'+
']}';

// Parsing can throw a SyntaxError exception, so we wrap the call in a try/catch
try {
    var data = Y.JSON.parse(jsonString);
}
catch (e) {
    alert("Invalid product data");
}

// We can now interact with the data
for (var i = data.products.length - 1; i >= 0; --i) {
    var p = data.products[i];
    if (p.price < 1) {
        p.price += 1; // Price increase!
    }
}

})();
                </textarea>
				
				<h5 id="reviver">Using the &quot;reviver&quot; parameter</h5>
				<p>The optional second parameter to <code>parse</code> can be passed a function that will be executed on each member of the parsed JavaScript object.  Each call to the reviver function is passed the key and associated value, and is executed from the context of the object containing the key.  If the return value of the reviver is <code>undefined</code>, the key will be omitted from the returned object.</p>
                <p>Typical uses of reviver functions are filtering, formatting, and value conversion.</p>
				
				<textarea name="code" class="JScript" cols="60" rows="1">
(function () {

var Y = new YUI().use('json-parse');

var jsonString = '{"products":['+
    '{"id":1,"price":.99,"inStock":true,"name":"grapes"},'+
    '{"id":2,"price":3.5,"inStock":false,"name":"passion fruit"},'+
    '{"id":3,"price":2.5,"inStock":true,"name":"bananas"}'+
']}';

// Remove all out of stock entries and bananas.  Format prices.
var currencySymbol = '$';
var reviver = function (key,val) {
    if (key === 'inStock' && !val) {
        return undefined;
    } else if (value === 'bananas') {
        return undefined;
    } else if (key === 'price') {
        val += val % 1 ? "0" : ".00";
        var pIdx = val.indexOf('.');
        val = pIdx ? "0" + val : val;
        val = currencySymbol + val.substr(0,pIdx + 3);
    }

    return val;
};

// Parsing can throw a SyntaxError exception, so we wrap the call in a try/catch
try {
    var data = Y.JSON.parse(jsonString,reviver);
}
catch (e) {
    alert("Invalid product data");
}

// We can now interact with the data
alert(data.products.length); // 1
alert(data.products[0].price); // $0.99

})();
                </textarea>

                <h5 id="avoid_eval">A word of caution against using <code>eval</code></h5>
                <p>JSON data format is a <em>subset</em> of JavaScript notation, meaning that it is possible to use JavaScript <code>eval</code> to transform JSON data to live data.  However, it is unsafe practice to assume that data reaching your code is not malicious.  <code>eval</code> is capable of executing JavaScript's full syntax, including calling functions and accessing cookies with all the privileges of a <code>&lt;script&gt;</code>.  To ensure that the data is safe, the JSON module's <code>parse</code> method inspects the incoming string (using methods derived from Douglas Crockford's <a href="http://json.org/json2.js">json2.js</a>) and verifies it as valid JSON before giving it the green light to parse.</p>

                <textarea name="code" class="JScript" rows="1" cols="60">
// UNSAFE
var data = eval('(' + shouldBeJsonData + ')');

// Safe
var data = Y.JSON.parse(shouldBeJsonData);
                </textarea>

                <h4 id="stringify">Creating JSON string sfrom JavaScript objects</h4>

                <p>To convert a JavaScript object (or any permissable value) to a JSON string, pass that object to <code>Y.JSON.stringify</code> and capture the returned string.  Note that cyclical references will be converted to <code>null</code>.</p>

                <textarea name="code" class="JScript" rows="1" cols="60">
(function () {
var myData = {
    troop : [
        { name: "Ashley", age: 12 },
        { name: "Abby", age:9 }
    ]
}; 

var Y = new YUI().use("json-stringify");

var jsonStr = Y.JSON.stringify(myData);

alert(jsonStr); // {"troop":[{"name":"Ashley","age":12},{"name":"Abby","age":9}]}

// Create a cyclical reference
myData.troop[0]["NEWKEY"] = myData;

jsonStr = Y.JSON.stringify(myData);

alert(jsonStr);
// Note NEWKEY is null
// {"troop":[{"name":"Ashley","age":12,"NEWKEY":null},{"name":"Abby","age":9}]}

})();
                </textarea>

                <h5 id="whitelist">Using a whitelist</h5>
                <p>To serialize only a fixed subset of keys, provide an array of key names as the second parameter to <code>stringify</code>.</p>

                <textarea name="code" class="JScript" rows="1" cols="60">
(function () {

// a detailed object record set
var records = [
    {id:1, name: "Bob",   age: 47, favorite_color: "blue"},
    {id:2, name: "Sally", age: 30, favorite_color: "mauve"},
    {id:3, name: "Tommy", age: 13, favorite_color: "black"},
    {id:4, name: "Chaz",  age: 26, favorite_color: "plaid"}
];

var Y = new YUI().use("json-stringify");

// Use an array of acceptable object key names as a whitelist.
// To create a JSON string with only age and id
var jsonStr = Y.JSON.stringify(records,["id","age"]);

alert(jsonStr);
// [{"id":1,"age":47},{"id":2,"age":30},{"id":3,"age":13},{"id":4,"age":26}]

})();
                </textarea>

                <h5 id="replacer">Using a custom &quot;replacer&quot; function</h5>
                <p>For more granular control of how values in your object are serialized, you can pass a replacer function as the second parameter to <code>stringify</code>.  The replacer will be called for each key value pair, and executed from the context of the key's host object.  The return value of the replacer will be serialized in place of the raw value.</p>

                <textarea name="code" class="JScript" rows="1" cols="60">
(function () {

// a detailed object record set
var records = [
    {id:1, name: "Bob",   birthdate: "2/27/1964", favorite_color: "blue"},
    {id:2, name: "Sally", birthdate: "9/30/1983", favorite_color: "mauve"},
    {id:3, name: "Tommy", birthdate: "3/11/1990", favorite_color: "black"},
    {id:4, name: "Chaz",  birthdate: "5/22/1975", favorite_color: "plaid"}
];

var Y = new YUI().use("json-stringify");

// Create a replacer to blacklist the id and convert the birthdate to a Date
var replacer = function (key,val) {
    // blacklist id and favorite_color
    if (key === 'id' || key === 'favorite_color') {
        return undefined;

    // convert birthdate to a Date instance (serialized as UTC date string)
    } else if (key === 'birtdate') {
        var d = new Date(),
            bd = val.split('/');
        d.setFullYear(bd[2],bd[0]-1,bd[1]);
        d.setHours(0,0,0);
        return d;
    }

    return val;
};

var jsonStr = Y.JSON.stringify(records,replacer);

alert(jsonStr);
// [{"name":"Bobby","birthdate":"1964-02-28T08:00:00Z"},{"name":"Sally","birthdate":"1983-09-30T07:00:00Z"},{"name":"Tommy","birthdate":"1990-03-11T08:00:00Z"},{"name":"Chaz","birthdate":"1975-05-23T07:00:00Z"}]

})();
                </textarea>
                
                <h5 id="depth">Limiting object inspection depth</h5>
                <p>For deeply nested object structures, you can limit the depth to which <code>stringify</code> will serialize the input by passing an integer as the third parameter.</p>

                <textarea name="code" class="JScript" rows="1" cols="60">
(function () {

// A deeply nested structure
var deep = {
    name : "Level 1",
    children : {
        name : "Level 2",
        children : {
            name : "Level 3",
            children : {
                name : "Level 4",
                children : {
                    name : "Level 5",
                    children : {}
                }
            }
        },
        enough : true
    }
};

var Y = new YUI().use('json-stringify');

// Stop at Level 2
var jsonStr = Y.JSON.stringify(deep,null,2);

// jsonStr contains no content for the children object at Level 2
// {"name":"Level 1","children":{"name":"Level 2","children":{},"enough":true}}

})();
                </textarea>

<?php # include "../inc/mobileSection.inc";?>
<?php include "../inc/support.inc"; ?>

		</div>
<div class="yui-u sidebar">

	<?php include "../inc/cheatsheet.inc"; ?>
			
			<div id="examples">
<?php include("../inc/examplesNav/".$section.".inc"); ?>
		   </div>
		   
		<div id="morereading" class="mod box4">
			<div class="hd">
				<h4>More Reading about the YUI <?php echo $component;?>:</h4>
			</div>
			<div class="bd">
				<ul>
					<li><a href="http://www.json.org/">JSON.org</a></li>
					<li><a href="http://tools.ietf.org/html/rfc4627">RFC 4627</a></li>
				  	<li><a href="http://en.wikipedia.org/wiki/JSON">JSON on Wikipedia</a></li>
					<li><a href="http://oreilly.com/catalog/9780596517748/index.html">JavaScript: The Good Parts</a>, by Douglas Crockford</li>
			   </ul>
		   </div>
		</div>
		   
<?php 
$thisURI="http://developer.yahoo.com/yui/<?php echo $section;?>/";
require_once('../inc/badge.inc');
?>
<div class="mod box4">
	<div class="hd">
		<h4 id="delicious">YUI <?php echo $component;?> on del.icio.us:</h4>
	</div>
	<div class="bd">
		<div class="delicious">
		<?php require('../inc/badge-html.inc'); ?>
		</div>
	</div>
</div>

		 </div>
      </div>

</div>
</div>

<?php include "../inc/side.inc" ?>
<?php include "../inc/footer.inc" ?>
