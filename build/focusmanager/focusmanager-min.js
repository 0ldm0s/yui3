YUI.add("focusmanager",function(B){var J="activeDescendant",L="id",H="disabled",M="tabIndex",D="hasFocus",A="focusClass",O="circular",C="UI",E="key",F=J+"Change",N="focusManager",G=B.Lang,K=B.UA;var I=function(){I.superclass.constructor.apply(this,arguments);};I.ATTRS={hasFocus:{value:false,readOnly:true},descendants:{getter:function(P){var R,Q=this._node;if(Q){R=Q.queryAll(P);}return R;}},activeDescendant:{setter:function(T){var R=G.isNumber,Q=B.Attribute.INVALID_VALUE,P=this._descendantsMap,W=this._descendants,V,S,U;if(R(T)){V=T;S=V;}else{if((T instanceof B.Node)&&P){V=P[T.get(L)];if(R(V)){S=V;}else{S=Q;}}else{S=Q;}}if(W){U=W.item(V);if(U&&U.get("disabled")){S=Q;}}return S;}},keys:{value:{next:null,previous:null}},focusClass:{},circular:{value:true}};B.extend(I,B.Base,{_stopped:true,_descendants:null,_descendantsMap:null,_focusedNode:null,_lastNodeIndex:0,_eventHandlers:null,_initDescendants:function(){var W=this.get("descendants"),P={},U=-1,T,S=this.get(J),V,Q,R=0;if(G.isUndefined(S)){S=-1;}if(W){T=W.size();if(T>1){for(R=0;R<T;R++){V=W.item(R);if(U===-1&&!V.get(H)){U=R;}if(S<0&&V.getAttribute(M)==="0"){S=R;}V.set(M,-1);Q=V.get(L);if(!Q){Q=B.guid();V.set(L,Q);}P[Q]=R;}if(S<0){S=0;}V=W.item(S);if(!V||V.get(H)){V=W.item(U);S=U;}this._lastNodeIndex=T-1;this._descendants=W;this._descendantsMap=P;this.set(J,S);V.set(M,0);}}},_isDescendant:function(P){return(P.get(L) in this._descendantsMap);},_removeFocusClass:function(){var Q=this._focusedNode,P=this.get(A);if(Q&&P){Q.removeClass(P);}},_detachKeyHandler:function(){var Q=this._prevKeyHandler,P=this._nextKeyHandler;if(Q){Q.detach();}if(P){P.detach();}},_attachKeyHandler:function(){this._detachKeyHandler();var Q=this.get("keys.next"),P=this.get("keys.previous");if(P){this._prevKeyHandler=B.on(E,this._focusPrevious,this._node,P,this);}if(Q){this._nextKeyHandler=B.on(E,this._focusNext,this._node,Q,this);}},_detachEventHandlers:function(){this._detachKeyHandler();var P=this._eventHandlers;if(P){B.Array.each(P,function(Q){Q.detach();});this._eventHandlers=null;}},_attachEventHandlers:function(){var S=this._descendants,P=this._eventHandlers,R,Q;if(S&&S.size()>1&&!P){R=this._node;this._attachKeyHandler();P=[];P[P.length]=this.after("keysChange",this._attachKeyHandler);Q=R.get("ownerDocument");P[P.length]=B.on("focus",this._onDocFocus,Q,this);P[P.length]=B.on("mousedown",this._onDocMouseDown,Q,this);P[P.length]=this.after("descendantsChange",this._initDescendants);P[P.length]=this.after(F,this._afterActiveDescendantChange);this._eventHandlers=P;}},_onDocMouseDown:function(Q){var P=Q.target,R=this._node.contains(P);if(R&&this._isDescendant(P)){this.focus(P);}else{if(K.webkit&&this.get(D)&&(!R||(R&&!this._isDescendant(P)))){this._set(D,false);this._onDocFocus(Q);}}},_onDocFocus:function(T){var S=this._focusTarget||T.target,U=this.get(D),Q=this.get(A),R=this._focusedNode,P;if(this._focusTarget){this._focusTarget=null;}if(this._node.contains(S)){P=this._isDescendant(S);if(!U&&P){U=true;}else{if(U&&!P){U=false;}}}else{U=false;}if(Q){if(R&&(R!==S||!U)){this._removeFocusClass();}if(P&&U){S.addClass(Q);this._focusedNode=S;}}this._set(D,U);},_focusNext:function(Q,R){var P=R||this.get(J),S;if(this._isDescendant(Q.target)&&(P<=this._lastNodeIndex)){P=P+1;if(P===(this._lastNodeIndex+1)&&this.get(O)){P=0;}S=this._descendants.item(P);if(S.get(H)){this._focusNext(Q,P);}else{this.focus(P);}}},_focusPrevious:function(Q,R){var P=R||this.get(J),S;if(this._isDescendant(Q.target)&&P>=0){P=P-1;if(P===-1&&this.get(O)){P=this._lastNodeIndex;}S=this._descendants.item(P);if(S.get(H)){this._focusPrevious(Q,P);}else{this.focus(P);}}},_afterActiveDescendantChange:function(P){var Q=this._descendants.item(P.prevVal);if(Q){Q.set(M,-1);}Q=this._descendants.item(P.newVal);if(Q){Q.set(M,0);}},initializer:function(P){this._node=P.owner;this.start();},destructor:function(){this.stop();this._node.focusManager=null;},focus:function(P){if(G.isUndefined(P)){P=this.get(J);}this.set(J,P,{src:C});var Q=this._descendants.item(this.get(J));if(Q){if(K.opera&&Q.get("nodeName").toLowerCase()==="button"){this._focusTarget=Q;}Q.focus();}},blur:function(){var P;if(this.get(D)){P=this._descendants.item(this.get(J));if(P){P.blur();this._removeFocusClass();}this._set(D,false,{src:C});}},start:function(){if(this._stopped){this._initDescendants();this._attachEventHandlers();this._stopped=false;}},stop:function(){if(!this._stopped){this._detachEventHandlers();this._descendants=null;this._focusedNode=null;this._lastNodeIndex=0;this._stopped=true;}},refresh:function(){this._initDescendants();},removeFromTabIndex:function(P){if(G.isString(P)){P=B.all(P);}P.set(M,-1);}});I.NAME=N;I.NS=N;B.namespace("plugin");B.plugin.FocusManager=I;},"@VERSION@",{requires:["node"]});