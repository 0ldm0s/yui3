YUI.add("logreader",function(A){A.log.Reader=function(){this.constructor.superclass.constructor.apply(this,arguments);};A.mix(A.log.Reader,{NAME:"logreader",PLUGINS:[],CLASSES:{CONTAINER:"yui-log",HD:"yui-log-hd",CONSOLE:"yui-log-console",FT:"yui-log-ft",HIDE_FT:"yui-log-hide-ft",CONTROLS:"yui-log-controls",BUTTON:"yui-log-button",LABEL:"yui-log-label",CHECKBOX:"yui-log-checkbox",COLLAPSE:"yui-log-collapse",EXPAND:"yui-log-expand",ACTIVE:"yui-log-active",CLEAR:"yui-log-clear",CAT_FILTERS:"yui-log-categories",SRC_FILTERS:"yui-log-sources",CATEGORY:"yui-log-category",SOURCE:"yui-log-source",FILTER:"yui-log-filter",HIDE_BASE:"yui-log-hide-",FILTER_BASE:"yui-log-filter-"},STRINGS:{COLLAPSE:"Collapse",EXPAND:"Expand",ACTIVE:"Active",CLEAR:"Clear"},VERBOSE:"verbose",BASIC:"basic",ATTRS:{title:{value:"Log Console"},enabled:{value:true},active:{value:true},defaultCategory:{value:"info"},defaultSource:{value:"global"},filters:{value:{category:{info:false,warn:false,error:false,time:false},source:{global:false}}},templates:{value:{verbose:null,basic:null}},defaultTemplate:{value:"verbose"},entryWriters:{value:{entry:"_entryFromTemplate"}},defaultWriter:{value:"entry"},printTimeout:{value:100,validator:A.lang.isNumber},consoleLimit:{value:500},footerEnabled:{value:true},verbose:{value:true,set:function(C){var B=A.config.debug;A.config.debug=false;this.set("defaultTemplate",(C?A.log.Reader.VERBOSE:A.log.Reader.BASIC));A.config.debug=B;return !!C;}},newestOnTop:{value:true},collapsed:{value:false},startTime:{value:new Date()},lastTime:{value:new Date()}}});A.extend(A.log.Reader,A.Widget,{_head:null,_title:null,_console:null,_foot:null,_catFilters:null,_srcFilters:null,_timeout:null,buffer:null,get:function(B){var H=A.config.debug;A.config.debug=false;var G=B.split("."),E=G[0],F=1,C=G.length-1,D=A.log.Reader.superclass.get.call(this,E);if(C){for(;D!==undefined&&F<C;++F){D=D[G[F]];}A.config.debug=H;return D===undefined?undefined:D[G[F]];}A.config.debug=H;return D;},set:function(G,C,F){var H=A.config.debug;A.config.debug=false;var K=G.split("."),I=K[0],E=1,D=K.length-1,J=D?A.clone(this.get(I)):C,B;if(D){B=J;for(;B!==undefined&&E<D;++E){B=B[K[E]];}if(B===undefined){A.config.debug=H;return this;}B[K[E]]=C;}A.config.debug=H;return A.log.Reader.superclass.set.call(this,I,J,F);},initializer:function(B){var C=A.config.debug;A.config.debug=false;this.buffer=[];this._initObjectAttributes();this._initTemplates();A.on("yui:log",A.bind(this._handleLogEntry,this));A.config.debug=C;},_initObjectAttributes:function(){var D=A.config.debug;A.config.debug=false;var B=["filters","templates","entryWriters"],C=B.length-1;for(;C>=0;--C){this.set(B[C],A.clone(this.get(B[C])),true);}A.config.debug=D;},_initTemplates:function(){var D=A.config.debug;A.config.debug=false;var B=A.log.Reader.CLASSES;this.set("templates.verbose",'<div class="'+B.MESSAGE+" "+B.VERBOSE+'">'+"<pre>"+"<p>"+'<span class="'+B.ENTRY_CAT+'">{label}</span>'+" {totalTime}ms (+{elapsedTime}) {localTime}:"+"</p>"+"<p>{sourceAndDetail}</p>"+"<p>{message}</p>"+"</pre>"+"</div>");this.set("templates.basic",'<div class="'+B.MESSAGE+'">'+"<pre>"+"<p>"+'<span class="'+B.ENTRY_CAT+'">{label}</span>'+" {totalTime}ms (+{elapsedTime}) {localTime}:"+" {sourceAndDetail}:"+" {message}"+"</p>"+"</pre>"+"</div>");A.config.debug=D;},renderer:function(){var B=A.config.debug;A.config.debug=false;A.log.Reader.superclass.renderer.apply(this,arguments);this.renderUI();this.syncUI();this.bindUI();A.config.debug=B;},renderUI:function(){var B=A.config.debug;A.config.debug=false;if(!this.rendered){this._root.innerHTML="";this._root.addClass(A.log.Reader.CLASSES.CONTAINER);this._renderHead();this._renderConsole();this._renderFoot();}A.config.debug=B;},_renderHead:function(){var E=A.config.debug;A.config.debug=false;var D=A.log.Reader.CLASSES,B=A.log.Reader.STRINGS;this._head=A.Node.create('<div class="'+D.HD+'">'+'<div class="'+D.CONTROLS+'">'+'<input type="button" class="'+D.BUTTON+" "+D.COLLAPSE+'"'+' value="'+B.COLLAPSE+'">'+'<input type="button" class="'+D.BUTTON+" "+D.EXPAND+'"'+' value="'+B.EXPAND+'">'+"</div>"+"<h4>"+this.get("title")+"</h4>"+"</div>");this._title=this._head.query("h4");this._root.insertBefore(this._head,this._root.get("firstChild")||null);A.config.debug=E;},_renderConsole:function(){var B=A.config.debug;A.config.debug=false;this._console=this._root.insertBefore(A.Node.create('<div class="'+A.log.Reader.CLASSES.CONSOLE+'"></div>'),this._foot||null);A.config.debug=B;},_renderFoot:function(){var G=A.config.debug;A.config.debug=false;var F=A.log.Reader.CLASSES,B=A.log.Reader.STRINGS,D,E;this._foot=A.Node.create('<div class="'+F.FT+'">'+'<div class="'+F.CONTROLS+'">'+'<label class="'+F.LABEL+'">'+B.ACTIVE+' <input type="checkbox" class="'+F.CHECKBOX+" "+F.ACTIVE+'" value="1">'+"</label>"+'<input type="button" class="'+F.BUTTON+" "+F.CLEAR+'"'+' value="'+B.CLEAR+'">'+"</div>");this._catFilters=this._foot.appendChild(A.Node.create('<div class="'+F.CONTROLS+" "+F.CAT_FILTERS+'"></div>'));this._srcFilters=this._foot.appendChild(A.Node.create('<div class="'+F.CONTROLS+" "+F.SRC_FILTERS+'"></div>'));D=this.get("filters.category");for(E in D){if(A.object.owns(D,E)){this._catFilters.appendChild(this._createFilter(F.CATEGORY,E));}}D=this.get("filters.source");for(E in D){if(A.object.owns(D,E)){this._srcFilters.appendChild(this._createFilter(F.SOURCE,E));}}this._root.appendChild(this._foot);A.config.debug=G;},syncUI:function(){var E=A.config.debug;A.config.debug=false;var D=A.log.Reader.CLASSES,B;this._setActive(this.get("active"));this._setCollapsed(this.get("collapsed"));this._setFooterEnabled(this.get("footerEnabled"));B=this.get("filters.category");this._foot.queryAll("input[type=checkbox]."+D.CATEGORY).each(function(C){C.set("checked",(C.get("value") in B)?!!B[C.get("value")]:false);});B=this.get("filters.source");this._foot.queryAll("input[type=checkbox]."+D.SOURCE).each(function(C){C.set("checked",(C.get("value") in B)?!!B[C.get("value")]:false);});A.config.debug=E;},bindUI:function(){var D=A.config.debug;
A.config.debug=false;var B=this._root.queryAll("."+A.log.Reader.CLASSES.CONTROLS),C=B.get("length")-1;for(;C>=0;--C){B.item(C).on("click",A.bind(this._handleControlClick,this));}this.on("titleChange",A.bind(this._setTitle,this));this.on("activeChange",A.bind(this._setActive,this));this.on("collapsedChange",A.bind(this._setCollapsed,this));this.on("consoleLimitChange",A.bind(this._setConsoleLimit,this));this.on("footerEnabledChange",A.bind(this._setFooterEnabled,this));this.on("filtersChange",A.bind(this._handleFiltersChange,this));A.config.debug=D;},_handleControlClick:function(D){var F=A.config.debug;A.config.debug=false;var E=A.log.Reader.CLASSES,B=D.target;if(B.hasClass(E.COLLAPSE)){this.set("collapsed",true);}else{if(B.hasClass(E.EXPAND)){this.set("collapsed",false);}else{if(B.hasClass(E.ACTIVE)){this.set("active",false);}else{if(B.hasClass(E.CLEAR)){this.clearConsole();}else{if(B.hasClass(E.FILTER)){this.set("filters."+(B.hasClass(E.CATEGORY)?"category.":"source.")+B.get("value"),B.get("checked"));}}}}}A.config.debug=F;},_setTitle:function(B){var C=A.config.debug;A.config.debug=false;B=typeof B=="object"?B.newVal:B;this._title.set("innerHTML",B);A.config.debug=C;},_setActive:function(B){var E=A.config.debug;A.config.debug=false;B=typeof B=="object"?B.newVal:B;var C=this._head.queryAll("input[type=checkbox]."+A.log.Reader.CLASSES.ACTIVE),D=C.get("length")-1;for(;D>=0;--D){C.item(D).set("checked",!!B);}if(B){this._schedulePrint();}else{if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}}A.config.debug=E;},_setCollapsed:function(B){var C=A.config.debug;A.config.debug=false;B=typeof B=="object"?B.newVal:B;this._root[B?"addClass":"removeClass"](A.log.Reader.CLASSES.COLLAPSE);A.config.debug=C;},_setConsoleLimit:function(B){var C=A.config.debug;A.config.debug=false;B=typeof B==="object"?B.newVal:B;this._trimOldEntries(B);A.config.debug=C;},clearConsole:function(){var B=A.config.debug;A.config.debug=false;this._console.set("innerHTML","");if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}this.buffer=[];A.config.debug=B;},reset:function(){var B=A.config.debug;A.config.debug=false;this.clearConsole();this.set("startTime",new Date());this.set("enabled",true);this.set("active",true);this.fire("reset");A.config.debug=B;},_handleLogEntry:function(G,C,F){var E=A.config.debug;A.config.debug=false;if(this.get("enabled")){var B=this.normalizeMessage(G,C,F),D=this.get("filters");if(B){if(B.category&&!(B.category in D.category)){this.createCategory(B.category,false);}if(B.source&&!(B.source in D.source)){this.createSource(B.source,false);}this.buffer.push(B);this._schedulePrint();}}A.config.debug=E;},normalizeMessage:function(F,C,E){var D=A.config.debug;A.config.debug=false;var B={time:new Date(),message:F,category:C||this.get("defaultCategory"),sourceAndDetail:E||this.get("defaultSource"),source:null,label:null,localTime:null,elapsedTime:null,totalTime:null};B.source=/^(\S+)\s/.test(B.sourceAndDetail)?RegExp.$1:B.sourceAndDetail;B.label=B.category.toUpperCase();B.localTime=B.time.toLocaleTimeString?B.time.toLocaleTimeString():(B.time+"");B.elapsedTime=B.time-this.get("lastTime");B.totalTime=B.time-this.get("startTime");this.set("lastTime",B.time);A.config.debug=D;return B;},_schedulePrint:function(){var B=A.config.debug;A.config.debug=false;if(this.get("active")&&!this._timeout){this._timeout=setTimeout(A.bind(this.printBuffer,this),this.get("printTimeout"));}A.config.debug=B;},printBuffer:function(){var E=A.config.debug;A.config.debug=false;if(this.get("active")&&this.rendered){clearTimeout(this._timeout);this._timeout=null;var D=this.buffer,C=0,B=D.length;this.buffer=[];for(;C<B;++C){this.printLogEntry(D[C]);this._trimOldEntries();}}A.config.debug=E;},printLogEntry:function(B){var F=A.config.debug;A.config.debug=false;var E=this.get("entryWriters"),D=E[B.cat]||E[this.get("defaultWriter")],C;C=typeof D==="function"?D.call(this,B):this[D](B);if(C){if(this.get("newestOnTop")){this._console.insertBefore(C,this._console.get("firstChild"));}else{this._console.appendChild(C);this._console.set("scrollTop",this._console.get("scrollHeight"));}}A.config.debug=F;},_entryFromTemplate:function(B){var E=A.config.debug;A.config.debug=false;B=this._htmlEscapeMessage(B);var D=this.get("templates"),C=D[B.category]||D[this.get("defaultTemplate")],F=A.Node.create(A.lang.substitute(C,B));F.addClass(this._filterClass(B.category));F.addClass(this._filterClass(B.source));A.config.debug=E;return F;},_htmlEscapeMessage:function(B){var D=A.config.debug;A.config.debug=false;function C(E){return E.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;");}B=A.clone(B);B.message=typeof B.message==="string"?C(B.message):B.message;B.label=typeof B.label==="string"?C(B.label):B.label;B.source=typeof B.source==="string"?C(B.source):B.source;B.sourceAndDetail=typeof B.sourceAndDetail==="string"?C(B.sourceAndDetail):B.sourceAndDetail;B.category=typeof B.category==="string"?C(B.category):B.category;A.config.debug=D;return B;},_trimOldEntries:function(D){var G=A.config.debug;A.config.debug=false;if(this._console){var C=this._console.get("childNodes"),B=C.get("length")-((D|0)||this.get("consoleLimit")),E,F;if(B>0){E=this.get("newestOnTop")?C.slice(B):C.slice(0,B);for(F=E.length-1;F>=0;--F){this._console.removeChild(C[F]);}}}A.config.debug=G;},hideEntries:function(B){var E=A.config.debug;A.config.debug=false;var C=this.get("filters"),D;for(D in C){if(A.object.owns(C,D)&&A.object.owns(C[D],B)){this.set("filters."+D+"."+B,true);}}A.config.debug=E;},showEntries:function(B){var E=A.config.debug;A.config.debug=false;var C=this.get("filters"),D;for(D in C){if(A.object.owns(C,D)&&A.object.owns(C[D],B)){this.set("filters."+D+"."+B,true);}}A.config.debug=E;},_setFilter:function(C,E){var F=A.config.debug;A.config.debug=false;var B=this._foot.queryAll("input[type=checkbox]."+this._filterClass(C)),D=B.get("length")-1;for(;D>=0;--D){B.item(D).set("checked",E);}this._filterEntries(C,!!E);A.config.debug=F;},_filterEntries:function(D,C){var F=A.config.debug;
A.config.debug=false;var B=this._console.queryAll("."+this._filterClass(D)),E=B.get("length")-1;for(;E>=0;--E){B.item(E).setStyle("display",(C?"none":""));}A.config.debug=F;},_setFooterEnabled:function(B){var C=A.config.debug;A.config.debug=false;this._root[B?"removeClass":"addClass"](A.log.Reader.CLASSES.HIDE_FT);A.config.debug=C;},createCategory:function(C,B){this.set("filters.category."+C,!!B);},createSource:function(C,B){this.set("filters.source."+C,!!B);},_createFilter:function(E,D){var G=A.config.debug;A.config.debug=false;var F=A.log.Reader.CLASSES,B=A.Node.create('<label class="'+F.LABEL+'">'+'<input type="checkbox" value="'+D+'" class="'+F.FILTER+" "+E+" "+this._filterClass(D)+'"> '+D+"</label>");A.config.debug=G;return B;},_filterClass:function(B,C){return A.log.Reader.CLASSES[(C?"HIDE_BASE":"FILTER_BASE")]+B;},_handleFiltersChange:function(K){var D=A.log.Reader.CLASSES,N=function(P){var O=[];function C(S,R){if(typeof S==="object"){for(var Q in S){if(A.object.owns(S,Q)){C(S[Q],R.concat(Q));}}}else{if(R){O.push(R);}}}C(P,[]);return O;},E=function(R,Q){var O=R,P=0,C=Q.length;for(;P<C&&O!==undefined;++P){O=O[Q[P]];}return O;},M=N(K.prevVal),I=N(K.newVal),G={},H=0,F=M.length,L,B,J;for(;H<F;++H){J=E(K.newVal,M[H]);if(E(K.prevVal,M[H])!==J){B=M[H][1];this._setFilter(B,J);}G[M[H].join(".")]=true;}for(H=0,F=I.length;H<F;++H){if(!G[I[H].join(".")]){L=I[H][0]=="category"?D.CATEGORY:D.SOURCE;B=I[H][1];this._createFilter(L,B);this._setFilter(B,E(K.newVal,I[H]));}}}});},"@VERSION@");