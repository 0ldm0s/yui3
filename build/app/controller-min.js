YUI.add("controller",function(e){var c=e.Array,b=e.HistoryBase.html5,a=e.config.doc.location;function d(){d.superclass.constructor.apply(this,arguments);}e.Controller=e.extend(d,e.Base,{base:"",routes:[],_regexPathParam:/([:*])([\w\d-]+)/g,_regexUrlQuery:/\?([^#]*).*$/,initializer:function(f){f||(f={});this._routes=[];f.base&&(this.base=f.base);f.routes&&(this.routes=f.routes);c.each(this.routes,function(g){this.route(g.path,g.callback,true);},this);this._history=b?new e.HistoryHTML5():new e.HistoryHash();this._history.on("change",this.onHistoryChange,this);this._dispatch(this._history.get());},destructor:function(){this._history.detachAll();},match:function(f){return c.filter(this._routes,function(g){return g.regex.test(f);});},replace:function(f,h,g){return this._save(f,h,g,true);},route:function(g,h){var f=[];this._routes.push({callback:typeof h==="string"?this[h]:h,keys:f,regex:this._getRegex(g,f)});return this;},save:function(f,h,g){return this._save(f,h,g);},_dispatch:function(k){var l=this._getPath(),f=this.match(l),j,h,g;if(!f||!f.length){return;}j=this._getRequest(l,k);g=this;function i(m){var n;if(m){e.error(m);}else{if((h=f.shift())){n=h.regex.exec(l);j.params=n?c.hash(h.keys,n.slice(1)):{};h.callback.call(g,j,i);}}}i();},_getPath:b?function(){var f=this.base,g=a.pathname;if(f&&g.indexOf(f)===0){g=g.substring(f.length);}return g;}:function(){return this._history.get("path")||"/";},_getQuery:b?function(){return a.search.substring(1);}:function(){return this._history.get("query")||"";},_getRegex:function(g,f){if(g instanceof RegExp){return g;}g=g.replace(this._regexPathParam,function(i,h,j){f.push(j);return h==="*"?"(.*?)":"([^/]*)";});return new RegExp("^"+g+"$");},_getRequest:function(g,f){return{path:g,query:this._getQuery(),state:f};},_save:function(f,k,j,h){var g,i;if(b){if(typeof f==="string"){f=this.base+f;}}else{g=j&&e.JSON.stringify(j);f=f.replace(this._regexUrlQuery,function(l,m){i=m;return"";});j={path:f||"/"};i&&(j.query=i);g&&(j.state=g);}this._history[h?"replace":"add"](j||{},{merge:false,title:k,url:f});return this;},onHistoryChange:function(g){var f=this;setTimeout(function(){f._dispatch(g.newVal);},1);}},{NAME:"controller"});},"@VERSION@",{requires:["array-extras","base-build","history","json"]});