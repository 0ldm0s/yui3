YUI.add("controller",function(h){var d=h.HistoryHash,b=h.QueryString,f=h.Array,c=h.HistoryBase.html5&&(!h.UA.android||h.UA.android>=3),a=h.config.win.location,e="ready";function g(){g.superclass.constructor.apply(this,arguments);}h.Controller=h.extend(g,h.Base,{base:"",routes:[],_regexPathParam:/([:*])([\w\d-]+)/g,_regexUrlQuery:/\?([^#]*).*$/,initializer:function(j){var i=this;j||(j={});i._routes=[];j.base&&(i.base=j.base);j.routes&&(i.routes=j.routes);if(h.Lang.isValue(j.dispatchOnInit)){i.dispatchOnInit=j.dispatchOnInit;}f.each(i.routes,function(k){i.route(k.path,k.callback,true);});if(c){i._history=new h.HistoryHTML5({force:true});i._history.after("change",i._afterHistoryChange,i);}else{h.on("hashchange",i._afterHistoryChange,h.config.win,i);}i.publish(e,{defaultFn:i._defReadyFn,fireOnce:true});i.once("initializedChange",function(){setTimeout(function(){i.fire(e,{dispatched:!!i._dispatched});},20);});},destructor:function(){if(c){this._history.detachAll();}else{h.detach("hashchange",this._afterHistoryChange,this);}},match:function(i){return f.filter(this._routes,function(j){return i.search(j.regex)>-1;});},replace:function(i){return this._save(i,true);},route:function(j,k){var i=[];this._routes.push({callback:k,keys:i,path:j,regex:this._getRegex(j,i)});return this;},save:function(i){return this._save(i);},_decode:function(i){return decodeURIComponent(i.replace(/\+/g," "));},_dispatch:function(m){var i=this.match(m),l,j;this._dispatched=true;if(!i||!i.length){return;}l=this._getRequest(m);j=this;function k(o){var q,p,n;if(o){h.error(o);}else{if((n=i.shift())){p=n.regex.exec(m);q=typeof n.callback==="string"?j[n.callback]:n.callback;if(p.length===n.keys.length+1){l.params=f.hash(n.keys,p.slice(1));}else{l.params={};f.each(p,function(s,r){l.params[r]=s;});}q.call(j,l,k);}}}k();},_getPath:(function(){var i=this;function j(l){var k=i.base;if(k&&l.indexOf(k)===0){l=l.substring(k.length);}return l;}return c?function(){return j(a.pathname);}:function(){var k=d.getHash();return k?k.replace(this._regexUrlQuery,""):j(a.pathname);};}()),_getQuery:c?function(){return a.search.substring(1);}:function(){var j=d.getHash(),i=j.match(this._regexUrlQuery);return j&&i?i[1]:a.search.substring(1);},_getRegex:function(j,i){if(j instanceof RegExp){return j;}j=j.replace(this._regexPathParam,function(l,k,m){i.push(m);return k==="*"?"(.*?)":"([^/]*)";});return new RegExp("^"+j+"$");},_getRequest:function(i){return{path:i,query:this._parseQuery(this._getQuery())};},_parseQuery:b&&b.parse?b.parse:function(m){var n=this._decode,p=m.split("&"),l=0,k=p.length,j={},o;for(;l<k;++l){o=p[l].split("=");if(o[0]){j[n(o[0])]=n(o[1]||"");}}return j;},_save:c?function(i,j){this._history[j?"replace":"add"](null,{url:typeof i==="string"?this.base+i:i});return this;}:function(i,j){d[j?"replaceHash":"setHash"](i);return this;},_afterHistoryChange:function(j){var i=this;setTimeout(function(){i._dispatch(i._getPath());},1);},_defReadyFn:function(i){if(this.dispatchOnInit&&!i.dispatched){this._dispatch(this._getPath());}}},{NAME:"controller"});},"@VERSION@",{requires:["array-extras","base-build","history","json"],optional:["querystring-parse"]});