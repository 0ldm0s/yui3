YUI.add("graphics-canvas",function(d,k){var v="canvas",u="shape",a=/[a-z][^a-z]*/ig,n=/[-]?[0-9]*[0-9|\.][0-9]*/g,g=d.config.doc,z=d.Lang,o=d.AttributeLite,p,r,B,t,l,h,A=d.DOM,j=d.Color,s=parseInt,i=parseFloat,q=z.isNumber,m=RegExp,w=j.toRGB,b=j.toHex,f=d.ClassNameManager.getClassName;function c(){}c.prototype={_pathSymbolToMethod:{M:"moveTo",m:"relativeMoveTo",L:"lineTo",l:"relativeLineTo",C:"curveTo",c:"relativeCurveTo",Q:"quadraticCurveTo",q:"relativeQuadraticCurveTo",z:"closePath",Z:"closePath"},_currentX:0,_currentY:0,_toRGBA:function(D,C){C=(C!==undefined)?C:1;if(!j.re_RGB.test(D)){D=b(D);}if(j.re_hex.exec(D)){D="rgba("+[s(m.$1,16),s(m.$2,16),s(m.$3,16)].join(",")+","+C+")";}return D;},_toRGB:function(C){return w(C);},setSize:function(C,D){if(this.get("autoSize")){if(C>this.node.getAttribute("width")){this.node.style.width=C+"px";this.node.setAttribute("width",C);}if(D>this.node.getAttribute("height")){this.node.style.height=D+"px";this.node.setAttribute("height",D);}}},_updateCoords:function(C,D){this._xcoords.push(C);this._ycoords.push(D);this._currentX=C;this._currentY=D;},_clearAndUpdateCoords:function(){var C=this._xcoords.pop()||0,D=this._ycoords.pop()||0;this._updateCoords(C,D);},_updateNodePosition:function(){var D=this.get("node"),C=this.get("x"),E=this.get("y");D.style.position="absolute";D.style.left=(C+this._left)+"px";D.style.top=(E+this._top)+"px";},_updateDrawingQueue:function(C){this._methods.push(C);},lineTo:function(){this._lineTo.apply(this,[d.Array(arguments),false]);},relativeLineTo:function(){this._lineTo.apply(this,[d.Array(arguments),true]);},_lineTo:function(I,C){var K=I[0],D,F,L,J,G=this._stroke&&this._strokeWeight?this._strokeWeight:0,H=C?parseFloat(this._currentX):0,E=C?parseFloat(this._currentY):0;if(!this._lineToMethods){this._lineToMethods=[];}F=I.length-1;if(typeof K==="string"||typeof K==="number"){for(D=0;D<F;D=D+2){L=parseFloat(I[D]);J=parseFloat(I[D+1]);L=L+H;J=J+E;this._updateDrawingQueue(["lineTo",L,J]);this._trackSize(L-G,J-G);this._trackSize(L+G,J+G);this._updateCoords(L,J);}}else{for(D=0;D<F;D=D+1){L=parseFloat(I[D][0]);J=parseFloat(I[D][1]);this._updateDrawingQueue(["lineTo",L,J]);this._lineToMethods[this._lineToMethods.length]=this._methods[this._methods.length-1];this._trackSize(L-G,J-G);this._trackSize(L+G,J+G);this._updateCoords(L,J);}}this._drawingComplete=false;return this;},moveTo:function(){this._moveTo.apply(this,[d.Array(arguments),false]);},relativeMoveTo:function(){this._moveTo.apply(this,[d.Array(arguments),true]);},_moveTo:function(E,H){var D=this._stroke&&this._strokeWeight?this._strokeWeight:0,G=H?parseFloat(this._currentX):0,F=H?parseFloat(this._currentY):0,C=parseFloat(E[0])+G,I=parseFloat(E[1])+F;this._updateDrawingQueue(["moveTo",C,I]);this._trackSize(C-D,I-D);this._trackSize(C+D,I+D);this._updateCoords(C,I);this._drawingComplete=false;return this;},curveTo:function(){this._curveTo.apply(this,[d.Array(arguments),false]);},relativeCurveTo:function(){this._curveTo.apply(this,[d.Array(arguments),true]);},_curveTo:function(K,D){var M,G,O,N,E,C,L,F=0,I,J=D?parseFloat(this._currentX):0,H=D?parseFloat(this._currentY):0;I=K.length-5;for(;F<I;F=F+6){cp1x=parseFloat(K[F])+J;cp1y=parseFloat(K[F+1])+H;cp2x=parseFloat(K[F+2])+J;cp2y=parseFloat(K[F+3])+H;x=parseFloat(K[F+4])+J;y=parseFloat(K[F+5])+H;this._updateDrawingQueue(["bezierCurveTo",cp1x,cp1y,cp2x,cp2y,x,y]);this._drawingComplete=false;N=Math.max(x,Math.max(cp1x,cp2x));C=Math.max(y,Math.max(cp1y,cp2y));E=Math.min(x,Math.min(cp1x,cp2x));L=Math.min(y,Math.min(cp1y,cp2y));M=Math.abs(N-E);G=Math.abs(C-L);O=[[this._currentX,this._currentY],[cp1x,cp1y],[cp2x,cp2y],[x,y]];this._setCurveBoundingBox(O,M,G);this._currentX=x;this._currentY=y;}},quadraticCurveTo:function(){this._quadraticCurveTo.apply(this,[d.Array(arguments),false]);},relativeQuadraticCurveTo:function(){this._quadraticCurveTo.apply(this,[d.Array(arguments),true]);},_quadraticCurveTo:function(D,S){var G,F,J,I,K,Q,T,R,E,H,L,O=0,P=D.length-3,C=this._stroke&&this._strokeWeight?this._strokeWeight:0,N=S?parseFloat(this._currentX):0,M=S?parseFloat(this._currentY):0;for(;O<P;O=O+4){G=parseFloat(D[O])+N;F=parseFloat(D[O+1])+M;J=parseFloat(D[O+2])+N;I=parseFloat(D[O+3])+M;this._drawingComplete=false;R=Math.max(J,G);H=Math.max(I,F);E=Math.min(J,G);L=Math.min(I,F);K=Math.abs(R-E);Q=Math.abs(H-L);T=[[this._currentX,this._currentY],[G,F],[J,I]];this._setCurveBoundingBox(T,K,Q);this._updateDrawingQueue(["quadraticCurveTo",G,F,J,I]);this._updateCoords(J,I);}return this;},drawCircle:function(E,I,D){var G=0,F=2*Math.PI,C=this._stroke&&this._strokeWeight?this._strokeWeight:0,H=D*2;H+=C;this._drawingComplete=false;this._trackSize(E+H,I+H);this._trackSize(E-C,I-C);this._updateCoords(E,I);this._updateDrawingQueue(["arc",E+D,I+D,D,G,F,false]);return this;},drawDiamond:function(D,H,G,C){var F=G*0.5,E=C*0.5;this.moveTo(D+F,H);this.lineTo(D+G,H+E);this.lineTo(D+F,H+C);this.lineTo(D,H+E);this.lineTo(D+F,H);return this;},drawEllipse:function(N,L,O,T){var Q=8,I=-(45/180)*Math.PI,V=0,H,F=O/2,G=T/2,R=0,K=N+F,J=L+G,P,M,U,S,E,D,C=this._stroke&&this._strokeWeight?this._strokeWeight:0;P=K+Math.cos(0)*F;M=J+Math.sin(0)*G;this.moveTo(P,M);for(;R<Q;R++){V+=I;H=V-(I/2);U=K+Math.cos(V)*F;S=J+Math.sin(V)*G;E=K+Math.cos(H)*(F/Math.cos(I/2));D=J+Math.sin(H)*(G/Math.cos(I/2));this._updateDrawingQueue(["quadraticCurveTo",E,D,U,S]);}this._trackSize(N+O+C,L+T+C);this._trackSize(N-C,L-C);this._updateCoords(N,L);return this;},drawRect:function(D,G,E,F){var C=this._stroke&&this._strokeWeight?this._strokeWeight:0;this._drawingComplete=false;this.moveTo(D,G);this.lineTo(D+E,G);this.lineTo(D+E,G+F);this.lineTo(D,G+F);this.lineTo(D,G);return this;},drawRoundRect:function(D,I,E,G,F,H){var C=this._stroke&&this._strokeWeight?this._strokeWeight:0;this._drawingComplete=false;this.moveTo(D,I+H);this.lineTo(D,I+G-H);this.quadraticCurveTo(D,I+G,D+F,I+G);this.lineTo(D+E-F,I+G);this.quadraticCurveTo(D+E,I+G,D+E,I+G-H);this.lineTo(D+E,I+H);this.quadraticCurveTo(D+E,I,D+E-F,I);this.lineTo(D+F,I);
this.quadraticCurveTo(D,I,D,I+H);return this;},drawWedge:function(M,K,Q,J,F,G){var C=this._stroke&&this._strokeWeight?this._strokeWeight:0,P,O,I,U,H,N,L,T,S,E,D,R=0;G=G||F;this._drawingComplete=false;this._updateDrawingQueue(["moveTo",M,K]);G=G||F;if(Math.abs(J)>360){J=360;}P=Math.ceil(Math.abs(J)/45);O=J/P;I=-(O/180)*Math.PI;U=(Q/180)*Math.PI;if(P>0){N=M+Math.cos(Q/180*Math.PI)*F;L=K+Math.sin(Q/180*Math.PI)*G;this.lineTo(N,L);for(;R<P;++R){U+=I;H=U-(I/2);T=M+Math.cos(U)*F;S=K+Math.sin(U)*G;E=M+Math.cos(H)*(F/Math.cos(I/2));D=K+Math.sin(H)*(G/Math.cos(I/2));this._updateDrawingQueue(["quadraticCurveTo",E,D,T,S]);}this._updateDrawingQueue(["lineTo",M,K]);}this._trackSize(0-C,0-C);this._trackSize((F*2)+C,(F*2)+C);return this;},end:function(){this._closePath();return this;},closePath:function(){this._updateDrawingQueue(["closePath"]);this._updateDrawingQueue(["beginPath"]);},_getLinearGradient:function(){var O=d.Lang.isNumber,T=this.get("fill"),K=T.stops,H,S,R,U=0,V=K.length,C,M=0,L=0,N=this.get("width"),W=this.get("height"),Q=T.rotation||0,Y,X,G,E,F=M+N/2,D=L+W/2,J,I=Math.PI/180,P=parseFloat(parseFloat(Math.tan(Q*I)).toFixed(8));if(Math.abs(P)*N/2>=W/2){if(Q<180){G=L;E=L+W;}else{G=L+W;E=L;}Y=F-((D-G)/P);X=F-((D-E)/P);}else{if(Q>90&&Q<270){Y=M+N;X=M;}else{Y=M;X=M+N;}G=((P*(F-Y))-D)*-1;E=((P*(F-X))-D)*-1;}C=this._context.createLinearGradient(Y,G,X,E);for(;U<V;++U){R=K[U];H=R.opacity;S=R.color;J=R.offset;if(O(H)){H=Math.max(0,Math.min(1,H));S=this._toRGBA(S,H);}else{S=w(S);}J=R.offset||U/(V-1);C.addColorStop(J,S);}return C;},_getRadialGradient:function(){var R=d.Lang.isNumber,X=this.get("fill"),S=X.r,J=X.fx,H=X.fy,L=X.stops,I,U,T,Y=0,aa=L.length,D,O=0,N=0,P=this.get("width"),ab=this.get("height"),ac,Z,G,F,W,V,C,Q,ad,ae,K,M,E;V=O+P/2;C=N+ab/2;ac=P*J;G=ab*H;Z=O+P/2;F=N+ab/2;W=P*S;ae=Math.sqrt(Math.pow(Math.abs(V-ac),2)+Math.pow(Math.abs(C-G),2));if(ae>=W){M=ae/W;if(M===1){M=1.01;}Q=(ac-V)/M;ad=(G-C)/M;Q=Q>0?Math.floor(Q):Math.ceil(Q);ad=ad>0?Math.floor(ad):Math.ceil(ad);ac=V+Q;G=C+ad;}if(S>=0.5){D=this._context.createRadialGradient(ac,G,S,Z,F,S*P);E=1;}else{D=this._context.createRadialGradient(ac,G,S,Z,F,P/2);E=S*2;}for(;Y<aa;++Y){T=L[Y];I=T.opacity;U=T.color;K=T.offset;if(R(I)){I=Math.max(0,Math.min(1,I));U=this._toRGBA(U,I);}else{U=w(U);}K=T.offset||Y/(aa-1);K*=E;if(K<=1){D.addColorStop(K,U);}}return D;},_initProps:function(){this._methods=[];this._lineToMethods=[];this._xcoords=[0];this._ycoords=[0];this._width=0;this._height=0;this._left=0;this._top=0;this._right=0;this._bottom=0;this._currentX=0;this._currentY=0;},_drawingComplete:false,_createGraphic:function(C){var D=d.config.doc.createElement("canvas");return D;},getBezierData:function(G,F){var H=G.length,E=[],D,C;for(D=0;D<H;++D){E[D]=[G[D][0],G[D][1]];}for(C=1;C<H;++C){for(D=0;D<H-C;++D){E[D][0]=(1-F)*E[D][0]+F*E[parseInt(D+1,10)][0];E[D][1]=(1-F)*E[D][1]+F*E[parseInt(D+1,10)][1];}}return[E[0][0],E[0][1]];},_setCurveBoundingBox:function(N,J,F){var E=0,D=this._currentX,K=D,I=this._currentY,C=I,H=Math.round(Math.sqrt((J*J)+(F*F))),L=1/H,G=this._stroke&&this._strokeWeight?this._strokeWeight:0,M;for(;E<H;++E){M=this.getBezierData(N,L*E);D=isNaN(D)?M[0]:Math.min(M[0],D);K=isNaN(K)?M[0]:Math.max(M[0],K);I=isNaN(I)?M[1]:Math.min(M[1],I);C=isNaN(C)?M[1]:Math.max(M[1],C);}D=Math.round(D*10)/10;K=Math.round(K*10)/10;I=Math.round(I*10)/10;C=Math.round(C*10)/10;this._trackSize(K+G,C+G);this._trackSize(D-G,I-G);},_trackSize:function(C,D){if(C>this._right){this._right=C;}if(C<this._left){this._left=C;}if(D<this._top){this._top=D;}if(D>this._bottom){this._bottom=D;}this._width=this._right-this._left;this._height=this._bottom-this._top;}};d.CanvasDrawing=c;p=function(C){this._transforms=[];this.matrix=new d.Matrix();p.superclass.constructor.apply(this,arguments);};p.NAME="shape";d.extend(p,d.GraphicBase,d.mix({init:function(){this.initializer.apply(this,arguments);},initializer:function(C){var D=this,F=C.graphic,E=this.get("data");D._initProps();D.createNode();D._xcoords=[0];D._ycoords=[0];if(F){this._setGraphic(F);}if(E){D._parsePathData(E);}D._updateHandler();},_setGraphic:function(C){var D;if(C instanceof d.CanvasGraphic){this._graphic=C;}else{C=d.one(C);D=new d.CanvasGraphic({render:C});D._appendShape(this);this._graphic=D;}},addClass:function(C){var D=d.one(this.get("node"));D.addClass(C);},removeClass:function(C){var D=d.one(this.get("node"));D.removeClass(C);},getXY:function(){var F=this.get("graphic"),D=F.getXY(),C=this.get("x"),E=this.get("y");return[D[0]+C,D[1]+E];},setXY:function(E){var G=this.get("graphic"),D=G.getXY(),C=E[0]-D[0],F=E[1]-D[1];this._set("x",C);this._set("y",F);this._updateNodePosition(C,F);},contains:function(C){return C===d.one(this.node);},test:function(C){return d.one(this.get("node")).test(C);},compareTo:function(C){var D=this.node;return D===C;},_getDefaultFill:function(){return{type:"solid",cx:0.5,cy:0.5,fx:0.5,fy:0.5,r:0.5};},_getDefaultStroke:function(){return{weight:1,dashstyle:"none",color:"#000",opacity:1};},_left:0,_right:0,_top:0,_bottom:0,createNode:function(){var E=this,D=d.config.doc.createElement("canvas"),G=E.get("id"),F=E._camelCaseConcat,C=E.name;E._context=D.getContext("2d");D.setAttribute("overflow","visible");D.style.overflow="visible";if(!E.get("visible")){D.style.visibility="hidden";}D.setAttribute("id",G);G="#"+G;E.node=D;E.addClass(f(u)+" "+f(F(v,u))+" "+f(C)+" "+f(F(v,C)));},on:function(D,C){if(d.Node.DOM_EVENTS[D]){return d.one("#"+this.get("id")).on(D,C);}return d.on.apply(this,arguments);},_setStrokeProps:function(I){var D,H,G,F,E,C;if(I){D=I.color;H=i(I.weight);G=i(I.opacity);F=I.linejoin||"round";E=I.linecap||"butt";C=I.dashstyle;this._miterlimit=null;this._dashstyle=(C&&d.Lang.isArray(C)&&C.length>1)?C:null;this._strokeWeight=H;if(q(H)&&H>0){this._stroke=1;}else{this._stroke=0;}if(q(G)){this._strokeStyle=this._toRGBA(D,G);}else{this._strokeStyle=D;}this._linecap=E;if(F=="round"||F=="bevel"){this._linejoin=F;}else{F=parseInt(F,10);if(q(F)){this._miterlimit=Math.max(F,1);this._linejoin="miter";
}}}else{this._stroke=0;}},set:function(){var C=this,D=arguments[0];o.prototype.set.apply(C,arguments);if(C.initialized){C._updateHandler();}},_setFillProps:function(G){var E=q,C,D,F;if(G){C=G.color;F=G.type;if(F=="linear"||F=="radial"){this._fillType=F;}else{if(C){D=G.opacity;if(E(D)){D=Math.max(0,Math.min(1,D));C=this._toRGBA(C,D);}else{C=w(C);}this._fillColor=C;this._fillType="solid";}else{this._fillColor=null;}}}else{this._fillType=null;this._fillColor=null;}},translate:function(C,D){this._translateX+=C;this._translateY+=D;this._addTransform("translate",arguments);},translateX:function(C){this._translateX+=C;this._addTransform("translateX",arguments);},translateY:function(C){this._translateY+=C;this._addTransform("translateY",arguments);},skew:function(C,D){this._addTransform("skew",arguments);},skewX:function(C){this._addTransform("skewX",arguments);},skewY:function(C){this._addTransform("skewY",arguments);},rotate:function(C){this._rotation=C;this._addTransform("rotate",arguments);},scale:function(C,D){this._addTransform("scale",arguments);},_rotation:0,_transform:"",_addTransform:function(D,C){C=d.Array(C);this._transform=z.trim(this._transform+" "+D+"("+C.join(", ")+")");C.unshift(D);this._transforms.push(C);if(this.initialized){this._updateTransform();}},_updateTransform:function(){var I=this.node,H,F,E=this.get("transformOrigin"),D=this.matrix,G=0,C=this._transforms.length;if(this._transforms&&this._transforms.length>0){for(;G<C;++G){H=this._transforms[G].shift();if(H){D[H].apply(D,this._transforms[G]);}}F=D.toCSSText();}this._graphic.addToRedrawQueue(this);E=(100*E[0])+"% "+(100*E[1])+"%";A.setStyle(I,"transformOrigin",E);if(F){A.setStyle(I,"transform",F);}this._transforms=[];},_updateHandler:function(){this._draw();this._updateTransform();},_draw:function(){var C=this.node;this.clear();this._closePath();C.style.left=this.get("x")+"px";C.style.top=this.get("y")+"px";},_closePath:function(){if(!this._methods){return;}var G=this.get("node"),N=this._right-this._left,K=this._bottom-this._top,D=this._context,H=[],E=this._methods.concat(),J=0,I,C,M,F,L=0;this._context.clearRect(0,0,G.width,G.height);if(this._methods){L=E.length;if(!L||L<1){return;}for(;J<L;++J){H[J]=E[J].concat();M=H[J];F=M[0]=="quadraticCurveTo"?M.length:3;for(I=1;I<F;++I){if(I%2===0){M[I]=M[I]-this._top;}else{M[I]=M[I]-this._left;}}}G.setAttribute("width",Math.min(N,2000));G.setAttribute("height",Math.min(2000,K));D.beginPath();for(J=0;J<L;++J){M=H[J].concat();if(M&&M.length>0){C=M.shift();if(C){if(C=="closePath"){D.closePath();this._strokeAndFill(D);}else{if(C&&C=="lineTo"&&this._dashstyle){M.unshift(this._xcoords[J]-this._left,this._ycoords[J]-this._top);this._drawDashedLine.apply(this,M);}else{D[C].apply(D,M);}}}}}this._strokeAndFill(D);this._drawingComplete=true;this._clearAndUpdateCoords();this._updateNodePosition();this._methods=E;}},_strokeAndFill:function(C){if(this._fillType){if(this._fillType=="linear"){C.fillStyle=this._getLinearGradient();}else{if(this._fillType=="radial"){C.fillStyle=this._getRadialGradient();}else{C.fillStyle=this._fillColor;}}C.closePath();C.fill();}if(this._stroke){if(this._strokeWeight){C.lineWidth=this._strokeWeight;}C.lineCap=this._linecap;C.lineJoin=this._linejoin;if(this._miterlimit){C.miterLimit=this._miterlimit;}C.strokeStyle=this._strokeStyle;C.stroke();}},_drawDashedLine:function(L,R,C,O){var D=this._context,P=this._dashstyle[0],N=this._dashstyle[1],F=P+N,I=C-L,M=O-R,Q=Math.sqrt(Math.pow(I,2)+Math.pow(M,2)),G=Math.floor(Math.abs(Q/F)),E=Math.atan2(M,I),K=L,J=R,H;I=Math.cos(E)*F;M=Math.sin(E)*F;for(H=0;H<G;++H){D.moveTo(K,J);D.lineTo(K+Math.cos(E)*P,J+Math.sin(E)*P);K+=I;J+=M;}D.moveTo(K,J);Q=Math.sqrt((C-K)*(C-K)+(O-J)*(O-J));if(Q>P){D.lineTo(K+Math.cos(E)*P,J+Math.sin(E)*P);}else{if(Q>0){D.lineTo(K+Math.cos(E)*Q,J+Math.sin(E)*Q);}}D.moveTo(C,O);},clear:function(){this._initProps();if(this.node){this._context.clearRect(0,0,this.node.width,this.node.height);}return this;},getBounds:function(){var F=this._type,D=this.get("width"),E=this.get("height"),C=this.get("x"),G=this.get("y");if(F=="path"){C=C+this._left;G=G+this._top;D=this._right-this._left;E=this._bottom-this._top;}return this._getContentRect(D,E,C,G);},_getContentRect:function(N,F,L,I){var D=this.get("transformOrigin"),M=D[0]*N,K=D[1]*F,H=this.matrix.getTransformArray(this.get("transform")),J=new d.Matrix(),E=0,G=H.length,C,O,P;if(this._type=="path"){M=M+L;K=K+I;}M=!isNaN(M)?M:0;K=!isNaN(K)?K:0;J.translate(M,K);for(;E<G;E=E+1){C=H[E];O=C.shift();if(O){J[O].apply(J,C);}}J.translate(-M,-K);P=J.getContentRect(N,F,L,I);return P;},toFront:function(){var C=this.get("graphic");if(C){C._toFront(this);}},toBack:function(){var C=this.get("graphic");if(C){C._toBack(this);}},_parsePathData:function(E){var C,G,I,K=d.Lang.trim(E.match(a)),F=0,H,J,D=this._pathSymbolToMethod;if(K){this.clear();H=K.length||0;for(;F<H;F=F+1){J=K[F];G=J.substr(0,1),I=J.substr(1).match(n);C=D[G];if(C){if(I){this[C].apply(this,I);}else{this[C].apply(this);}}}this.end();}},destroy:function(){var C=this.get("graphic");if(C){C.removeShape(this);}else{this._destroy();}},_destroy:function(){if(this.node){d.one(this.node).remove(true);this._context=null;this.node=null;}}},d.CanvasDrawing.prototype));p.ATTRS={transformOrigin:{valueFn:function(){return[0.5,0.5];}},transform:{setter:function(C){this.matrix.init();this._transforms=this.matrix.getTransformArray(C);this._transform=C;return C;},getter:function(){return this._transform;}},node:{readOnly:true,getter:function(){return this.node;}},id:{valueFn:function(){return d.guid();},setter:function(D){var C=this.node;if(C){C.setAttribute("id",D);}return D;}},width:{value:0},height:{value:0},x:{value:0},y:{value:0},visible:{value:true,setter:function(E){var D=this.get("node"),C=E?"visible":"hidden";if(D){D.style.visibility=C;}return E;}},fill:{valueFn:"_getDefaultFill",setter:function(E){var D,C=this.get("fill")||this._getDefaultFill();D=(E)?d.merge(C,E):null;if(D&&D.color){if(D.color===undefined||D.color=="none"){D.color=null;
}}this._setFillProps(D);return D;}},stroke:{valueFn:"_getDefaultStroke",setter:function(E){var D=this.get("stroke")||this._getDefaultStroke(),C;if(E&&E.hasOwnProperty("weight")){C=parseInt(E.weight,10);if(!isNaN(C)){E.weight=C;}}E=(E)?d.merge(D,E):null;this._setStrokeProps(E);return E;}},autoSize:{value:false},pointerEvents:{value:"visiblePainted"},data:{setter:function(C){if(this.get("node")){this._parsePathData(C);}return C;}},graphic:{readOnly:true,getter:function(){return this._graphic;}}};d.CanvasShape=p;r=function(C){r.superclass.constructor.apply(this,arguments);};r.NAME="path";d.extend(r,d.CanvasShape,{_type:"path",_draw:function(){this._closePath();this._updateTransform();},createNode:function(){var E=this,D=d.config.doc.createElement("canvas"),C=E.name,F=E._camelCaseConcat,G=E.get("id");E._context=D.getContext("2d");D.setAttribute("overflow","visible");D.setAttribute("pointer-events","none");D.style.pointerEvents="none";D.style.overflow="visible";D.setAttribute("id",G);G="#"+G;E.node=D;E.addClass(f(u)+" "+f(F(v,u))+" "+f(C)+" "+f(F(v,C)));},end:function(){this._draw();}});r.ATTRS=d.merge(d.CanvasShape.ATTRS,{width:{getter:function(){var C=this._stroke&&this._strokeWeight?(this._strokeWeight*2):0;return this._width-C;},setter:function(C){this._width=C;return C;}},height:{getter:function(){var C=this._stroke&&this._strokeWeight?(this._strokeWeight*2):0;return this._height-C;},setter:function(C){this._height=C;return C;}},path:{readOnly:true,getter:function(){return this._path;}}});d.CanvasPath=r;B=function(){B.superclass.constructor.apply(this,arguments);};B.NAME="rect";d.extend(B,d.CanvasShape,{_type:"rect",_draw:function(){var C=this.get("width"),D=this.get("height");this.clear();this.drawRect(0,0,C,D);this._closePath();}});B.ATTRS=d.CanvasShape.ATTRS;d.CanvasRect=B;t=function(C){t.superclass.constructor.apply(this,arguments);};t.NAME="ellipse";d.extend(t,p,{_type:"ellipse",_draw:function(){var C=this.get("width"),D=this.get("height");this.clear();this.drawEllipse(0,0,C,D);this._closePath();}});t.ATTRS=d.merge(p.ATTRS,{xRadius:{setter:function(C){this.set("width",C*2);},getter:function(){var C=this.get("width");if(C){C*=0.5;}return C;}},yRadius:{setter:function(C){this.set("height",C*2);},getter:function(){var C=this.get("height");if(C){C*=0.5;}return C;}}});d.CanvasEllipse=t;l=function(C){l.superclass.constructor.apply(this,arguments);};l.NAME="circle";d.extend(l,d.CanvasShape,{_type:"circle",_draw:function(){var C=this.get("radius");if(C){this.clear();this.drawCircle(0,0,C);this._closePath();}}});l.ATTRS=d.merge(d.CanvasShape.ATTRS,{width:{setter:function(C){this.set("radius",C/2);return C;},getter:function(){return this.get("radius")*2;}},height:{setter:function(C){this.set("radius",C/2);return C;},getter:function(){return this.get("radius")*2;}},radius:{lazyAdd:false}});d.CanvasCircle=l;h=function(){h.superclass.constructor.apply(this,arguments);};h.NAME="canvasPieSlice";d.extend(h,d.CanvasShape,{_type:"path",_draw:function(G){var D=this.get("cx"),H=this.get("cy"),F=this.get("startAngle"),E=this.get("arc"),C=this.get("radius");this.clear();this._left=D;this._right=C;this._top=H;this._bottom=C;this.drawWedge(D,H,F,E,C);this.end();}});h.ATTRS=d.mix({cx:{value:0},cy:{value:0},startAngle:{value:0},arc:{value:0},radius:{value:0}},d.CanvasShape.ATTRS);d.CanvasPieSlice=h;function e(C){e.superclass.constructor.apply(this,arguments);}e.NAME="canvasGraphic";e.ATTRS={render:{},id:{valueFn:function(){return d.guid();},setter:function(D){var C=this._node;if(C){C.setAttribute("id",D);}return D;}},shapes:{readOnly:true,getter:function(){return this._shapes;}},contentBounds:{readOnly:true,getter:function(){return this._contentBounds;}},node:{readOnly:true,getter:function(){return this._node;}},width:{setter:function(C){if(this._node){this._node.style.width=C+"px";}return C;}},height:{setter:function(C){if(this._node){this._node.style.height=C+"px";}return C;}},autoSize:{value:false},preserveAspectRatio:{value:"xMidYMid"},resizeDown:{value:false},x:{getter:function(){return this._x;},setter:function(C){this._x=C;if(this._node){this._node.style.left=C+"px";}return C;}},y:{getter:function(){return this._y;},setter:function(C){this._y=C;if(this._node){this._node.style.top=C+"px";}return C;}},autoDraw:{value:true},visible:{value:true,setter:function(C){this._toggleVisible(C);return C;}}};d.extend(e,d.GraphicBase,{set:function(D,H){var G=this,C={autoDraw:true,autoSize:true,preserveAspectRatio:true,resizeDown:true},F,E=false;o.prototype.set.apply(G,arguments);if(G._state.autoDraw===true&&d.Object.size(this._shapes)>0){if(z.isString&&C[D]){E=true;}else{if(z.isObject(D)){for(F in C){if(C.hasOwnProperty(F)&&D[F]){E=true;break;}}}}}if(E){G._redraw();}},_x:0,_y:0,getXY:function(){var C=d.one(this._node),D;if(C){D=C.getXY();}return D;},initializer:function(E){var G=this.get("render"),D=this.get("visible")?"visible":"hidden",C=this.get("width")||0,F=this.get("height")||0;this._shapes={};this._redrawQueue={};this._contentBounds={left:0,top:0,right:0,bottom:0};this._node=g.createElement("div");this._node.style.position="absolute";this._node.style.visibility=D;this.set("width",C);this.set("height",F);if(G){this.render(G);}},render:function(F){var C=d.one(F),G=this._node,D=this.get("width")||parseInt(C.getComputedStyle("width"),10),E=this.get("height")||parseInt(C.getComputedStyle("height"),10);C=C||g.body;C.appendChild(G);G.style.display="block";G.style.position="absolute";G.style.left="0px";G.style.top="0px";this.set("width",D);this.set("height",E);this.parentNode=C;return this;},destroy:function(){this.removeAllShapes();if(this._node){this._removeChildren(this._node);d.one(this._node).destroy();}},addShape:function(C){C.graphic=this;if(!this.get("visible")){C.visible=false;}var E=this._getShapeClass(C.type),D=new E(C);this._appendShape(D);return D;},_appendShape:function(D){var E=D.node,C=this._frag||this._node;if(this.get("autoDraw")){C.appendChild(E);}else{this._getDocFrag().appendChild(E);}},removeShape:function(C){if(!(C instanceof p)){if(z.isString(C)){C=this._shapes[C];
}}if(C&&C instanceof p){C._destroy();delete this._shapes[C.get("id")];}if(this.get("autoDraw")){this._redraw();}return C;},removeAllShapes:function(){var C=this._shapes,D;for(D in C){if(C.hasOwnProperty(D)){C[D].destroy();}}this._shapes={};},clear:function(){this.removeAllShapes();},_removeChildren:function(C){if(C&&C.hasChildNodes()){var D;while(C.firstChild){D=C.firstChild;this._removeChildren(D);C.removeChild(D);}}},_toggleVisible:function(F){var E,D=this._shapes,C=F?"visible":"hidden";if(D){for(E in D){if(D.hasOwnProperty(E)){D[E].set("visible",F);}}}if(this._node){this._node.style.visibility=C;}},_getShapeClass:function(D){var C=this._shapeClass[D];if(C){return C;}return D;},_shapeClass:{circle:d.CanvasCircle,rect:d.CanvasRect,path:d.CanvasPath,ellipse:d.CanvasEllipse,pieslice:d.CanvasPieSlice},getShapeById:function(D){var C=this._shapes[D];return C;},batch:function(D){var C=this.get("autoDraw");this.set("autoDraw",false);D();this.set("autoDraw",C);},_getDocFrag:function(){if(!this._frag){this._frag=g.createDocumentFragment();}return this._frag;},_redraw:function(){var I=this.get("autoSize"),G=this.get("preserveAspectRatio"),J=this.get("resizeDown")?this._getUpdatedContentBounds():this._contentBounds,C,M,N,K,O,F,E=0,D=0,L,H=this.get("node");if(I){if(I=="sizeContentToGraphic"){C=J.right-J.left;M=J.bottom-J.top;N=parseFloat(A.getComputedStyle(H,"width"));K=parseFloat(A.getComputedStyle(H,"height"));L=new d.Matrix();if(G=="none"){O=N/C;F=K/M;}else{if(C/M!==N/K){if(C*K/M>N){O=F=N/C;D=this._calculateTranslate(G.slice(5).toLowerCase(),M*N/C,K);}else{O=F=K/M;E=this._calculateTranslate(G.slice(1,4).toLowerCase(),C*K/M,N);}}}A.setStyle(H,"transformOrigin","0% 0%");E=E-(J.left*O);D=D-(J.top*F);L.translate(E,D);L.scale(O,F);A.setStyle(H,"transform",L.toCSSText());}else{this.set("width",J.right);this.set("height",J.bottom);}}if(this._frag){this._node.appendChild(this._frag);this._frag=null;}},_calculateTranslate:function(C,F,E){var D=E-F,G;switch(C){case"mid":G=D*0.5;break;case"max":G=D;break;default:G=0;break;}return G;},addToRedrawQueue:function(C){var E,D;this._shapes[C.get("id")]=C;if(!this.get("resizeDown")){E=C.getBounds();D=this._contentBounds;D.left=D.left<E.left?D.left:E.left;D.top=D.top<E.top?D.top:E.top;D.right=D.right>E.right?D.right:E.right;D.bottom=D.bottom>E.bottom?D.bottom:E.bottom;this._contentBounds=D;}if(this.get("autoDraw")){this._redraw();}},_getUpdatedContentBounds:function(){var G,E,D,C=this._shapes,F={};for(E in C){if(C.hasOwnProperty(E)){D=C[E];G=D.getBounds();F.left=z.isNumber(F.left)?Math.min(F.left,G.left):G.left;F.top=z.isNumber(F.top)?Math.min(F.top,G.top):G.top;F.right=z.isNumber(F.right)?Math.max(F.right,G.right):G.right;F.bottom=z.isNumber(F.bottom)?Math.max(F.bottom,G.bottom):G.bottom;}}F.left=z.isNumber(F.left)?F.left:0;F.top=z.isNumber(F.top)?F.top:0;F.right=z.isNumber(F.right)?F.right:0;F.bottom=z.isNumber(F.bottom)?F.bottom:0;this._contentBounds=F;return F;},_toFront:function(D){var C=this.get("node");if(D instanceof d.CanvasShape){D=D.get("node");}if(C&&D){C.appendChild(D);}},_toBack:function(D){var C=this.get("node"),E;if(D instanceof d.CanvasShape){D=D.get("node");}if(C&&D){E=C.firstChild;if(E){C.insertBefore(D,E);}else{C.appendChild(D);}}}});d.CanvasGraphic=e;},"@VERSION@",{"requires":["graphics"]});