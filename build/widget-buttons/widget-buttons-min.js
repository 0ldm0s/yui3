YUI.add("widget-buttons",function(c){var i=c.Array,j=c.Lang,f=c.Object,a=c.Plugin.Button,d=c.ClassNameManager.getClassName,e=j.isArray,k=j.isNumber,b=j.isString,h=j.isValue;function g(){if(!this._stdModNode){c.error("WidgetStdMod must be added to the Widget before WidgetButtons.");}this._buttonsHandles={};}g.ATTRS={buttons:{getter:"_getButtons",setter:"_setButtons",value:{}},defaultButton:{readOnly:true,value:null}};g.CLASS_NAMES={button:d("button"),buttons:c.Widget.getClassName("buttons"),primary:d("button","primary")};g.HTML_PARSER={buttons:function(l){return this._parseButtons(l);}};g.NON_BUTTON_NODE_CFG=["action","classNames","context","events","isDefault","section"];g.prototype={BUTTONS:{},BUTTONS_TEMPLATE:"<span />",DEFAULT_BUTTONS_SECTION:c.WidgetStdMod.FOOTER,initializer:function(){this._mapButtons(this.get("buttons"));this._updateDefaultButton();this.after("buttonsChange",c.bind("_afterButtonsChange",this));c.after(this._bindUIButtons,this,"bindUI");c.after(this._syncUIButtons,this,"syncUI");},destructor:function(){f.each(this._buttonsHandles,function(l){l.detach();});delete this._buttonsHandles;delete this._buttonsMap;delete this._defaultButton;},addButton:function(m,p,l){var o=this.get("buttons"),n;if(!c.instanceOf(m,c.Node)){m=this._mergeButtonConfig(m);p||(p=m.section);}p||(p=this.DEFAULT_BUTTONS_SECTION);n=o[p]||(o[p]=[]);k(l)||(l=n.length);n.splice(l,0,m);this.set("buttons",o,{button:m,section:p,index:l,src:"add"});return this;},getButton:function(l,o){if(!h(l)){return;}var n=this._buttonsMap,m;o||(o=this.DEFAULT_BUTTONS_SECTION);if(k(l)){m=this.get("buttons");return m[o]&&m[o][l];}return arguments.length>1?n[o+":"+l]:n[l];},removeButton:function(m,o){if(!h(m)){return this;}var n=this.get("buttons"),l;if(k(m)){o||(o=this.DEFAULT_BUTTONS_SECTION);l=m;m=n[o][l];}else{if(b(m)){m=this.getButton.apply(this,arguments);}f.some(n,function(p,q){l=i.indexOf(p,m);if(l>-1){o=q;return true;}});}if(m&&l>-1){n[o].splice(l,1);this.set("buttons",n,{button:m,section:o,index:l,src:"remove"});}return this;},_bindUIButtons:function(){this.after("defaultButtonChange",c.bind("_afterDefaultButtonChange",this));this.after("visibleChange",c.bind("_afterVisibleChangeButtons",this));},_createButton:function(q){var n,m,t,p,s,o,l,r;if(c.instanceOf(q,c.Node)){return q.plug(a);}n=c.merge({context:this,events:"click",label:q.value},q);m=c.merge(n);t=g.NON_BUTTON_NODE_CFG;for(p=0,s=t.length;p<s;p+=1){delete m[t[p]];}q=a.createNode(m);l=n.context;o=n.action;if(b(o)){o=c.bind(o,l);}r=q.on(n.events,o,l);this._buttonsHandles[c.stamp(q,true)]=r;q.setData("name",this._getButtonName(n));q.setData("default",this._getButtonDefault(n));i.each(i(n.classNames),q.addClass,q);return q;},_getButtonContainer:function(o){var m=g.CLASS_NAMES.buttons,n=this.getStdModNode(o),l;l=n&&n.one("."+m);if(!l){l=c.Node.create(this.BUTTONS_TEMPLATE);l.addClass(m);this.setStdModContent(o,l,"after");}return l;},_getButtonDefault:function(l){var m=c.instanceOf(l,c.Node)?l.getData("default"):l.isDefault;if(b(m)){return m.toLowerCase()==="true";}return !!m;},_getButtonName:function(m){var l;if(c.instanceOf(m,c.Node)){l=m.getData("name")||m.get("name");}else{l=m&&(m.name||m.type);}return l;},_getButtons:function(m){var l={};f.each(m,function(n,o){l[o]=n.concat();});return l;},_mapButton:function(m,p){var o=this._buttonsMap,l=this._getButtonName(m),n=this._getButtonDefault(m);if(l){o[l]=m;o[p+":"+l]=m;}n&&(this._defaultButton=m);},_mapButtons:function(l){this._buttonsMap={};this._defaultButton=null;f.each(l,function(o,p){var n,m;for(n=0,m=o.length;n<m;n+=1){this._mapButton(o[n],p);}},this);},_mergeButtonConfig:function(m){m=b(m)?{name:m}:c.merge(m);var l=this._getButtonName(m),n=this.BUTTONS&&this.BUTTONS[l];if(n){c.mix(m,n,false,null,0,true);}return m;},_parseButtons:function(p){var m=null,r=g.CLASS_NAMES.button,l=g.CLASS_NAMES.buttons,o="."+l+" ."+r,y=["header","body","footer"],w=c.WidgetStdMod.SECTION_CLASS_NAMES,n,s,x,q,v,t;function u(D,C){var B=C.get("tagName").toLowerCase(),A=C.get(B==="input"?"value":"text"),z;z={name:this._getButtonName(C),disabled:!!C.get("disabled"),isDefault:this._getButtonDefault(C),srcNode:C};A&&(z.label=A);D.push(z);}for(n=0,s=y.length;n<s;n+=1){x=y[n];q=p.one("."+w[x]);v=q&&q.all(o);if(!v||v.isEmpty()){continue;}t=[];v.each(c.bind(u,this,t));m||(m={});m[x]=t;}return m;},_setButtons:function(n){var m=this.DEFAULT_BUTTONS_SECTION,o={};function l(s,u){if(!e(s)){return;}var r,p,q,t;for(r=0,p=s.length;r<p;r+=1){q=s[r];t=u;if(!c.instanceOf(q,c.Node)){q=this._mergeButtonConfig(q);t||(t=q.section);}q=this._createButton(q);t||(t=m);(o[t]||(o[t]=[])).push(q);}}if(e(n)){l.call(this,n);}else{f.each(n,l,this);}return o;},_syncUIButtons:function(){this._uiSetButtons(this.get("buttons"));this._uiSetDefaultButton(this.get("defaultButton"));this._uiSetVisibleButtons(this.get("visible"));},_uiInsertButton:function(n,q,m){var p=g.CLASS_NAMES.button,l=this._getButtonContainer(q),o=l.all("."+p);l.insertBefore(n,o.item(m));this.fire("contentUpdate");},_uiRemoveButton:function(o,l){var n=c.stamp(o,this),m=this._buttonsHandles,p=m[n];p&&p.detach();delete m[n];o.remove();l||(l={});if(!l.silent){this.fire("contentUpdate");}},_uiSetButtons:function(m){var n=g.CLASS_NAMES.button,l=false;f.each(m,function(s,v){var p=this._getButtonContainer(v),t=p.all("."+n),r,o,q,u;for(r=0,o=s.length;r<o;r+=1){q=s[r];u=t?t.indexOf(q):-1;if(u>-1){t.splice(u,1);if(u!==r){p.insertBefore(q,r+1);l=true;}}else{p.appendChild(q);l=true;}}t.each(function(w){this._uiRemoveButton(w,{silent:true});l=true;},this);},this);if(l){this.fire("contentUpdate");}},_uiSetDefaultButton:function(n,m){var l=g.CLASS_NAMES.primary;n&&n.addClass(l);m&&m.removeClass(l);},_uiSetVisibleButtons:function(m){if(!m){return;}var l=this.get("defaultButton");if(l){l.focus();}},_unMapButton:function(n,p){var o=this._buttonsMap,m=this._getButtonName(n),l;if(m){if(o[m]===n){delete o[m];}l=p+":"+m;if(o[l]===n){delete o[l];}}if(this._defaultButton===n){this._defaultButton=null;}},_updateDefaultButton:function(){var l=this._defaultButton;
if(this.get("defaultButton")!==l){this._set("defaultButton",l);}},_afterButtonsChange:function(p){var n=p.newVal,o=p.section,l=p.index,q=p.src,m;if(q==="add"){m=n[o][l];this._mapButton(m,o);this._updateDefaultButton();this._uiInsertButton(m,o,l);return;}if(q==="remove"){m=p.button;this._unMapButton(m,o);this._updateDefaultButton();this._uiRemoveButton(m);return;}this._mapButtons(n);this._updateDefaultButton();this._uiSetButtons(n);},_afterDefaultButtonChange:function(l){this._uiSetDefaultButton(l.newVal,l.prevVal);},_afterVisibleChangeButtons:function(l){this._uiSetVisibleButtons(l.newVal);}};c.WidgetButtons=g;},"@VERSION@",{requires:["button-plugin","cssbutton","widget-stdmod"]});