YUI.add("autocomplete-base",function(F){var I=F.Lang,P=F.Array,H=F.Object,R=I.isArray,D=I.isFunction,Q=I.isObject,S=I.isString,V=I.trim,L=F.Attribute.INVALID_VALUE,N="_functionValidator",Z="_sourceSuccess",C="allowBrowserAutocomplete",G="inputNode",X="query",E="queryDelimiter",B="requestTemplate",K="results",M="resultListLocator",J="value",T="valueChange",A="clear",U=X,O=K;function W(){F.before(this._bindUIACBase,this,"bindUI");F.before(this._destructorACBase,this,"destructor");F.before(this._syncUIACBase,this,"syncUI");this.publish(A,{defaultFn:this._defClearFn,queueable:true});this.publish(U,{defaultFn:this._defQueryFn,queueable:true});this.publish(O,{defaultFn:this._defResultsFn,queueable:true});}W.ATTRS={allowBrowserAutocomplete:{value:false},inputNode:{setter:F.one,writeOnce:"initOnly"},maxResults:{value:0},minQueryLength:{value:1},query:{readOnly:true,value:null},queryDelay:{value:100},queryDelimiter:{value:null},requestTemplate:{setter:"_setRequestTemplate",value:null},resultFilters:{setter:"_setResultFilters",value:[]},resultFormatter:{validator:N},resultHighlighter:{setter:"_setResultHighlighter"},resultListLocator:{setter:"_setLocator"},results:{readOnly:true,value:[]},resultTextLocator:{setter:"_setLocator"},source:{setter:"_setSource"},value:{value:""}};W.CSS_PREFIX="ac";W.UI_SRC=(F.Widget&&F.Widget.UI_SRC)||"ui";W.prototype={sendRequest:function(b,c){var Y,a=this.get("source");if(a){if(b||b===""){this._set(X,b);}else{b=this.get(X);}if(!c){c=this.get(B);}Y=c?c(b):b;a.sendRequest({request:Y,callback:{success:F.bind(this._onResponse,this,b)}});}return this;},_bindUIACBase:function(){var Y=this.get(G);if(!Y){F.error("No inputNode specified.");}this._acBaseEvents=[Y.on(T,this._onInputValueChange,this),this.after(C+"Change",this._syncBrowserAutocomplete),this.after(T,this._afterValueChange)];},_destructorACBase:function(){var Y=this._acBaseEvents;while(Y&&Y.length){Y.pop().detach();}},_syncUIACBase:function(){this._syncBrowserAutocomplete();this.set(J,this.get(G).get(J));},_createArraySource:function(a){var Y=this;return{sendRequest:function(b){Y[Z](a.concat(),b);}};},_createJSONPSource:function(d){var a={},b={},c=this,Y,e;b.sendRequest=function(g){var f=function(h){var i=h.request;if(a[i]){c[Z](a[i],h);}else{d._config.on.success=function(j){a[i]=j;c[Z](j,h);};d.send(i);}};Y=g;if(!e){e=true;F.use("jsonp",function(){if(!(d instanceof F.JSONPRequest)){d=new F.JSONPRequest(d,{format:F.bind(c._jsonpFormatter,c)});}b.sendRequest=f;f(Y);});}};return b;},_createObjectSource:function(Y){return{sendRequest:function(b){var c=b.request,a=this;a[Z](H.owns(Y,c)?Y[c]:[],b);}};},_createStringSource:function(Y){if(/^(?:select|use|set)\s+/i.test(Y)){return this._createYQLSource(Y);}else{return this._createJSONPSource(Y);}},_createYQLSource:function(c){var a={},d={},b=this,Y,e;if(!this.get(M)){this.set(M,this._defaultYQLLocator);}d.sendRequest=function(g){var f=function(h){var i=h.request;if(!b.get(B)){i=encodeURIComponent(i);}if(a[i]){b[Z](a[i],h);}else{F.YQL(I.sub(c,{query:i}),function(j){a[i]=j;b[Z](j,h);});}};Y=g;if(!e){e=true;F.use("yql",function(){d.sendRequest=f;f(Y);});}};return d;},_defaultYQLLocator:function(a){var b=a&&a.query&&a.query.results,Y;if(b&&Q(b)){Y=H.values(b)||[];b=Y.length===1?Y[0]:Y;}else{b=[];}return b;},_functionValidator:function(Y){return Y===null||D(Y);},_getObjectValue:function(c,b){if(!c){return;}for(var a=0,Y=b.length;c&&a<Y;a++){c=c[b[a]];}return c;},_jsonpFormatter:function(Y,a,b){var c=this.get(B);if(c){Y=Y+c(b);}return I.sub(Y,{callback:a,query:c?b:encodeURIComponent(b)});},_parseResponse:function(b,Y,r){var g={data:r,query:b,results:[]},a,e,o,f=Y&&Y.results,h=[],c,k,q,l,m,j=this.get(M),n,p,d;if(f&&j){f=j(f);}if(f){c=this.get("resultFilters");k=this.get("resultFormatter");q=this.get("resultHighlighter");n=this.get("maxResults");p=this.get("resultTextLocator");if(p){e=P.map(f,p);d=P.hash(e,f);}else{e=f;}for(l=0,m=c.length;l<m;++l){e=c[l](b,e);if(!e||!e.length){break;}}if(p){o=e;e=[];for(l=0,m=o.length;l<m;++l){e.push(d[o[l]]);}}else{o=[].concat(e);}a=q?q(b,o):[].concat(o);if(k){a=k(b,e,a,o);}m=n>0?Math.min(n,a.length):a.length;for(l=0;l<m;++l){h[l]={display:a[l],raw:e[l],text:o[l]};}g.results=h;}this.fire(O,g);},_parseValue:function(Y){var a=this.get(E);if(a){Y=Y.split(a);Y=Y[Y.length-1];}return I.trimLeft(Y);},_setLocator:function(Y){if(this[N](Y)){return Y;}var a=this;Y=Y.toString().split(".");return function(b){return b&&a._getObjectValue(b,Y);};},_setRequestTemplate:function(Y){if(this[N](Y)){return Y;}Y=Y.toString();return function(a){return I.sub(Y,{query:encodeURIComponent(a)});};},_setResultFilters:function(b){var Y,a;if(b===null){return[];}Y=F.AutoCompleteFilters;a=function(c){if(D(c)){return c;}if(S(c)&&Y&&D(Y[c])){return Y[c];}return false;};if(R(b)){b=P.map(b,a);return P.every(b,function(c){return !!c;})?b:L;}else{b=a(b);return b?[b]:L;}},_setResultHighlighter:function(Y){var a;if(this._functionValidator(Y)){return Y;}a=F.AutoCompleteHighlighters;if(S(Y)&&a&&D(a[Y])){return a[Y];}return L;},_setSource:function(Y){if((Y&&D(Y.sendRequest))||Y===null){return Y;}else{if(S(Y)){return this._createStringSource(Y);}else{if(R(Y)){return this._createArraySource(Y);}else{if(Q(Y)){return this._createObjectSource(Y);}else{if(F.JSONPRequest&&Y instanceof F.JSONPRequest){return this._createJSONPSource(Y);}}}}}return L;},_sourceSuccess:function(a,Y){Y.callback.success({data:a,response:{results:a}});},_syncBrowserAutocomplete:function(){var Y=this.get(G);if(Y.get("nodeName").toLowerCase()==="input"){Y.setAttribute("autocomplete",this.get(C)?"on":"off");}},_updateValue:function(a){var c=this.get(E),b,Y,d;a=I.trimLeft(a);if(c){b=V(c);d=P.map(V(this.get(J)).split(c),V);Y=d.length;if(Y>1){d[Y-1]=a;a=d.join(b+" ");}a=a+b+" ";}this.set(J,a);},_afterValueChange:function(f){var a,b,Y=f.newVal,d,c;if(f.src!==W.UI_SRC){this._inputNode.set(J,Y);return;}d=this._parseValue(Y)||"";if(d.length>=this.get("minQueryLength")){a=this.get("queryDelay");c=this;b=function(){c.fire(U,{inputValue:Y,query:d});
};if(a){clearTimeout(this._delay);this._delay=setTimeout(b,a);}else{b();}}else{clearTimeout(this._delay);this.fire(A);}},_onInputValueChange:function(a){var Y=a.newVal;if(Y===this.get(J)){return;}this.set(J,Y,{src:W.UI_SRC});},_onResponse:function(Y,a){if(Y===this.get(X)){this._parseResponse(Y,a.response,a.data);}},_defClearFn:function(){this._set(X,null);this._set(K,[]);},_defQueryFn:function(a){var Y=a.query;this.sendRequest(Y);},_defResultsFn:function(Y){this._set(K,Y[K]);}};F.AutoCompleteBase=W;},"@VERSION@",{requires:["array-extras","base-build","event-valuechange","node-base"],optional:["jsonp","yql"]});YUI.add("autocomplete-list",function(B){var I=B.Lang,Z=B.Node,N=B.Array,H=40,K=13,O=27,S=9,R=38,V="_CLASS_ITEM",W="_CLASS_ITEM_ACTIVE",D="_CLASS_ITEM_HOVER",X="_SELECTOR_ITEM",F="activeItem",L="alwaysShowList",Q="circular",U="hoveredItem",M="id",E="item",C="list",a="result",J="results",T="visible",G="width",P="select",A=B.Base.create("autocompleteList",B.Widget,[B.AutoCompleteBase,B.WidgetPosition,B.WidgetPositionAlign,B.WidgetStack],{ARIA_TEMPLATE:"<div/>",ITEM_TEMPLATE:"<li/>",LIST_TEMPLATE:"<ul/>",initializer:function(){var b={},c={},Y=this.get("inputNode");if(!Y){B.error("No inputNode specified.");}this._inputNode=Y;this._listEvents=[];this.DEF_PARENT_NODE=Y.get("parentNode");b[H]=this._keyDown;c[K]=this._keyEnter;c[O]=this._keyEsc;c[S]=this._keyTab;c[R]=this._keyUp;this._keys=b;this._keysVisible=c;this[V]=this.getClassName(E);this[W]=this.getClassName(E,"active");this[D]=this.getClassName(E,"hover");this[X]="."+this[V];if(!this.get("align.node")){this.set("align.node",Y);}if(!this.get(G)){this.set(G,Y.get("offsetWidth"));}this.publish(P,{defaultFn:this._defSelectFn});},destructor:function(){while(this._listEvents.length){this._listEvents.pop().detach();}},bindUI:function(){this._bindInput();this._bindList();},renderUI:function(){var e=this._createAriaNode(),b=this.get("contentBox"),d=this._inputNode,c=this.get("listNode"),Y=d.get("parentNode");if(!c){c=this._createListNode();b.append(c);}d.addClass(this.getClassName("input")).set("aria-autocomplete",C);Y.set("role","combobox").append(e);this._ariaNode=e;this._contentBox=b;this._listNode=c;this._parentNode=Y;},syncUI:function(){this._syncResults();this._syncVisibility();},hide:function(){return this.get(L)?this:this.set(T,false);},selectItem:function(Y){if(Y){if(!Y.hasClass(this[V])){return this;}}else{Y=this.get(F);if(!Y){return this;}}this.fire(P,{itemNode:Y,result:Y.getData(a)});return this;},_activateNextItem:function(){var b=this.get(F),Y;if(b){Y=b.next(this[X])||(this.get(Q)?null:b);}else{Y=this._getFirstItemNode();}this.set(F,Y);return this;},_activatePrevItem:function(){var b=this.get(F),Y=b?b.previous(this[X]):this.get(Q)&&this._getLastItemNode();this.set(F,Y||null);return this;},_add:function(Y){var b=[];N.each(I.isArray(Y)?Y:[Y],function(c){b.push(this._createItemNode(c).setData(a,c));},this);b=B.all(b);this._listNode.append(b.toFrag());return b;},_ariaSay:function(c,Y){var b=this.get("strings."+c);this._ariaNode.setContent(Y?I.sub(b,Y):b);},_bindInput:function(){var Y=this._inputNode;this._listEvents.concat([Y.on("blur",this._onInputBlur,this),Y.on(B.UA.gecko?"keypress":"keydown",this._onInputKey,this)]);},_bindList:function(){this._listEvents.concat([this.after("mouseover",this._afterMouseOver),this.after("mouseout",this._afterMouseOut),this.after("activeItemChange",this._afterActiveItemChange),this.after("alwaysShowListChange",this._afterAlwaysShowListChange),this.after("hoveredItemChange",this._afterHoveredItemChange),this.after("resultsChange",this._afterResultsChange),this.after("visibleChange",this._afterVisibleChange),this._listNode.delegate("click",this._onItemClick,this[X],this)]);},_clear:function(){this.set(F,null);this._set(U,null);this._listNode.get("children").remove(true);},_createAriaNode:function(){var Y=Z.create(this.ARIA_TEMPLATE);return Y.addClass(this.getClassName("aria")).setAttrs({role:"status","aria-live":"polite"});},_createItemNode:function(Y){var b=Z.create(this.ITEM_TEMPLATE);return b.addClass(this[V]).setAttrs({id:B.stamp(b),role:"option"}).setAttribute("data-text",Y.text).append(Y.display);},_createListNode:function(){var Y=Z.create(this.LIST_TEMPLATE);return Y.addClass(this.getClassName(C)).setAttrs({id:B.stamp(Y),role:"listbox"});},_keyDown:function(){if(this.get(T)){this._activateNextItem();}else{this.show();}},_keyEnter:function(){this.selectItem();},_keyEsc:function(){this.hide();},_keyTab:function(){if(this.get("tabSelect")){this.selectItem();}},_keyUp:function(){this._activatePrevItem();},_getLastItemNode:function(){return this._listNode.one(this[X]+":last-child");},_getFirstItemNode:function(){return this._listNode.one(this[X]);},_syncResults:function(b){var Y;if(!b){b=this.get(J);}this._clear();if(b.length){Y=this._add(b);this._ariaSay("ITEMS_AVAILABLE");}if(this.get("activateFirstItem")&&!this.get(F)){this.set(F,this._getFirstItemNode());}},_syncVisibility:function(Y){if(this.get(L)){this.set(T,true);return;}if(typeof Y==="undefined"){Y=this.get(T);}this._contentBox.set("aria-hidden",!Y);if(!Y){this.set(F,null);this._set(U,null);}},_afterActiveItemChange:function(b){var Y=b.newVal,c=b.prevVal;if(c){c.removeClass(this[W]);}if(Y){Y.addClass(this[W]);this._inputNode.set("aria-activedescendant",Y.get(M));}},_afterAlwaysShowListChange:function(Y){this.set(T,Y.newVal||this.get(J).length>0);},_afterHoveredItemChange:function(b){var Y=b.newVal,c=b.prevVal;if(c){c.removeClass(this[D]);}if(Y){Y.addClass(this[D]);}},_afterMouseOver:function(Y){var b=Y.domEvent.target.ancestor(this[X],true);this._mouseOverList=true;if(b){this._set(U,b);}},_afterMouseOut:function(){this._mouseOverList=false;this._set(U,null);},_afterResultsChange:function(Y){this._syncResults(Y.newVal);if(!this.get(L)){this.set(T,!!Y.newVal.length);}},_afterVisibleChange:function(Y){this._syncVisibility(!!Y.newVal);},_onInputBlur:function(Y){if(this._mouseOverList&&this._lastInputKey!==S){this._inputNode.focus();}else{this.hide();
}},_onInputKey:function(c){var Y,b=c.keyCode;this._lastInputKey=b;if(this.get(J).length){Y=this._keys[b];if(!Y&&this.get(T)){Y=this._keysVisible[b];}if(Y){if(Y.call(this,c)!==false){c.preventDefault();}}}},_onItemClick:function(Y){var b=Y.currentTarget;Y.preventDefault();this.set(F,b);this.selectItem(b);},_defSelectFn:function(Y){var b=Y.result.text;this._inputNode.focus();this._updateValue(b);this._ariaSay("ITEM_SELECTED",{item:b});this.hide();}},{ATTRS:{activateFirstItem:{value:false},activeItem:{setter:B.one,value:null},align:{value:{points:["tl","bl"]}},alwaysShowList:{value:false},circular:{value:true},hoveredItem:{readOnly:true,value:null},strings:{value:{ITEM_SELECTED:"{item} selected.",ITEMS_AVAILABLE:"Suggestions are available. Use the up and down arrow keys to select suggestions."}},tabSelect:{value:true},visible:{value:false}},CSS_PREFIX:B.ClassNameManager.getClassName("aclist"),HTML_PARSER:{listNode:function(){return this.getClassName(C);}}});B.AutoCompleteList=A;B.AutoComplete=A;},"@VERSION@",{requires:["autocomplete-base","widget","widget-position","widget-position-align","widget-stack"],skinnable:true});YUI.add("autocomplete",function(A){},"@VERSION@",{use:["autocomplete-base","autocomplete-list"]});