YUI.add("autocomplete-base",function(E){var H=E.Lang,O=E.Array,G=E.Object,Q=H.isArray,C=H.isFunction,P=H.isObject,T=H.trim,J=E.Attribute.INVALID_VALUE,M="_functionValidator",W="_sourceSuccess",F="inputNode",V="query",D="queryDelimiter",B="requestTemplate",K="results",L="resultListLocator",I="value",R="valueChange",A="clear",S=V,N=K;function U(){this.publish(A,{defaultFn:this._defClearFn,queueable:true});this.publish(S,{defaultFn:this._defQueryFn,queueable:true});this.publish(N,{defaultFn:this._defResultsFn,queueable:true});}U.ATTRS={allowBrowserAutocomplete:{value:false,writeOnce:"initOnly"},inputNode:{setter:E.one,writeOnce:"initOnly"},maxResults:{value:0},minQueryLength:{value:1},query:{readOnly:true,value:null},queryDelay:{value:100},queryDelimiter:{value:null},requestTemplate:{setter:"_setRequestTemplate",value:null},resultFilters:{validator:Q,value:[]},resultFormatter:{validator:M},resultHighlighter:{validator:M},resultListLocator:{setter:"_setLocator"},results:{readOnly:true,value:[]},resultTextLocator:{setter:"_setLocator"},source:{setter:"_setSource"},value:{value:""}};U.CSS_PREFIX="ac";U.UI_SRC=(E.Widget&&E.Widget.UI_SRC)||"ui";U.prototype={bindInput:function(){var X=this.get(F);if(!X){E.error("No inputNode specified.");}this.unbindInput();this._inputEvents=[X.on(R,this._onInputValueChange,this),this.after(R,this._afterValueChange,this)];},syncInput:function(){var X=this.get(F);if(X.get("nodeName").toLowerCase()==="input"){X.setAttribute("autocomplete",this.get("allowBrowserAutocomplete")?"on":"off");}this.set(I,X.get(I));},unbindInput:function(){var X=this._inputEvents;while(X&&X.length){X.pop().detach();}},_createArraySource:function(Y){var X=this;return{sendRequest:function(Z){X[W](Y.concat(),Z);}};},_createJSONPSource:function(Z){var X={},Y=this;return{sendRequest:function(a){var b=a.request;if(X[b]){Y[W](X[b],a);}else{Z._config.on.success=function(c){X[b]=c;Y[W](c,a);};Z.send(b);}}};},_createObjectSource:function(X){return{sendRequest:function(Z){var a=Z.request,Y=this;Y[W](G.owns(X,a)?X[a]:[],Z);}};},_createStringSource:function(Y){var X=this;if(/^select\s+/i.test(Y)){if(E.YQLRequest){return this._createYQLSource(Y);}else{E.error("yql module is not loaded");return J;}}else{if(E.JSONPRequest){return this._createJSONPSource(new E.JSONPRequest(Y,{format:function(Z,a,b){return H.sub(Z,{callback:a,query:X.get(B)?b:encodeURIComponent(b)});}}));}else{E.error("jsonp module is not loaded");return J;}}},_createYQLSource:function(Z){var X={},Y=this;if(!this.get(L)){this.set(L,this._defaultYQLLocator);}return{sendRequest:function(a){var b=a.request;if(!Y.get(B)){b=encodeURIComponent(b);}if(X[b]){Y[W](X[b],a);}else{E.YQL(H.sub(Z,{query:b}),function(c){X[b]=c;Y[W](c,a);});}}};},_defaultYQLLocator:function(Y){var Z=Y&&Y.query&&Y.query.results,X;if(Z&&P(Z)){X=G.values(Z)||[];Z=X.length===1?X[0]:X;}else{Z=[];}return Z;},_functionValidator:function(X){return X===null||C(X);},_getObjectValue:function(a,Z){if(!a){return;}for(var Y=0,X=Z.length;a&&Y<X;Y++){a=a[Z[Y]];}return a;},_parseResponse:function(Z,X,p){var e={data:p,query:Z,results:[]},Y,c,m,d=X&&X.results,f=[],a,h,o,j,k,g=this.get(L),l,n,b;if(d&&g){d=g(d);}if(d){a=this.get("resultFilters");h=this.get("resultFormatter");o=this.get("resultHighlighter");l=this.get("maxResults");n=this.get("resultTextLocator");if(n){c=O.map(d,n);b=O.hash(c,d);}else{c=d;}for(j=0,k=a.length;j<k;++j){c=a[j](Z,c);if(!c||!c.length){break;}}if(n){m=c;c=[];for(j=0,k=m.length;j<k;++j){c.push(b[m[j]]);}}else{m=[].concat(c);}Y=o?o(Z,m):[].concat(m);if(h){Y=h(Z,c,Y,m);}k=l>0?Math.min(l,Y.length):Y.length;for(j=0;j<k;++j){f[j]={display:Y[j],raw:c[j],text:m[j]};}e.results=f;}this.fire(N,e);},_parseValue:function(X){var Y=this.get(D);if(Y){X=X.split(Y);X=X[X.length-1];}return this._trimLeft(X);},_setLocator:function(X){if(this[M](X)){return X;}var Y=this;X=X.toString().split(".");return function(Z){return Z&&Y._getObjectValue(Z,X);};},_setRequestTemplate:function(X){if(this[M](X)){return X;}X=X.toString();return function(Y){return H.sub(X,{query:encodeURIComponent(Y)});};},_setSource:function(X){if((X&&C(X.sendRequest))||X===null){return X;}else{if(typeof X==="string"){return this._createStringSource(X);}else{if(Q(X)){return this._createArraySource(X);}else{if(P(X)){return this._createObjectSource(X);}else{if(E.JSONPRequest&&X instanceof E.JSONPRequest){return this._createJSONPSource(X);}}}}}return J;},_sourceSuccess:function(Y,X){X.callback.success({data:Y,response:{results:Y}});},_trimLeft:String.prototype.trimLeft?function(X){return X.trimLeft();}:function(X){return X.replace(/^\s+/,"");},_updateValue:function(Y){var a=this.get(D),Z,X,b;Y=this._trimLeft(Y);if(a){Z=T(a);b=O.map(T(this.get(I)).split(a),T);X=b.length;if(X>1){b[X-1]=Y;Y=b.join(Z+" ");}Y=Y+Z+" ";}this.set(I,Y);},_afterValueChange:function(c){var Y,Z,X=c.newVal,b,a;if(c.src!==U.UI_SRC){this._inputNode.set(I,X);return;}b=this._parseValue(X);if(b&&b.length>=this.get("minQueryLength")){Y=this.get("queryDelay");a=this;Z=function(){a.fire(S,{inputValue:X,query:b});};if(Y){clearTimeout(this._delay);this._delay=setTimeout(Z,Y);}else{Z();}}else{clearTimeout(this._delay);this.fire(A);}},_onInputValueChange:function(Y){var X=Y.newVal;if(X===this.get(I)){return;}this.set(I,X,{src:U.UI_SRC});},_onResponse:function(X,Y){if(X&&X===this.get(V)){this._parseResponse(X,Y.response,Y.data);}},_defClearFn:function(){this._set(V,null);this._set(K,[]);},_defQueryFn:function(b){var Z=b.query,X,a,Y=this.get("source");this._set(V,Z);if(Z&&Y){a=this.get(B);X=a?a(Z):Z;Y.sendRequest({request:X,callback:{success:E.bind(this._onResponse,this,Z)}});}},_defResultsFn:function(X){this._set(K,X[K]);}};E.AutoCompleteBase=U;},"@VERSION@",{requires:["array-extras","base-build","event-valuechange","node-base"],optional:["jsonp","yql"]});YUI.add("autocomplete-list",function(B){var X=B.Node,L=B.Array,H=40,J=13,N=27,R=9,Q=38,U="_CLASS_ITEM",V="_CLASS_ITEM_ACTIVE",D="_CLASS_ITEM_HOVER",W="_SELECTOR_ITEM",F="activeItem",K="alwaysShowList",P="circular",T="hoveredItem",M="id",E="item",C="list",Z="result",I="results",S="visible",G="width",O="select",A=B.Base.create("autocompleteList",B.Widget,[B.AutoCompleteBase,B.WidgetPosition,B.WidgetPositionAlign,B.WidgetStack],{ITEM_TEMPLATE:"<li/>",LIST_TEMPLATE:"<ul/>",initializer:function(){this.publish(O,{defaultFn:this._defSelectFn});
this._events=[];this._inputNode=this.get("inputNode");this[U]=this.getClassName(E);this[V]=this.getClassName(E,"active");this[D]=this.getClassName(E,"hover");this[W]="."+this[U];if(!this._inputNode){B.error("No inputNode specified.");}if(!this.get("align.node")){this.set("align.node",this._inputNode);}if(!this.get(G)){this.set(G,this._inputNode.get("offsetWidth"));}},destructor:function(){this.unbindInput();while(this._events.length){this._events.pop().detach();}},bindUI:function(){this._bindInput();this._bindList();},renderUI:function(){var Y=this.get("contentBox"),a=this.get("listNode");if(!a){a=X.create(this.LIST_TEMPLATE);a.addClass(this.getClassName(C)).setAttrs({id:B.stamp(a),role:"listbox"});Y.append(a);}this._inputNode.addClass(this.getClassName("input")).setAttrs({"aria-autocomplete":C,"aria-live":"polite","aria-owns":a.get(M),role:"combobox"});if(this.get(K)){this.set(S,true);}this._contentBox=Y;this._listNode=a;},syncUI:function(){this.syncInput();this._syncResults();this._syncVisibility();},hide:function(){return this.get(K)?this:this.set(S,false);},selectItem:function(Y){if(Y){if(!Y.hasClass(this[U])){return;}}else{Y=this.get(F);if(!Y){return;}}this.fire(O,{itemNode:Y,result:Y.getData(Z)});return this;},show:function(){return this.set(S,true);},_activateNextItem:function(){var a=this.get(F),Y;Y=(a&&a.next(this[W]))||this.get(P)&&this._getFirstItemNode();if(Y){this._set(F,Y);}return this;},_activatePrevItem:function(){var a=this.get(F),Y;Y=(a&&a.previous(this[W]))||this.get(P)&&this._getLastItemNode();if(Y){this._set(F,Y);}return this;},_add:function(Y){var a=[];L.each(B.Lang.isArray(Y)?Y:[Y],function(b){a.push(this._createItemNode(b).setData(Z,b));},this);a=B.all(a);this._listNode.append(a.toFrag());return a;},_bindInput:function(){var Y=this._inputNode;this.bindInput();this._events.concat([Y.on("blur",this._onInputBlur,this),Y.on(B.UA.gecko?"keypress":"keydown",this._onInputKey,this)]);},_bindList:function(){this._events.concat([this.after("mouseover",this._afterMouseOver),this.after("mouseout",this._afterMouseOut),this.after("activeItemChange",this._afterActiveItemChange),this.after("alwaysShowListChange",this._afterAlwaysShowListChange),this.after("hoveredItemChange",this._afterHoveredItemChange),this.after("resultsChange",this._afterResultsChange),this.after("visibleChange",this._afterVisibleChange),this._listNode.delegate("click",this._onItemClick,this[W],this)]);},_clear:function(){this._set(F,null);this._set(T,null);this._listNode.get("children").remove(true);},_createItemNode:function(Y){var a=X.create(this.ITEM_TEMPLATE);return a.addClass(this[U]).setAttrs({id:B.stamp(a),role:"option"}).append(Y.display);},_getLastItemNode:function(){return this._listNode.one(this[W]+":last-child");},_getFirstItemNode:function(){return this._listNode.one(this[W]);},_syncResults:function(a){var Y;if(!a){a=this.get(I);}this._clear();if(a.length){Y=this._add(a);}if(this.get("activateFirstItem")&&!this.get(F)){this._set(F,this._getFirstItemNode());}},_syncVisibility:function(Y){if(typeof Y==="undefined"){Y=this.get(S);}this._contentBox.set("aria-hidden",!Y);if(!Y){this._set(F,null);this._set(T,null);}},_afterActiveItemChange:function(a){var Y=a.newVal,b=a.prevVal;if(b){b.removeClass(this[V]);}if(Y){Y.addClass(this[V]);this._inputNode.set("aria-activedescendant",Y.get(M));}},_afterAlwaysShowListChange:function(Y){this.set(S,Y.newVal||this.get(I).length>0);},_afterHoveredItemChange:function(a){var Y=a.newVal,b=a.prevVal;if(b){b.removeClass(this[D]);}if(Y){Y.addClass(this[D]);}},_afterMouseOver:function(Y){var a=Y.domEvent.target.ancestor(this[W],true);this._mouseOverList=true;if(a){this._set(T,a);}},_afterMouseOut:function(){this._mouseOverList=false;this._set(T,null);},_afterResultsChange:function(Y){this._syncResults(Y.newVal);if(!this.get(K)){this.set(S,!!Y.newVal.length);}},_afterVisibleChange:function(Y){this._syncVisibility(!!Y.newVal);},_onInputBlur:function(Y){if(this._mouseOverList&&this._lastInputKey!==R){this._inputNode.focus();}else{this.hide();}},_onInputKey:function(b){var Y,a=b.keyCode,c;this._lastInputKey=a;if(!this.get(I).length){return;}c=this.get(S);if(a===H){Y=1;if(!c){this.show();}this._activateNextItem();}if(c){switch(a){case J:Y=1;this.selectItem();break;case N:Y=1;this.hide();break;case R:if(this.get("tabSelect")){Y=1;this.selectItem();}break;case Q:Y=1;this._activatePrevItem();break;}}if(Y){b.preventDefault();}},_onItemClick:function(Y){var a=Y.currentTarget;Y.preventDefault();this._set(F,a);this.selectItem(a);},_defSelectFn:function(Y){this._inputNode.focus();this._updateValue(Y.result.text);this.hide();}},{ATTRS:{activateFirstItem:{value:false},activeItem:{readOnly:true,value:null},align:{value:{points:["tl","bl"]}},alwaysShowList:{value:false},circular:{value:true},hoveredItem:{readOnly:true,value:null},tabSelect:{value:true},visible:{value:false}},CSS_PREFIX:B.ClassNameManager.getClassName("aclist"),HTML_PARSER:{listNode:function(){return this.getClassName(C);}}});B.AutoCompleteList=A;B.AutoComplete=A;},"@VERSION@",{requires:["autocomplete-base","widget","widget-position","widget-position-align","widget-stack"],skinnable:true});YUI.add("autocomplete",function(A){},"@VERSION@",{use:["autocomplete-base","autocomplete-list"]});