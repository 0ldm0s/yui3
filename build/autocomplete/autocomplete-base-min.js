YUI.add("autocomplete-base",function(E){var G=E.Lang,C=G.isFunction,N=G.isNumber,B="allowBrowserAutocomplete",K="dataSource",F="inputNode",S="minQueryLength",I="autocompleteBase",R="query",O="queryDelay",A="requestTemplate",H="resultFilters",D="resultHighlighter",M="valueChange",P=R,J="results",L=M;function Q(){Q.superclass.constructor.apply(this,arguments);}E.AutoCompleteBase=E.extend(Q,E.Base,{initializer:function(U){var T=this.get(F);if(!T){E.error("No input node specified.");}if(T.get("nodeName").toLowerCase()==="input"){T.setAttribute("autocomplete",this.get(B)?"on":"off");}this.publish(P,{defaultFn:this._defQueryFn,queueable:true});this.publish(J,{queueable:true});this.publish(L,{preventable:false});this._events=[T.on(M,this._onValueChange,this)];},destructor:function(){while(this._events.length){this._events.pop().detach();}},_parseValue:function(T){return T;},_onResponse:function(Z){var X,U,W,T,Y,V=Z&&Z.response&&Z.response.results;if(V){Y=Z.callback.query;if(Y===this.get(R)){X=this.get(H)||[];U=this.get(D);if(U){X=X.concat([U]);}for(W=0,T=X.length;W<T;++W){V=X[W](Y,V);}this.fire(J,{data:Z.data,query:Y,results:V});}}},_onValueChange:function(Y){var T,U,X=Y.newVal,W=this._parseValue(X),V;this.fire(L,{newVal:X,prevVal:Y.prevVal});if(W.length>=this.get(S)){T=this.get(O);V=this;U=function(){V.fire(P,{inputValue:X,query:W});};if(T){clearTimeout(this._delay);this._delay=setTimeout(U,T);}else{U();}}},_defQueryFn:function(U){var V=this.get(K),T=U.query;this._set(R,T);if(V){V.sendRequest({request:this.get(A)(T),callback:{query:T,success:E.bind(this._onResponse,this)}});}}},{NAME:I,ATTRS:{allowBrowserAutocomplete:{validator:G.isBoolean,value:false,writeOnce:"initOnly"},dataSource:{validator:function(T){return(T&&C(T.sendRequest))||T===null;}},inputNode:{setter:E.one,writeOnce:"initOnly"},minQueryLength:{validator:N,value:1},query:{readOnly:true,value:null},queryDelay:{validator:function(T){return N(T)&&T>=0;},value:150},requestTemplate:{setter:function(T){if(C(T)){return T;}T=T.toString();return function(U){return T.replace(/(^|[^\\])((\\{2})*)\{query\}/,"$1$2"+encodeURIComponent(U)).replace(/(^|[^\\])((\\{2})*)\\(\{query\})/,"$1$2$4");};},value:encodeURIComponent},resultFilters:{validator:G.isArray,value:[]},resultHighlighter:{validator:function(T){return C(T)||T===null;}}}});},"@VERSION@",{requires:["base-base","event-valuechange","node-base"]});