YUI.add("autocomplete-base",function(B){var K=B.Lang,M=B.Array,C=K.isFunction,P=K.isNumber,E=K.trim,A="inputNode",G="query",L="queryDelimiter",O="results",J="value",N="valueChange",D="clear",I=G,H=O;function F(){this.publish(D,{defaultFn:this._defClearFn,queueable:true});this.publish(I,{defaultFn:this._defQueryFn,queueable:true});this.publish(H,{defaultFn:this._defResultsFn,queueable:true});}F.ATTRS={allowBrowserAutocomplete:{value:false,writeOnce:"initOnly"},dataSource:{validator:function(Q){return(Q&&C(Q.sendRequest))||Q===null;}},inputNode:{setter:B.one,writeOnce:"initOnly"},maxResults:{validator:P,value:0},minQueryLength:{validator:P,value:1},query:{readOnly:true,value:null},queryDelay:{validator:function(Q){return P(Q)&&Q>=0;},value:100},queryDelimiter:{value:null},requestTemplate:{setter:function(Q){if(C(Q)){return Q;}Q=Q.toString();return function(R){return Q.replace(/(^|[^\\])((\\{2})*)\{query\}/,"$1$2"+encodeURIComponent(R)).replace(/(^|[^\\])((\\{2})*)\\(\{query\})/,"$1$2$4");};},value:encodeURIComponent},resultFilters:{validator:K.isArray,value:[]},resultFormatter:{validator:"_functionValidator"},resultHighlighter:{validator:"_functionValidator"},resultLocator:{setter:function(Q){if(Q===null||C(Q)){return Q;}Q=Q.toString().split(".");return function(R){return B.Object.getValue(R,Q);};}},results:{readOnly:true,value:[]},value:{value:""}};F.CSS_PREFIX="ac";F.UI_SRC=(B.Widget&&B.Widget.UI_SRC)||"ui";F.prototype={bindInput:function(){var Q=this.get(A);if(!Q){B.error("No inputNode specified.");}this.unbindInput();this._inputEvents=[Q.on(N,this._onInputValueChange,this),this.after(N,this._afterValueChange,this)];},syncInput:function(){var Q=this.get(A);if(Q.get("nodeName").toLowerCase()==="input"){Q.setAttribute("autocomplete",this.get("allowBrowserAutocomplete")?"on":"off");}this.set(J,Q.get(J));},unbindInput:function(){while(this._inputEvents&&this._inputEvents.length){this._inputEvents.pop().detach();}},_functionValidator:function(Q){return C(Q)||Q===null;},_parseResponse:function(b,R,W){var f={data:W,query:b,results:[]},X,e,g,S=R&&R.results,V=[],Q,d,c,U,a,Y,Z,T;if(S){Q=this.get("resultFilters");d=this.get("resultFormatter");c=this.get("resultHighlighter");Y=this.get("resultLocator");T=this.get("maxResults");if(Y){e=M.map(S,Y);Z=M.hash(e,S);}else{e=S;}for(U=0,a=Q.length;U<a;++U){e=Q[U](b,e);if(!e||!e.length){break;}}if(Y){g=e;e=[];for(U=0,a=g.length;U<a;++U){e.push(Z[g[U]]);}}else{g=[].concat(e);}X=c?c(b,g):[].concat(g);if(d){X=d(b,e,X,g);}a=T>0?Math.min(T,X.length):X.length;for(U=0;U<a;++U){V.push({display:X[U],raw:e[U],text:g[U]});}f.results=V;}this.fire(H,f);},_parseValue:function(Q){var R=this.get(L);if(R){Q=Q.split(R);Q=Q[Q.length-1];}return this._trimLeft(Q);},_trimLeft:String.prototype.trimLeft?function(Q){return Q.trimLeft();}:function(Q){return Q.replace(/^\s+/,"");},_updateValue:function(R){var T=this.get(L),S,Q,U;R=this._trimLeft(R);if(T){S=E(T);U=M.map(E(this.get(J)).split(T),E);Q=U.length;if(Q>1){U[Q-1]=R;R=U.join(S+" ");}R=R+S+" ";}this.set(J,R);},_afterValueChange:function(V){var R,S,Q=V.newVal,U,T;if(V.src!==F.UI_SRC){this._inputNode.set(J,Q);return;}U=this._parseValue(Q);if(U&&U.length>=this.get("minQueryLength")){R=this.get("queryDelay");T=this;S=function(){T.fire(I,{inputValue:Q,query:U});};if(R){clearTimeout(this._delay);this._delay=setTimeout(S,R);}else{S();}}else{clearTimeout(this._delay);this.fire(D);}},_onResponse:function(R){var Q=R&&R.callback&&R.callback.query;if(Q&&Q===this.get(G)){this._parseResponse(Q,R.response,R.data);}},_onInputValueChange:function(R){var Q=R.newVal;if(Q===this.get(J)){return;}this.set(J,Q,{src:F.UI_SRC});},_defClearFn:function(){this._set(G,null);this._set(O,[]);},_defQueryFn:function(R){var S=this.get("dataSource"),Q=R.query;this._set(G,Q);if(Q&&S){S.sendRequest({request:this.get("requestTemplate")(Q),callback:{query:Q,success:B.bind(this._onResponse,this)}});}},_defResultsFn:function(Q){this._set(O,Q[O]);}};B.AutoCompleteBase=F;},"@VERSION@",{requires:["array-extras","event-valuechange","node-base"]});