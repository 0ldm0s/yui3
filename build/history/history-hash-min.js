YUI.add("history-hash",function(A){var D=A.HistoryBase,K=A.Lang,J=A.Object,N=YUI.namespace("Env.History"),C="hash",B=A.config,P=B.doc,I=P.documentMode,H,G,M,L=B.win,O=L.location,F=!K.isUndefined(L.onhashchange)&&(K.isUndefined(I)||I>7),E=function(){E.superclass.constructor.apply(this,arguments);};A.extend(E,D,{_init:function(Q){Q=Q||{};Q.initialState=Q.initialState||E.parseHash();A.after("hashchange",A.bind(this._afterHashChange,this),L);E.superclass._init.call(this,Q);},_storeState:function(S,R){var Q=E.createHash(R);E.superclass._storeState.apply(this,arguments);if(E.getHash()!==Q){E[S===D.SRC_REPLACE?"replaceHash":"setHash"](Q);}},_afterHashChange:function(Q){this._resolveChanges(C,E.parseHash(Q.newHash));}},{NAME:"history",SRC_HASH:C,nativeHashChange:F,_REGEX_HASH:/([^\?#&]+)=([^&]+)/g,createHash:function(S){var Q=E.encode,R=[];J.each(S,function(U,T){if(K.isValue(U)){R.push(Q(T)+"="+Q(U));}});return R.join("&");},decode:function(Q){return decodeURIComponent(Q.replace(/\+/g," "));},encode:function(Q){return encodeURIComponent(Q).replace(/%20/g,"+");},getHash:(A.UA.gecko?function(){var Q=/#(.*)$/.exec(O.href);return Q&&Q[1]?Q[1]:"";}:function(){return O.hash.substr(1);}),getUrl:function(){return O.href;},parseHash:function(U){U=U||E.getHash();var T=E.decode,R,S=U.match(E._REGEX_HASH)||[],Q=S.length,W,V={};for(R=0;R<Q;++R){W=S[R].split("=");V[T(W[0])]=T(W[1]);}return V;},replaceHash:function(Q){O.replace(Q.indexOf("#")===0?Q:"#"+Q);},setHash:function(Q){O.hash=Q;}});H=YUI.namespace("Env.History._hashNotifiers");A.Event.define("hashchange",{on:function(S,Q,R){if((S.compareTo(L)||S.compareTo(P.body))&&!J.owns(H,R.key)){H[R.key]=R;}},detach:function(S,Q,R){if(!R.hasSubs()){delete H[R.key];}}});G=E.getHash();M=E.getUrl();if(F){A.Event.attach("hashchange",function(S){var Q=E.getHash(),R=E.getUrl();J.each(H,function(T){T.fire({oldHash:G,oldUrl:M,newHash:Q,newUrl:R});});G=Q;M=R;},L);}else{if(!N._hashPoll){if(A.UA.webkit&&!A.UA.chrome){A.on("unload",function(){},L);}N._hashPoll=A.later(B.pollInterval||50,null,function(){var Q=E.getHash(),R;if(G!==Q){R=E.getUrl();J.each(H,function(S){S.fire({oldHash:G,oldUrl:M,newHash:Q,newUrl:R});});G=Q;M=R;}},null,true);}}A.History=E;},"@VERSION@",{requires:["event-synthetic","history-base","yui-later"]});