YUI.add("history-base",function(B){var J=B.Lang,F=B.Object,L=YUI.namespace("Env.History"),G=B.config.doc.documentMode,E=B.Lang.isUndefined,K=B.config.win,C={merge:true},I="change",A="add",H="replace";function D(){this._init.apply(this,arguments);}B.augment(D,B.EventTarget,null,null,{emitFacade:true,prefix:"history",preventable:false,queueable:true});if(!L._state){L._state={};}D.NAME="historyBase";D.SRC_ADD=A;D.SRC_REPLACE=H;D.html5=!!(K.history&&K.history.pushState&&K.history.replaceState&&!E(K.onpopstate));D.nativeHashChange=!E(K.onhashchange)&&(!G||G>7);B.mix(D.prototype,{_init:function(N){var M=N&&N.initialState;this.publish(I,{broadcast:2,defaultFn:this._defChangeFn});if(J.isObject(M)&&!J.isFunction(M)&&!J.isArray(M)){this.add(B.merge(L._state,M));}},add:function(){var M=B.Array(arguments,0,true);M.unshift(A);return this._change.apply(this,M);},get:function(M){var N=L._state;if(M){return F.owns(N,M)?N[M]:undefined;}else{return B.mix({},N,true);}},replace:function(){var M=B.Array(arguments,0,true);M.unshift(H);return this._change.apply(this,M);},_change:function(O,N,M){M=M?B.merge(C,M):C;if(M.merge){N=B.merge(L._state,N);}this._resolveChanges(O,N,M);return this;},_fireEvents:function(N,M){this.fire(I,{changed:M.changed,newVal:M.newState,prevVal:M.prevState,removed:M.removed,src:N});F.each(M.changed,function(P,O){this._fireChangeEvent(N,O,P);},this);F.each(M.removed,function(P,O){this._fireRemoveEvent(N,O,P);},this);},_fireChangeEvent:function(O,M,N){this.fire(M+"Change",{newVal:N.newVal,prevVal:N.prevVal,src:O});},_fireRemoveEvent:function(O,M,N){this.fire(M+"Remove",{prevVal:N,src:O});},_resolveChanges:function(S,Q,N){var R={},M,P=L._state,O={};Q=Q||{};F.each(Q,function(T,U){var V=P[U];if(T!==V){R[U]={newVal:T,prevVal:V};M=true;}},this);F.each(P,function(U,T){if(!F.owns(Q,T)||Q[T]===null){delete Q[T];O[T]=U;M=true;}},this);if(M){this._fireEvents(S,{changed:R,newState:Q,prevState:P,removed:O},N);}},_storeState:function(N,M){L._state=M||{};},_defChangeFn:function(M){this._storeState(M.src,M.newVal);}},true);B.HistoryBase=D;},"@VERSION@",{requires:["event-custom-complex"],supersedes:["history-deprecated"]});