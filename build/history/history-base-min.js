YUI.add("history-base",function(B){var H=B.Lang,E=B.Object,K=YUI.namespace("Env.History"),F=B.config.doc.documentMode,D=B.Lang.isUndefined,J=B.config.win,I="change",L="historyBase",A="add",G="replace",C=function(){this._init.apply(this,arguments);};B.augment(C,B.EventTarget,null,null,{emitFacade:true,prefix:"history",preventable:false,queueable:true});if(!K._state){K._state={};}C.NAME=L;C.SRC_ADD=A;C.SRC_REPLACE=G;C.html5=!!(J.history&&J.history.pushState&&J.history.replaceState&&!D(J.onpopstate));C.nativeHashChange=!D(J.onhashchange)&&(!F||F>7);B.mix(C.prototype,{_init:function(N){var M=N&&N.initialState;this.publish(I,{broadcast:2,defaultFn:this._defChangeFn});if(H.isObject(M)&&!H.isFunction(M)&&!H.isArray(M)){this.add(B.merge(K._state,M));}},add:function(N,M){return this._change(A,N,M);},get:function(M){var N=K._state;if(M){return E.owns(N,M)?N[M]:undefined;}else{return B.mix({},N,true);}},replace:function(N,M){return this._change(G,N,M);},_change:function(P,O,N){var M;if(H.isString(O)){M=O;O={};O[M]=N;}this._resolveChanges(P,B.merge(K._state,O));return this;},_fireEvents:function(N,M){this.fire(I,{changed:M.changed,newVal:M.newState,prevVal:M.prevState,removed:M.removed,src:N});E.each(M.changed,function(P,O){this._fireChangeEvent(N,O,P);},this);E.each(M.removed,function(P,O){this._fireRemoveEvent(N,O,P);},this);},_fireChangeEvent:function(O,M,N){this.fire(M+"Change",{newVal:N.newVal,prevVal:N.prevVal,src:O});},_fireRemoveEvent:function(O,M,N){this.fire(M+"Remove",{prevVal:N,src:O});},_resolveChanges:function(R,P){var Q={},M,O=K._state,N={};P=P||{};E.each(P,function(S,T){var U=O[T];if(S!==U){Q[T]={newVal:S,prevVal:U};M=true;}},this);E.each(O,function(T,S){if(!E.owns(P,S)||P[S]===null){delete P[S];N[S]=T;M=true;}},this);if(M){this._fireEvents(R,{changed:Q,newState:P,prevState:O,removed:N});}},_storeState:function(N,M){K._state=M||{};},_defChangeFn:function(M){this._storeState(M.src,M.newVal);}},true);B.HistoryBase=C;},"@VERSION@",{requires:["event-custom-complex"]});