YUI.add("io-upload-iframe",function(h,e){var b=h.config.win,g=h.config.doc,c=(g.documentMode&&g.documentMode>=8),a=decodeURIComponent;function i(j,l,k){var d=h.Node.create('<iframe src="#" id="io_iframe'+j.id+'" name="io_iframe'+j.id+'" />');d._node.style.position="absolute";d._node.style.top="-1000px";d._node.style.left="-1000px";h.one("body").appendChild(d);h.on("load",function(){k._uploadComplete(j,l);},"#io_iframe"+j.id);}function f(d){h.Event.purgeElement("#io_iframe"+d,false);h.one("body").removeChild(h.one("#io_iframe"+d));}h.mix(h.IO.prototype,{_addData:function(p,n){if(h.Lang.isObject(n)){n=h.QueryString.stringify(n);}var q=[],d=n.split("="),k,j;for(k=0,j=d.length-1;k<j;k++){q[k]=g.createElement("input");q[k].type="hidden";q[k].name=a(d[k].substring(d[k].lastIndexOf("&")+1));q[k].value=(k+1===j)?a(d[k+1]):a(d[k+1].substring(0,(d[k+1].lastIndexOf("&"))));p.appendChild(q[k]);}return q;},_removeData:function(k,m){var j,d;for(j=0,d=m.length;j<d;j++){k.removeChild(m[j]);}},_setAttrs:function(j,k,d){j.setAttribute("action",d);j.setAttribute("method","POST");j.setAttribute("target","io_iframe"+k);j.setAttribute(h.UA.ie&&!c?"encoding":"enctype","multipart/form-data");},_resetAttrs:function(j,d){h.Object.each(d,function(k,l){if(k){j.setAttribute(l,k);}else{j.removeAttribute(l);}});},_startUploadTimeout:function(d,k){var j=this;j._timeout[d.id]=b.setTimeout(function(){d.status=0;d.statusText="timeout";j.complete(d,k);j.end(d,k);},k.timeout);},_clearUploadTimeout:function(j){var d=this;b.clearTimeout(d._timeout[j]);delete d._timeout[j];},_uploadComplete:function(n,r){var q=this,m=h.one("#io_iframe"+n.id).get("contentWindow.document"),j=m.one("body"),l;if(r.timeout){q._clearUploadTimeout(n.id);}try{if(j){l=j.one("pre:first-child");n.c.responseText=l?l.get("text"):j.get("text");}else{n.c.responseXML=m._node;}}catch(k){n.e="upload failure";}q.complete(n,r);q.end(n,r);b.setTimeout(function(){f(n.id);},0);},_upload:function(m,k,p){var n=this,l=(typeof p.form.id==="string")?g.getElementById(p.form.id):p.form.id,j={action:l.getAttribute("action"),target:l.getAttribute("target")},d;n._setAttrs(l,m.id,k);if(p.data){d=n._addData(l,p.data);}if(p.timeout){n._startUploadTimeout(m,p);}l.submit();n.start(m,p);if(p.data){n._removeData(l,d);}n._resetAttrs(l,j);return{id:m.id,abort:function(){m.status=0;m.statusText="abort";if(h.one("#io_iframe"+m.id)){f(m.id);n.complete(m,p);n.end(m,p);}else{return false;}},isInProgress:function(){return h.one("#io_iframe"+m.id)?true:false;},io:n};},upload:function(j,d,k){i(j,k,this);return this._upload(j,d,k);}});},"@VERSION@",{"requires":["io-base","node-base"]});