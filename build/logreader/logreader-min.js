YUI.add("logreader",function(D){var V="container",N="hd",C="console",M="ft",G="hide-ft",L="controls",f="button",W="label",K="checkbox",d="collapse",e="expand",E="active",h="clear",a="categories",S="sources",I="filter",R="category",O="source",J="entry",b="verbose",A="entry-meta",Q="entry-cat",P="entry-src",X="entry-time",U="entry-type",T="hide",F="entry-type",c="hasClass",B="addClass",g="removeClass",H="getClassName";function Z(){this.constructor.superclass.constructor.apply(this,arguments);}D.mix(Z,{NAME:"logreader",VERBOSE:"verbose",BASIC:"basic",ATTRS:{strings:{value:{COLLAPSE:"Collapse",EXPAND:"Expand",ACTIVE:"Active",CLEAR:"Clear"}},title:{value:"Log Console"},enabled:{value:true},active:{value:true},defaultCategory:{value:"info"},defaultSource:{value:"global"},entryTypes:{value:{category:{info:true,warn:true,error:true,time:true},source:{global:true}}},templates:{value:{verbose:null,basic:null}},defaultTemplate:{value:"verbose"},entryWriters:{value:{entry:"_entryFromTemplate"}},defaultWriter:{value:"entry"},printTimeout:{value:100,validator:D.Lang.isNumber},consoleLimit:{value:500},footerEnabled:{value:true},verbose:{value:true,set:function(Y){this.set("defaultTemplate",(Y?D.log.Reader.VERBOSE:D.log.Reader.BASIC));return !!Y;}},newestOnTop:{value:true},collapsed:{value:false},startTime:{value:new Date()},lastTime:{value:new Date()}}});D.extend(Z,D.Widget,{_head:null,_title:null,_console:null,_foot:null,_catChecks:null,_srcChecks:null,_timeout:null,buffer:null,initializer:function(Y){this.buffer=[];this._initObjectAttributes();this._initTemplates();D.on("yui:log",D.bind(this._handleLogEntry,this));this.printBuffer=D.bind(this.printBuffer,this);this._handleControlClick=D.bind(this._handleControlClick,this);},_initObjectAttributes:function(){var Y=["entryTypes","templates","entryWriters"],j=Y.length-1;for(;j>=0;--j){this.set(Y[j],D.clone(this.get(Y[j])),true);}},_initTemplates:function(){this.set("templates.verbose",'<pre class="'+this[H](J)+" "+this[H](b)+'">'+'<div class="'+this[H](A)+'">'+"<p>"+'<span class="'+this[H](Q)+'">'+"{label}</span>"+'<span class="'+this[H](X)+'">'+" {totalTime}ms (+{elapsedTime}) {localTime}:"+"</span>"+"</p>"+'<p class="'+this[H](P)+'">'+"{sourceAndDetail}"+"</p>"+"</div>"+"<p>{message}</p>"+"</pre>");this.set("templates.basic",'<pre class="'+this[H](J)+'">'+"<p>"+'<span class="'+this[H](A)+'">'+'<span class="'+this[H](Q)+'">'+"{label}</span>"+'<span class="'+this[H](X)+'">'+" {totalTime}ms (+{elapsedTime}) {localTime}:"+"</span>"+'<span class="'+this[H](P)+'">'+" {sourceAndDetail}"+"</span>:"+"</span>"+" {message}"+"</p>"+"</pre>");},renderUI:function(){if(!this.get("rendered")){this.get("contentBox").set("innerHTML","");this.get("contentBox")[B](this[H](V));this._renderHead();this._renderConsole();this._renderFoot();}},_renderHead:function(){var Y=this.getStrings(),i=this.get("contentBox");this._head=D.Node.create('<div class="'+this[H](N)+'">'+'<div class="'+this[H](L)+'">'+'<input type="button" class="'+this[H](f)+" "+this[H](d)+'"'+' value="'+Y.COLLAPSE+'">'+'<input type="button" class="'+this[H](f)+" "+this[H](e)+'"'+' value="'+Y.EXPAND+'">'+"</div>"+"<h4>"+this.get("title")+"</h4>"+"</div>");this._title=this._head.query("h4");i.insertBefore(this._head,i.get("firstChild")||null);},_renderConsole:function(){this._console=this.get("contentBox").insertBefore(D.Node.create('<div class="'+this[H](C)+'"></div>'),this._foot||null);},_renderFoot:function(){var j=this.getStrings(),Y,i;this._foot=D.Node.create('<div class="'+this[H](M)+'">'+'<div class="'+this[H](L)+'">'+'<label class="'+this[H](W)+'">'+'<input type="checkbox" class="'+this[H](K)+" "+this[H](E)+'" value="1"> '+j.ACTIVE+"</label>"+'<input type="button" class="'+this[H](f)+" "+this[H](h)+'"'+' value="'+j.CLEAR+'">'+"</div>");this._catChecks=this._foot.appendChild(D.Node.create('<div class="'+this[H](L)+" "+this[H](a)+'"></div>'));this._srcChecks=this._foot.appendChild(D.Node.create('<div class="'+this[H](L)+" "+this[H](S)+'"></div>'));Y=this.get("entryTypes.category");for(i in Y){if(Y.hasOwnProperty(i)){this._catChecks.appendChild(this._createEntryType(this[H](R),i));}}Y=this.get("entryTypes.source");for(i in Y){if(Y.hasOwnProperty(i)){this._srcChecks.appendChild(this._createEntryType(this[H](O),i));}}this.get("contentBox").appendChild(this._foot);},syncUI:function(){var Y;this._setActive(this.get("active"));this._setCollapsed(this.get("collapsed"));this._setFooterEnabled(this.get("footerEnabled"));Y=this.get("entryTypes.category");this._foot.queryAll("input[type=checkbox]."+this[H](R)).each(function(i){i.set("checked",(i.get("value") in Y)?Y[i.get("value")]:true);});Y=this.get("entryTypes.source");this._foot.queryAll("input[type=checkbox]."+this[H](O)).each(function(i){i.set("checked",(i.get("value") in Y)?Y[i.get("value")]:true);});},bindUI:function(){var Y=this.get("contentBox").queryAll("."+this[H](L)),j=Y.size()-1;for(;j>=0;--j){Y.item(j).on("click",this._handleControlClick);}this.after("titleChange",this._setTitle);this.after("activeChange",this._setActive);this.after("collapsedChange",this._setCollapsed);this.after("consoleLimitChange",this._setConsoleLimit);this.after("footerEnabledChange",this._setFooterEnabled);this.after("entryTypesChange",this._handleEntryTypesChange);},_handleControlClick:function(i){var Y=i.target;if(Y[c](this[H](d))){this.set("collapsed",true);}else{if(Y[c](this[H](e))){this.set("collapsed",false);}else{if(Y[c](this[H](E))){this.set("active",Y.get("checked"));}else{if(Y[c](this[H](h))){this.clearConsole();}else{if(Y[c](this[H](I))){this.set("entryTypes."+(Y[c](this[H](R))?"category.":"source.")+Y.get("value"),Y.get("checked"));}}}}}},_setTitle:function(Y){Y=typeof Y=="object"?Y.newVal:Y;this._title.set("innerHTML",Y);},_setActive:function(Y){Y=typeof Y=="object"?Y.newVal:Y;var j=this._foot.queryAll("input[type=checkbox]."+this[H](E)),k=j.size()-1;for(;k>=0;--k){j.item(k).set("checked",!!Y);}if(Y){this._schedulePrint();}else{if(this._timeout){clearTimeout(this._timeout);
this._timeout=null;}}},_setCollapsed:function(Y){Y=typeof Y=="object"?Y.newVal:Y;this.get("contentBox")[Y?B:g](this[H](d));},_setConsoleLimit:function(Y){Y=typeof Y==="object"?Y.newVal:Y;this._trimOldEntries(Y);},clearConsole:function(){this._console.set("innerHTML","");if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}this.buffer=[];},reset:function(){this.clearConsole();this.set("startTime",new Date());this.set("enabled",true);this.set("active",true);this.fire("reset");},_handleLogEntry:function(l,i,k){if(this.get("enabled")){var Y=this.normalizeMessage(l,i,k),j=this.get("entryTypes");if(Y){if(Y.category&&!(Y.category in j.category)){this.createCategory(Y.category,true);}if(Y.source&&!(Y.source in j.source)){this.createSource(Y.source,true);}this.buffer.push(Y);this._schedulePrint();}}},normalizeMessage:function(k,i,j){var Y={time:new Date(),message:k,category:i||this.get("defaultCategory"),sourceAndDetail:j||this.get("defaultSource"),source:null,label:null,localTime:null,elapsedTime:null,totalTime:null};Y.source=/^(\S+)\s/.test(Y.sourceAndDetail)?RegExp.$1:Y.sourceAndDetail;Y.label=Y.category;Y.localTime=Y.time.toLocaleTimeString?Y.time.toLocaleTimeString():(Y.time+"");Y.elapsedTime=Y.time-this.get("lastTime");Y.totalTime=Y.time-this.get("startTime");this.set("lastTime",Y.time);return Y;},_schedulePrint:function(){if(this.get("active")&&!this._timeout){this._timeout=setTimeout(this.printBuffer,this.get("printTimeout"));}},printBuffer:function(){var j=D.debug;D.debug=false;if(this.get("active")&&this.get("rendered")){clearTimeout(this._timeout);this._timeout=null;var m=this.buffer,k=0,Y=m.length;this.buffer=[];for(;k<Y;++k){this.printLogEntry(m[k]);this._trimOldEntries();}}D.debug=j;},printLogEntry:function(Y){var k=this.get("entryWriters"),j=k[Y.category]||k[this.get("defaultWriter")],i;i=typeof j==="function"?j.call(this,Y):this[j](Y);if(i){if(this.get("newestOnTop")){this._console.insertBefore(i,this._console.get("firstChild"));}else{this._console.appendChild(i);this._console.set("scrollTop",this._console.get("scrollHeight"));}}},_entryFromTemplate:function(Y){Y=this._htmlEscapeMessage(Y);var j=this.get("templates"),i=j[Y.category]||j[this.get("defaultTemplate")],k=D.Node.create(D.Lang.substitute(i,Y));k[B](this[H](F,Y.category));k[B](this[H](F,Y.source));return k;},_htmlEscapeMessage:function(Y){function i(j){return j.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;");}Y=D.clone(Y);Y.message=typeof Y.message==="string"?i(Y.message):Y.message;Y.label=typeof Y.label==="string"?i(Y.label):Y.label;Y.source=typeof Y.source==="string"?i(Y.source):Y.source;Y.sourceAndDetail=typeof Y.sourceAndDetail==="string"?i(Y.sourceAndDetail):Y.sourceAndDetail;Y.category=typeof Y.category==="string"?i(Y.category):Y.category;return Y;},_trimOldEntries:function(j){if(this._console){var Y=this._console.get("childNodes"),m=Y.size()-((j|0)||this.get("consoleLimit"));if(m>0){if(this.get("newestOnTop")){for(var k=Y.size();m<k;m++){this._console.removeChild(Y.item(m));}}else{for(;m>=0;--m){this._console.removeChild(Y.item(m));}}}}},hideEntries:function(i){var Y=this.get("entryTypes"),j;for(j in Y){if(Y.hasOwnProperty(j)&&Y[j].hasOwnProperty(i)){this.set("entryTypes."+j+"."+i,false);}}},showEntries:function(i){var Y=this.get("entryTypes"),j;for(j in Y){if(Y.hasOwnProperty(j)&&Y[j].hasOwnProperty(i)){this.set("entryTypes."+j+"."+i,true);}}},_setEntryType:function(j,l){var Y=this._foot.queryAll("input[type=checkbox]."+this[H](F,j)),k=Y.size()-1;for(;k>=0;--k){Y.item(k).set("checked",l);}this._filterEntries(j,!l);},_filterEntries:function(i,Y){this.get("contentBox")[Y?B:g](this[H](T,i));},_setFooterEnabled:function(Y){this.get("contentBox")[Y?g:B](this[H](G));},createCategory:function(i,Y){this.set("entryTypes.category."+i,!!Y);},createSource:function(i,Y){this.set("entryTypes.source."+i,!!Y);},_createEntryType:function(k,j){var i=D.Node.create('<label class="'+this[H](W)+'">'+'<input type="checkbox" value="'+j+'" class="'+this[H](I)+" "+k+" "+this[H](F,j)+'"> '+j+"</label>"),Y="."+this[H](T,j)+" ."+this[H](C)+" ."+this[H](F,j);D.StyleSheet("logreader").set(Y,{display:"none"});return i;},_handleEntryTypesChange:function(q){var s=function(t){var l=[];function i(w,v){if(typeof w==="object"){for(var u in w){if(w.hasOwnProperty(u)){i(w[u],v.concat(u));}}}else{if(v){l.push(v);}}}i(t,[]);return l;},j=function(y,x){var u=y,w=0,t=x.length;for(;w<t&&u!==undefined;++w){u=u[x[w]];}return u;},r=s(q.prevVal),o=s(q.newVal),m={},n=0,k=r.length,Y,p;for(;n<k;++n){p=j(q.newVal,r[n]);if(j(q.prevVal,r[n])!==p){Y=r[n][1];this._setEntryType(Y,p);}m[r[n].join(".")]=true;}for(n=0,k=o.length;n<k;++n){if(!m[o[n].join(".")]){Y=o[n][1];if(o[n][0]=="category"){this._catChecks.appendChild(this._createEntryType(this[H](R),Y));}else{this._srcChecks.appendChild(this._createEntryType(this[H](O),Y));}this._setEntryType(Y,j(q.newVal,o[n]));}}}});D.log.Reader=Z;},"@VERSION@",{requires:["substitute","stylesheet","widget"]});