YUI.add("logreader",function(B){var e=B.ClassNameManager.getClassName,i="logreader",V="entry",O="reset",h="checked",E="clear",d="pause",I="paused",D="info",C="warn",G="error",W="innerHTML",J="ui",F="click",Q="contentBox",M=e(i,V),X=e(i,d),a=e(i,"checkbox"),j=e(i,E),Z=e(i,V,"meta"),A=/&/g,P=/</g,b=/>/g,g=/^(\S+)\s/,S="&#38;",U="&#60;",f="&#62;",H=B.Lang,N=H.isString,R=H.isNumber,K=H.isObject,T='<pre class="'+M+'">'+'<div class="'+Z+'">'+"<p>"+'<span class="'+e(i,V,"cat")+'">'+"{label}</span>"+'<span class="'+e(i,V,"time")+'">'+" {totalTime}ms (+{elapsedTime}) {localTime}:"+"</span>"+"</p>"+'<p class="'+e(i,V,"src")+'">'+"{sourceAndDetail}"+"</p>"+"</div>"+'<p class="'+e(i,V,"content")+'">{message}</p>'+"</pre>";function c(){this.constructor.superclass.constructor.apply(this,arguments);}B.mix(c,{NAME:i,LOG_LEVEL_INFO:3,LOG_LEVEL_WARN:2,LOG_LEVEL_ERROR:1,HEAD_TEMPLATE:'<div class="'+e(i,"hd")+'"></div>',CONSOLE_TEMPLATE:'<div class="'+e(i,"console")+'"></div>',FOOT_TEMPLATE:'<div class="'+e(i,"ft")+'">'+'<div class="'+e(i,"controls")+'">'+'<label class="'+e(i,"label")+'">'+'<input type="checkbox" class="'+a+" "+X+'" value="1"> '+d+"</label>"+'<input type="button" class="'+e(i,"button")+" "+j+'"'+' value="'+E+'">'+"</div>"+"</div>",ENTRY_TEMPLATE:T,ATTRS:{strings:{value:{PAUSE:"Pause",CLEAR:"Clear"}},title:{value:"Log Console",validator:N},paused:{value:false,validator:H.isBoolean},defaultCategory:{value:D,validator:N},defaultSource:{value:"global",validator:N},entryTemplate:{value:T,validator:N},logLevel:{value:B.config.logLevel,validator:function(L){return this._validateLogLevel(L);},set:function(L){return this._setLogLevel(L);}},printTimeout:{value:100,validator:R},consoleLimit:{value:500,validator:R},newestOnTop:{value:true},startTime:{value:new Date()},lastTime:{value:new Date()}}});B.extend(c,B.Widget,{_title:null,_console:null,_foot:null,_timeout:null,buffer:null,clearConsole:function(){this._console.set(W,"");if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}this.buffer=[];},reset:function(){this.fire(O);},printBuffer:function(){var Y=B.debug;B.debug=false;if(!this.get(I)&&this.get("rendered")){clearTimeout(this._timeout);this._timeout=null;var l=this.buffer,k,L;this.buffer=[];for(k=0,L=l.length;k<L;++k){this.printLogEntry(l[k]);this._trimOldEntries();}}B.debug=Y;},printLogEntry:function(L){L=this._htmlEscapeMessage(L);var Y=B.Node.create(B.Lang.substitute(this.get("entryTemplate"),L));Y.addClass(this.getClassName(V,L.category));Y.addClass(this.getClassName(V,L.source));this._addToConsole(Y);},initializer:function(L){this.buffer=[];B.on("yui:log",B.bind(this._onYUILog,this));this.publish(V,{defaultFn:this._defEntryFn});this.publish(O,{defaultFn:this._defResetFn});this._onPauseClick=B.bind(this._onPauseClick,this);this.clearConsole=B.bind(this.clearConsole,this);},renderUI:function(){this._initHead();this._initConsole();this._initFoot();},syncUI:function(){this.set(I,this.get(I));},bindUI:function(){this.get(Q).query("input[type=checkbox]."+X).on(F,this._onPauseClick);this.get(Q).query("input[type=button]."+j).on(F,this.clearConsole);this.after("titleChange",this._afterTitleChange);this.after("pausedChange",this._afterPausedChange);this.after("consoleLimitChange",this._afterConsoleLimitChange);},_initHead:function(){var Y=this.get(Q),L;L=B.Node.create(c.HEAD_TEMPLATE);this._title=L.appendChild(B.Node.create("<h4>"+this.get("title")+"</h4>"));Y.insertBefore(L,Y.get("firstChild")||null);},_initConsole:function(){this._console=this.get(Q).insertBefore(B.Node.create(c.CONSOLE_TEMPLATE),this._foot||null);},_initFoot:function(){var Y=this.getStrings(),L;this._foot=B.Node.create(c.FOOT_TEMPLATE);L=this._foot.queryAll("."+X);if(L){L.set(W," "+Y.PAUSE);}L=this._foot.queryAll("."+j);if(L){L.set("value",Y.CLEAR);}this.get(Q).appendChild(this._foot);},_isInLogLevel:function(l,L){var Y=this.get("logLevel"),k=L===G?c.LOG_LEVEL_ERROR:L===C?c.LOG_LEVEL_WARN:c.LOG_LEVEL_INFO;return Y>=k;},_normalizeMessage:function(l,Y,k){var L={time:new Date(),message:l,category:Y||this.get("defaultCategory"),sourceAndDetail:k||this.get("defaultSource"),source:null,label:null,localTime:null,elapsedTime:null,totalTime:null};L.source=g.test(L.sourceAndDetail)?RegExp.$1:L.sourceAndDetail;L.label=L.category;L.localTime=L.time.toLocaleTimeString?L.time.toLocaleTimeString():(L.time+"");L.elapsedTime=L.time-this.get("lastTime");L.totalTime=L.time-this.get("startTime");this.set("lastTime",L.time);return L;},_schedulePrint:function(){if(!this.get(I)&&!this._timeout){this._timeout=setTimeout(B.bind(this.printBuffer,this),this.get("printTimeout"));}},_addToConsole:function(Y){var L=this.get("newestOnTop");this._console.insertBefore(Y,L?this._console.get("firstChild"):null);if(!L){this._console.set("scrollTop",this._console.get("scrollHeight"));}},_htmlEscapeMessage:function(L){L=B.clone(L);L.message=this._escapeHTML(L.message);L.label=this._escapeHTML(L.label);L.source=this._escapeHTML(L.source);L.sourceAndDetail=this._escapeHTML(L.sourceAndDetail);L.category=this._escapeHTML(L.category);return L;},_trimOldEntries:function(){if(this._console){var L=this._console.queryAll("."+M),k=L?L.size()-this.get("consoleLimit"):0;if(k>0){if(this.get("newestOnTop")){for(var Y=L.size();k<Y;k++){this._console.removeChild(L.item(k));}}else{for(;k>=0;--k){this._console.removeChild(L.item(k));}}}}},_escapeHTML:function(L){return N(L)?L.replace(A,S).replace(P,U).replace(b,f):L;},_onPauseClick:function(Y){var L=Y.target.get(h);this.set(I,L,{src:J});},_setLogLevel:function(L){if(N(L)){L=L.toLowerCase();L=L===G?c.LOG_LEVEL_ERROR:L===C?c.LOG_LEVEL_WARN:c.LOG_LEVEL_INFO;}else{if(!R(L)){L=c.LOG_LEVEL_INFO;}}return L;},_validateLogLevel:function(L){return L===c.LOG_LEVEL_INFO||L===c.LOG_LEVEL_WARN||L===c.LOG_LEVEL_ERROR;},_afterTitleChange:function(L){this._title.set(W,L.newVal);},_afterPausedChange:function(Y){var L=Y.newVal;if(Y.src!==J){this._foot.queryAll("input[type=checkbox]."+X).set(h,L);}if(!L){this._schedulePrint();}else{if(this._timeout){clearTimeout(this._timeout);
this._timeout=null;}}},_afterConsoleLimitChange:function(){this._trimOldEntries();},_onYUILog:function(l,L,k){var Y=B.config.debug;B.config.debug=false;if(!this.get("disabled")&&this._isInLogLevel(l,L,k)){this.fire(V,{message:this._normalizeMessage.apply(this,arguments)});}B.config.debug=Y;},_defResetFn:function(){this.clearConsole();this.set("startTime",new Date());this.set("disabled",false);this.set(I,false);},_defEntryFn:function(L){if(L.message){this.buffer.push(L.message);this._schedulePrint();}}});B.log.Reader=c;},"@VERSION@",{requires:["substitute","widget"]});