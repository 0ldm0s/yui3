YUI.add("scrollview-paginator",function(Y,NAME){var getClassName=Y.ClassNameManager.getClassName,SCROLLVIEW="scrollview",CLASS_HIDDEN=getClassName(SCROLLVIEW,"hidden"),CLASS_PAGED=getClassName(SCROLLVIEW,"paged"),UI=Y.ScrollView?Y.ScrollView.UI_SRC:"ui",INDEX="index",SCROLL_X="scrollX",SCROLL_Y="scrollY",TOTAL="total",HOST="host",BOUNDING_BOX="boundingBox",CONTENT_BOX="contentBox",SELECTOR="selector",FLICK="flick",DRAG="drag",AXIS="axis",DIM_X="x",DIM_Y="y";function PaginatorPlugin(){PaginatorPlugin.superclass.constructor.apply(this,arguments)}Y.extend(PaginatorPlugin,Y.Plugin.Base,{initializer:function(config){var paginator=this,host=paginator.get(HOST);config=config||{},paginator.optimizeMemory=config.optimizeMemory||!1,paginator.padding=config.padding||1,paginator.cards=[],paginator._host=host,paginator._bb=host._bb,paginator._cb=host._cb,paginator._cIndex=config.index||0,paginator._cAxis=paginator.get(AXIS),paginator._prevent=new Y.Do.Prevent,paginator.after({indexChange:paginator._afterIndexChange,axisChange:paginator._afterAxisChange}),paginator.beforeHostMethod("scrollTo",paginator._beforeHostScrollTo),paginator.beforeHostMethod("_mousewheel",paginator._beforeHostMousewheel),paginator.afterHostMethod("_onGestureMoveEnd",paginator._afterHostGestureMoveEnd),paginator.afterHostMethod("_uiDimensionsChange",paginator._afterHostUIDimensionsChange),paginator.afterHostMethod("syncUI",paginator._afterHostSyncUI),paginator.afterHostEvent("render",paginator._afterHostRender),paginator.afterHostEvent("scrollEnd",paginator._afterHostScrollEnded)},_afterHostRender:function(e){var paginator=this,bb=paginator._bb,host=paginator._host,index=paginator._cIndex,paginatorAxis=paginator._cAxis,pageNodes=paginator._getPageNodes(),size=pageNodes.size(),maxScrollX=paginator.cards[index].maxScrollX,maxScrollY=paginator.cards[index].maxScrollY;paginatorAxis[DIM_Y]?host._maxScrollX=maxScrollX:paginatorAxis[DIM_X]&&(host._maxScrollY=maxScrollY),paginator.set(TOTAL,size),index!==0&&paginator.scrollToIndex(index,0),bb.addClass(CLASS_PAGED)},_afterHostSyncUI:function(e){var paginator=this,host=paginator._host,hostFlick=host.get(FLICK);paginator._cAxis===undefined&&paginator._set(AXIS,host.get(AXIS)),paginator._cAxis[DIM_X]?(hostFlick.axis=DIM_Y,host.set(FLICK,hostFlick)):paginator._cAxis[DIM_Y]&&(hostFlick.axis=DIM_X,host.set(FLICK,hostFlick))},_afterHostUIDimensionsChange:function(e){var paginator=this,host=paginator._host,bb=paginator._bb,widgetWidth=bb.get("offsetWidth"),widgetHeight=bb.get("offsetHeight"),pageNodes=paginator._getPageNodes(),size=pageNodes.size();pageNodes.each(function(node,i){var scrollWidth=node.get("scrollWidth"),scrollHeight=node.get("scrollHeight"),maxScrollX=Math.max(0,scrollWidth-widgetWidth),maxScrollY=Math.max(0,scrollHeight-widgetHeight);paginator.cards[i]?(paginator.cards[i].maxScrollX=maxScrollX,paginator.cards[i].maxScrollY=maxScrollY):paginator.cards[i]={maxScrollX:maxScrollX,maxScrollY:maxScrollY,node:node,scrollX:0,scrollY:0}})},_beforeHostScrollTo:function(x,y,duration,easing,node){var paginator=this,host=paginator._host,gesture=host._gesture,index=paginator._cIndex,paginatorAxis=paginator._cAxis,gestureAxis;return gesture&&(gestureAxis=gesture.axis,gestureAxis===DIM_Y?x=null:y=null,paginatorAxis[gestureAxis]===!1&&(node=paginator.cards[index].node)),new Y.Do.AlterArgs("new args",[x,y,duration,easing,node])},_afterHostGestureMoveEnd:function(e){var paginator=this,host=paginator._host,gesture=host._gesture,paginatorAxis=paginator._cAxis,gestureAxis=gesture&&gesture.axis;paginatorAxis[gestureAxis]&&(gesture[gestureAxis===DIM_X?"deltaX":"deltaY"]>0?paginator[host.rtl?"prev":"next"]():paginator[host.rtl?"next":"prev"]())},_beforeHostMousewheel:function(e){var paginator=this,host=paginator._host,bb=host._bb,isForward=e.wheelDelta<0,paginatorAxis=paginator._cAxis;host._gesture={axis:DIM_Y};if(bb.contains(e.target)&&paginatorAxis[DIM_Y])return isForward?paginator.next():paginator.prev(),e.preventDefault(),paginator._prevent},_afterHostScrollEnded:function(e){var paginator=this,host=paginator._host,index=paginator._cIndex,scrollX=host.get(SCROLL_X),scrollY=host.get(SCROLL_Y),paginatorAxis=paginator._cAxis;paginatorAxis[DIM_Y]?paginator.cards[index].scrollX=scrollX:paginator.cards[index].scrollY=scrollY,paginator._optimize()},_afterIndexChange:function(e){var paginator=this,host=this._host,index=e.newVal,maxScrollX=paginator.cards[index].maxScrollX,maxScrollY=paginator.cards[index].maxScrollY,gesture=host._gesture,gestureAxis=gesture&&gesture.axis;gestureAxis===DIM_Y?(host._maxScrollX=maxScrollX,host.set(SCROLL_X,paginator.cards[index].scrollX,{src:UI})):gestureAxis===DIM_X&&(host._maxScrollY=maxScrollY,host.set(SCROLL_Y,paginator.cards[index].scrollY,{src:UI})),paginator._cIndex=index,e.src!==UI&&paginator.scrollToIndex(index)},_optimize:function(){if(!this.optimizeMemory)return!1;var paginator=this,host=paginator._host,optimizeMemory=paginator.optimizeMemory,currentIndex=paginator._cIndex,pageNodes;pageNodes=paginator._getStage(currentIndex),paginator._showNodes(pageNodes.visible),paginator._hideNodes(pageNodes.hidden)},_getStage:function(index){var padding=this.padding,pageNodes=this._getPageNodes(),pageCount=this.get(TOTAL),start=Math.max(0,index-padding),end=Math.min(pageCount,index+1+padding);return{visible:pageNodes.splice(start,end-start),hidden:pageNodes}},_showNodes:function(nodeList){nodeList&&nodeList.removeClass(CLASS_HIDDEN).setStyle("visibility","")},_hideNodes:function(nodeList){nodeList&&nodeList.addClass(CLASS_HIDDEN).setStyle("visibility","hidden")},_getPageNodes:function(){var paginator=this,host=paginator._host,cb=host._cb,pageSelector=paginator.get(SELECTOR),pageNodes=pageSelector?cb.all(pageSelector):cb.get("children");return pageNodes},next:function(){var paginator=this,index=paginator._cIndex,target=index+1,total=this.get(TOTAL);if(target>=total)return;paginator.set(INDEX,target)},prev:function(){var paginator=this,index=paginator._cIndex,target=index-1;if(target<0)return;paginator.set(INDEX,target)},scrollTo:function(){return this.scrollToIndex.apply(this,arguments)},scrollToIndex:function(index,duration,easing){var paginator=this,host=paginator._host,pageNode=paginator._getPageNodes().item(index),scrollAxis=paginator._cAxis[DIM_X]?SCROLL_X:SCROLL_Y,scrollOffset=pageNode.get(scrollAxis===SCROLL_X?"offsetLeft":"offsetTop");duration=duration!==undefined?duration:PaginatorPlugin.TRANSITION.duration,easing=easing!==undefined?duration:PaginatorPlugin.TRANSITION.easing,paginator.set(INDEX,index),paginator._showNodes(pageNode),host.set(scrollAxis,scrollOffset,{duration:duration,easing:easing})},_axisSetter:function(val,name){if(Y.Lang.isString(val))return{x:val.match(/x/i)?!0:!1,y:val.match(/y/i)?!0:!1}},_afterAxisChange:function(e){this._cAxis=e.newVal}},{NAME:"pluginScrollViewPaginator",NS:"pages",ATTRS:{axis:{setter:"_axisSetter",writeOnce:"initOnly"},selector:{value:null},index:{value:0,validator:function(val){return!0}},total:{value:0}},TRANSITION:{duration:300,easing:"ease-out"}}),Y.namespace("Plugin").ScrollViewPaginator=PaginatorPlugin},"@VERSION@",{requires:["plugin","classnamemanager"]})