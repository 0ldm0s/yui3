YUI.add("console-filters",function(C){var R=C.ClassNameManager.getClassName,G="console",B="filters",L="filter",F="category",D="source",E="category.",M="source.",Q="host",H="parentNode",S="checked",P="defaultVisibility",O=".",U="",N=C.UA.ie>7?"&#8194;":" ",T=O+C.Console.CHROME_CLASSES.console_bd_class,I=O+C.Console.CHROME_CLASSES.console_ft_class,A="input[type=checkbox].",J=C.Lang.isString;function K(){K.superclass.constructor.apply(this,arguments);}C.mix(K,{NAME:"consoleFilters",NS:L,CATEGORIES_TEMPLATE:'<div class="{categories}"></div>',SOURCES_TEMPLATE:'<div class="{sources}"></div>',FILTER_TEMPLATE:'<label class="{filter_label}">'+'<input type="checkbox" value="{filter_name}" '+'class="{filter} {filter_class}"> {filter_name}'+"</label>"+N,CHROME_CLASSES:{categories:R(G,B,"categories"),sources:R(G,B,"sources"),category:R(G,L,F),source:R(G,L,D),filter:R(G,L),filter_label:R(G,L,"label")},ATTRS:{defaultVisibility:{value:true,validator:C.Lang.isBoolean},category:{value:{},validator:function(W,V){return this._validateCategory(V,W);}},source:{value:{},validator:function(W,V){return this._validateSource(V,W);}}}});C.extend(K,C.Plugin.Base,{_entries:null,_categories:null,_sources:null,initializer:function(){this._entries=[];this.get(Q).on("entry",this._onEntry,this);this.doAfter("renderUI",this.renderUI);this.doAfter("syncUI",this.syncUI);this.doAfter("bindUI",this.bindUI);this.doAfter("clearConsole",this._afterClearConsole);if(this.get(Q).get("rendered")){this.renderUI();this.syncUI();this.bindUI();}},destructor:function(){this._entries=[];if(this._categories){this._categories.get(H).removeChild(this._categories);}if(this._sources){this._sources.get(H).removeChild(this._sources);}},renderUI:function(){var W=this.get(Q).get("contentBox").query(I),V;if(W){V=C.substitute(K.CATEGORIES_TEMPLATE,K.CHROME_CLASSES);this._categories=W.appendChild(C.Node.create(V));V=C.substitute(K.SOURCES_TEMPLATE,K.CHROME_CLASSES);this._sources=W.appendChild(C.Node.create(V));}},bindUI:function(){this._categories.on("click",C.bind(this._onCategoryCheckboxClick,this));this._sources.on("click",C.bind(this._onSourceCheckboxClick,this));this.after("categoryChange",this._afterCategoryChange);this.after("sourceChange",this._afterSourceChange);},syncUI:function(){C.each(this.get(F),function(W,V){this._uiSetCheckbox(F,V,W);},this);C.each(this.get(D),function(W,V){this._uiSetCheckbox(D,V,W);},this);this.refreshConsole();},_onEntry:function(X){this._entries.push(X.message);var V=E+X.message.category,Z=M+X.message.source,W=this.get(V),a=this.get(Z),Y;if(W===undefined){Y=this.get(P);this.set(V,Y);W=Y;}if(a===undefined){Y=this.get(P);this.set(Z,Y);a=Y;}if(!W||!a){X.preventDefault();}},_afterClearConsole:function(){this._entries=[];},_afterCategoryChange:function(X){var V=X.subAttrName.replace(/category\./,U),W=X.prevVal,Y=X.newVal;if(!V||W[V]!==undefined){this.refreshConsole();this._filterBuffer();}if(V&&!X.fromUI){this._uiSetCheckbox(F,V,Y[V]);}},_afterSourceChange:function(W){var Y=W.subAttrName.replace(/source\./,U),V=W.prevVal,X=W.newVal;if(!Y||V[Y]!==undefined){this.refreshConsole();this._filterBuffer();}if(Y&&!W.fromUI){this._uiSetCheckbox(D,Y,X[Y]);}},_filterBuffer:function(){var W=this.get(F),Y=this.get(D),V=this.get(Q).buffer,Z=null,X;for(X=V.length-1;X>=0;--X){if(!W[V[X].category]||!Y[V[X].source]){Z=Z||X;}else{if(Z){V.splice(X,(Z-X));Z=null;}}}if(Z){V.splice(0,Z+1);}},refreshConsole:function(){var Z=this._entries,d=this.get(Q),a=d.get("contentBox").query(T),W=d.get("consoleLimit"),c=this.get(F),V=this.get(D),X=[],Y,b;if(a){d._cancelPrintLoop();for(Y=Z.length-1;Y>=0&&W>=0;--Y){b=Z[Y];if(c[b.category]&&V[b.source]){X.unshift(b);--W;}}a.set("innerHTML",U);d.buffer=X;d.printBuffer();}},_uiSetCheckbox:function(W,Z,Y){if(W&&Z){var V=W===F?this._categories:this._sources,b=A+R(G,L,Z),a=V.query(b),X;if(!a){X=this.get(Q);this._createCheckbox(V,Z);a=V.query(b);X._uiSetHeight(X.get("height"));}a.set(S,Y);}},_onCategoryCheckboxClick:function(X){var W=X.target,V;if(W.hasClass(K.CHROME_CLASSES.filter)){V=W.get("value");if(V&&V in this.get(F)){this.set(E+V,W.get(S),{fromUI:true});}}},_onSourceCheckboxClick:function(W){var V=W.target,X;if(V.hasClass(K.CHROME_CLASSES.filter)){X=V.get("value");if(X&&X in this.get(D)){this.set(M+X,V.get(S),{fromUI:true});}}},hideCategory:function(W,V){if(J(V)){C.Array.each(arguments,arguments.callee,this);}else{this.set(E+W,false);}},showCategory:function(W,V){if(J(V)){C.Array.each(arguments,arguments.callee,this);}else{this.set(E+W,true);}},hideSource:function(W,V){if(J(V)){C.Array.each(arguments,arguments.callee,this);}else{this.set(M+W,false);}},showSource:function(W,V){if(J(V)){C.Array.each(arguments,arguments.callee,this);}else{this.set(M+W,true);}},_createCheckbox:function(V,W){var Y=C.merge(K.CHROME_CLASSES,{filter_name:W,filter_class:R(G,L,W)}),X=C.Node.create(C.substitute(K.FILTER_TEMPLATE,Y));V.appendChild(X);},_validateCategory:function(V,W){return C.Lang.isObject(W,true)&&V.split(/\./).length<3;},_validateSource:function(W,V){return C.Lang.isObject(V,true)&&W.split(/\./).length<3;}});C.namespace("Plugin").ConsoleFilters=K;},"@VERSION@",{requires:["substitute","node","plugin"]});