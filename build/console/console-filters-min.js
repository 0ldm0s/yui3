YUI.add("console-filters",function(C){var O=C.ClassNameManager.getClassName,G="console",B="filters",K="filter",F="category",D="source",E="category.",L="source.",N="host",H="parentNode",P="checked",M=".",R="",Q=M+C.Console.CHROME_CLASSES.console_bd_class,I=M+C.Console.CHROME_CLASSES.console_ft_class,A="input[type=checkbox].";function J(){J.superclass.constructor.apply(this,arguments);}C.mix(J,{NAME:"consoleFilters",NS:K,CATEGORIES_TEMPLATE:'<div class="{controls} {categories}"></div>',SOURCES_TEMPLATE:'<div class="{controls} {sources}"></div>',FILTER_TEMPLATE:'<wbr><label class="{filter_label}">'+'<input type="checkbox" value="{filter_name}" '+'class="{filter} {filter_class}"> {filter_name}'+"</label>",CHROME_CLASSES:{controls:C.Console.CHROME_CLASSES.console_controls_class,categories:O(G,B,"categories"),sources:O(G,B,"sources"),category:O(G,K,F),source:O(G,K,D),filter:O(G,K),filter_label:O(G,K,"label")},ATTRS:{defaultVisibility:{value:true,validator:C.Lang.isBoolean},category:{value:{},validator:function(T,S){return this._validateCategory(S,T);}},source:{value:{},validator:function(T,S){return this._validateSource(S,T);}}}});C.extend(J,C.Plugin.Base,{_entries:null,_categories:null,_sources:null,initializer:function(){this._entries=[];this.get(N).on("entry",this._onEntry,this);this.doAfter("renderUI",this.renderUI);this.doAfter("syncUI",this.syncUI);this.doAfter("bindUI",this.bindUI);this.doAfter("clearConsole",this._afterClearConsole);if(this.get(N).get("rendered")){this.renderUI();this.syncUI();this.bindUI();}},destructor:function(){this._entries=[];if(this._categories){this._categories.get(H).removeChild(this._categories);}if(this._sources){this._sources.get(H).removeChild(this._sources);}},renderUI:function(){var T=this.get(N).get("contentBox").query(I),S;if(T){S=C.substitute(J.CATEGORIES_TEMPLATE,J.CHROME_CLASSES);this._categories=T.appendChild(C.Node.create(S));S=C.substitute(J.SOURCES_TEMPLATE,J.CHROME_CLASSES);this._sources=T.appendChild(C.Node.create(S));}},bindUI:function(){this._categories.on("click",C.bind(this._onCategoryCheckboxClick,this));this._sources.on("click",C.bind(this._onSourceCheckboxClick,this));this.after("categoryChange",this._afterCategoryChange);this.after("sourceChange",this._afterSourceChange);},syncUI:function(){C.each(this.get(F),function(T,S){this._uiSetCheckbox(F,S,T);},this);C.each(this.get(D),function(T,S){this._uiSetCheckbox(D,S,T);},this);this.refreshConsole();},_onEntry:function(U){this._entries.push(U.message);var S=E+U.message.category,W=L+U.message.source,T=this.get(S),X=this.get(W),V;if(T===undefined){V=this.get("defaultVisibility");this.set(S,V);T=V;}if(X===undefined){V=this.get("defaultVisibility");this.set(W,V);X=V;}if(!T||!X){U.preventDefault();}},_afterClearConsole:function(){this._entries=[];},_afterCategoryChange:function(U){var S=U.subAttrName.replace(/category\./,R),T=U.prevVal,V=U.newVal;if(!S||T[S]!==undefined){this.refreshConsole();this._filterBuffer();}if(S&&!U.fromUI){this._uiSetCheckbox(F,S,V);}},_afterSourceChange:function(T){var V=T.subAttrName.replace(/source\./,R),S=T.prevVal,U=T.newVal;if(!V||S[V]!==undefined){this.refreshConsole();this._filterBuffer();}if(V&&!T.fromUI){this._uiSetCheckbox(D,V,U);}},_filterBuffer:function(){var T=this.get(F),V=this.get(D),S=this.get(N).buffer,W=null,U;for(U=S.length-1;U>=0;--U){if(!T[S[U].category]||!V[S[U].source]){W=W||U;}else{if(W){S.splice(U,(W-U));W=null;}}}if(W){S.splice(0,W+1);}},refreshConsole:function(){var W=this._entries,a=this.get(N),X=a.get("contentBox").query(Q),T=a.get("consoleLimit"),Z=this.get(F),S=this.get(D),U=[],V,Y;if(X){a._cancelPrintLoop();for(V=W.length-1;V>=0&&T>=0;--V){Y=W[V];if(Z[Y.category]&&S[Y.source]){U.unshift(Y);--T;}}X.set("innerHTML",R);a.buffer=U;a.printBuffer();}},_uiSetCheckbox:function(T,W,V){if(T&&W){var S=T===F?this._categories:this._sources,Y=A+O(G,K,W),X=S.query(Y),U;if(!X){U=this.get(N);this._createCheckbox(S,W);X=S.query(Y);U._uiSetHeight(U.get("height"));}X.set(P,V);}},_onCategoryCheckboxClick:function(U){var T=U.target,S;if(T.hasClass(J.CHROME_CLASSES.filter)){S=T.get("value");if(S&&S in this.get(F)){this.set(E+S,T.get(P),{fromUI:true});}}},_onSourceCheckboxClick:function(T){var S=T.target,U;if(S.hasClass(J.CHROME_CLASSES.filter)){U=S.get("value");if(U&&U in this.get(D)){this.set(L+U,S.get(P),{fromUI:true});}}},hideCategory:function(T,S){if(S){C.Array.each(arguments,arguments.callee,this);}else{this.set(E+T,false);}},showCategory:function(T,S){if(S){C.Array.each(arguments,arguments.callee,this);}else{this.set(E+T,true);}},hideSource:function(T,S){if(S){C.Array.each(arguments,arguments.callee,this);}else{this.set(E+T,false);}},showSource:function(T,S){if(S){C.Array.each(arguments,arguments.callee,this);}else{this.set(E+T,true);}},_createCheckbox:function(S,T){var V=C.merge(J.CHROME_CLASSES,{filter_name:T,filter_class:O(G,K,T)}),U=C.Node.create(C.substitute(J.FILTER_TEMPLATE,V));S.appendChild(U);},_validateCategory:function(S,T){return C.Lang.isObject(T,true)&&S.split(/\./).length<3;},_validateSource:function(T,S){return C.Lang.isObject(S,true)&&T.split(/\./).length<3;}});C.namespace("Plugin").ConsoleFilters=J;},"@VERSION@",{requires:["substitute","node","plugin"]});