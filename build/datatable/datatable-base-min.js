YUI.add("datatable-base",function(B){function V(Y){V.superclass.constructor.apply(this,arguments);}V.NAME="column";V.ATTRS={id:{valueFn:"_defaultId",writeOnce:true},key:{valueFn:"_defaultKey"},field:{valueFn:"_defaultField"},label:{valueFn:"_defaultLabel"},keyIndex:{readOnly:true},parent:{readOnly:true},children:{},colspan:{readOnly:true},rowspan:{readOnly:true},thNode:{readOnly:true},thLinerNode:{readOnly:true},thLabelNode:{readOnly:true},abbr:{value:null},className:{},editor:{},formatter:{},resizeable:{},sortable:{},hidden:{},width:{},minWidth:{},maxAutoWidth:{}};B.extend(V,B.Widget,{_defaultId:function(){return B.guid();},_defaultKey:function(Y){return Y||B.guid();},_defaultField:function(Y){return Y||this.get("key");},_defaultLabel:function(Y){return Y||this.get("key");},initializer:function(){},destructor:function(){},syncUI:function(){this._uiSetAbbr(this.get("abbr"));},_afterAbbrChange:function(Y){this._uiSetAbbr(Y.newVal);},_uiSetAbbr:function(Y){this._thNode.set("abbr",Y);}});B.Column=V;var J=B.Lang;function L(Y){L.superclass.constructor.apply(this,arguments);}L.NAME="columnset";L.ATTRS={columns:{setter:"_setColumns"},tree:{readOnly:true,value:[]},flat:{readOnly:true,value:[]},hash:{readOnly:true,value:{}},keys:{readOnly:true,value:[]}};B.extend(L,B.Base,{_setColumns:function(Y){return B.clone(Y);},initializer:function(){var Y=[],p=[],o={},n=[],m=this.get("columns"),k=this;function l(x,s,w){var u=0,r=s.length,t,v,q;x++;if(!Y[x]){Y[x]=[];}for(;u<r;++u){t=s[u];t=J.isString(t)?{key:t}:t;v=new B.Column(t);t.yuiColumnId=v.get("id");p.push(v);o[v.get("id")]=v;if(w){v._set("parent",w);}if(J.isArray(t.children)){q=t.children;v._set("children",q);k._setColSpans(v,t);k._cascadePropertiesToChildren(v,q);if(!Y[x+1]){Y[x+1]=[];}l(x,q,v);}else{v._set("keyIndex",n.length);v._set("colspan",1);n.push(v);}Y[x].push(v);}x--;}l(-1,m);this._set("tree",Y);this._set("flat",p);this._set("hash",o);this._set("keys",n);this._setRowSpans();this._setHeaders();},destructor:function(){},_cascadePropertiesToChildren:function(m,k){var l=0,Y=k.length,n;for(;l<Y;++l){n=k[l];if(m.get("className")&&(n.className===undefined)){n.className=m.get("className");}if(m.get("editor")&&(n.editor===undefined)){n.editor=m.get("editor");}if(m.get("formatter")&&(n.formatter===undefined)){n.formatter=m.get("formatter");}if(m.get("resizeable")&&(n.resizeable===undefined)){n.resizeable=m.get("resizeable");}if(m.get("sortable")&&(n.sortable===undefined)){n.sortable=m.get("sortable");}if(m.get("hidden")){n.hidden=true;}if(m.get("width")&&(n.width===undefined)){n.width=m.get("width");}if(m.get("minWidth")&&(n.minWidth===undefined)){n.minWidth=m.get("minWidth");}if(m.get("maxAutoWidth")&&(n.maxAutoWidth===undefined)){n.maxAutoWidth=m.get("maxAutoWidth");}}},_setColSpans:function(m,k){var l=0;function Y(p){var q=p.children,o=0,n=q.length;for(;o<n;++o){if(J.isArray(q[o].children)){Y(q[o]);}else{l++;}}}Y(k);m._set("colspan",l);},_setRowSpans:function(){function Y(l){var n=1,q,o,k,s;function r(v,u){u=u||1;var t=0,m=v.length,p;for(;t<m;++t){p=v[t];if(J.isArray(p.children)){u++;r(p.children,u);u--;}else{if(p.get&&J.isArray(p.get("children"))){u++;r(p.get("children"),u);u--;}else{if(u>n){n=u;}}}}}for(k=0;k<l.length;k++){q=l[k];r(q);for(s=0;s<q.length;s++){o=q[s];if(!J.isArray(o.get("children"))){o._set("rowspan",n);}else{o._set("rowspan",1);}}n=1;}}Y(this.get("tree"));},_setHeaders:function(){var o,m,l=this.get("keys"),k=0,Y=l.length;function n(q,p){q.push(p.get("key"));if(p.get("parent")){n(q,p.get("parent"));}}for(;k<Y;++k){o=[];m=l[k];n(o,m);m._set("headers",o.reverse().join(" "));}},getColumn:function(){}});B.Columnset=L;var C=B.Lang,T=B.Lang.substitute,f=B.Node,H=f.create,D=B.ClassNameManager.getClassName,g=B.bind,O="datatable",F="focus",E="keydown",b="mouseover",j="mouseout",M="mouseup",P="mousedown",K="click",G="doubleclick",Q=D(O,"columns"),A=D(O,"data"),I=D(O,"msg"),N=D(O,"liner"),Z=D(O,"first"),S=D(O,"last"),e="<table></table>",X="<col></col>",c='<thead class="'+Q+'"></thead>',h='<tbody class="'+A+'"></tbody>',a='<th id="{id}" rowspan="{rowspan}" colspan="{colspan}"><div class="'+N+'">{value}</div></th>',R='<tr id="{id}"></tr>',d='<td headers="{headers}"><div class="'+N+'">{value}</div></td>',U="{value}",W='<tbody class="'+I+'"></tbody>';function i(Y){i.superclass.constructor.apply(this,arguments);}i.NAME="dataTable";i.ATTRS={columnset:{setter:"_setColumnset"},recordset:{setter:"_setRecordset"},state:{value:new B.State(),readOnly:true},strings:{valueFn:function(){return B.Intl.get("datatable-base");}},thValueTemplate:{value:U},tdValueTemplate:{value:U},trTemplate:{value:R}};i.HTML_PARSER={attrA:function(Y){}};B.extend(i,B.Widget,{thTemplate:a,tdTemplate:d,_theadNode:null,_tbodyNode:null,_msgNode:null,_setColumnset:function(Y){return C.isArray(Y)?new B.Columnset({columns:Y}):Y;},_setRecordset:function(Y){if(C.isArray(Y)){Y=new B.Recordset({records:Y});}Y.addTarget(this);return Y;},initializer:function(){this.publish("addTheadTr",{defaultFn:this._defAddTheadTrFn});this.publish("addTheadTh",{defaultFn:this._defAddTheadThFn});this.publish("addTr",{defaultFn:this._defAddTrFn});this.publish("addTd",{defaultFn:this._defAddTdFn});this.publish("theadCellClick",{emitFacade:false});this.publish("theadRowClick",{emitFacade:false});this.publish("theadClick",{emitFacade:false});},destructor:function(){this.get("recordset").removeTarget(this);},renderUI:function(){var Y=this._createTableNode()&&this._createColgroupNode(this._tableNode)&&this._createTheadNode(this._tableNode)&&this._createTbodyNode(this._tableNode)&&this._createMessageNode(this._tableNode)&&this._createCaptionNode(this._tableNode);return Y;},_createTableNode:function(){if(!this._tableNode){this._tableNode=this.get("contentBox").appendChild(H(e));}return this._tableNode;},_createColgroupNode:function(m){var l=this.get("columnset").get("keys"),k=0,Y=l.length,n=["<colgroup>"];for(;k<Y;++k){n.push(X);}n.push("</colgroup>");this._colgroupNode=m.insertBefore(H(n.join("")),m.get("firstChild"));
return this._colgroupNode;},_createTheadNode:function(Y){if(Y){this._theadNode=Y.insertBefore(H(c),this._colgroupNode.next());return this._theadNode;}},_createTbodyNode:function(Y){this._tbodyNode=Y.appendChild(H(h));return this._tbodyNode;},_createMessageNode:function(Y){this._msgNode=Y.insertBefore(H(W),this._tbodyNode);return this._msgNode;},_createCaptionNode:function(Y){this._captionNode=Y.invoke("createCaption");return this._captionNode;},bindUI:function(){var n=this._tableNode,k=this.get("contentBox"),l="thead."+Q+">tr>th",m="tbody."+A+">tr>td",Y="tbody."+I+">tr>td";n.delegate(F,g(this._onTheadFocus,this),l);n.delegate(E,g(this._onTheadKeydown,this),l);n.delegate(b,g(this._onTheadMouseover,this),l);n.delegate(j,g(this._onTheadMouseout,this),l);n.delegate(M,g(this._onTheadMouseup,this),l);n.delegate(P,g(this._onTheadMousedown,this),l);n.delegate(K,g(this._onTheadClick,this),l);k.delegate(G,g(this._onTheadDoubleclick,this),l);n.delegate(F,g(this._onTbodyFocus,this),m);n.delegate(E,g(this._onTbodyKeydown,this),m);n.delegate(b,g(this._onTbodyMouseover,this),m);n.delegate(j,g(this._onTbodyMouseout,this),m);n.delegate(M,g(this._onTbodyMouseup,this),m);n.delegate(P,g(this._onTbodyMousedown,this),m);n.delegate("click",g(this._onTbodyClick,this),m);k.delegate(G,g(this._onTbodyDoubleclick,this),m);n.delegate(F,g(this._onMsgFocus,this),Y);n.delegate(E,g(this._onMsgKeydown,this),Y);n.delegate(b,g(this._onMsgMouseover,this),Y);n.delegate(j,g(this._onMsgMouseout,this),Y);n.delegate(M,g(this._onMsgMouseup,this),Y);n.delegate(P,g(this._onMsgMousedown,this),Y);n.delegate("click",g(this._onMsgClick,this),Y);k.delegate(G,g(this._onMsgDoubleclick,this),Y);},_onTheadFocus:function(){},_onTheadKeydown:function(){},_onTheadMouseover:function(){},_onTheadMouseout:function(){},_onTheadMouseup:function(){},_onTheadMousedown:function(){},_onTheadClick:function(Y){this.fire("theadCellClick",Y);this.fire("theadRowClick",Y);this.fire("theadClick",Y);},_onTheadDoubleclick:function(){},_onTbodyFocus:function(){},_onTbodyKeydown:function(){},_onTbodyMouseover:function(){},_onTbodyMouseout:function(){},_onTbodyMouseup:function(){},_onTbodyMousedown:function(){},_onTbodyClick:function(Y){},_onTbodyDoubleclick:function(){},_onMsgFocus:function(){},_onMsgKeydown:function(){},_onMsgMouseover:function(){},_onMsgMouseout:function(){},_onMsgMouseup:function(){},_onMsgMousedown:function(){},_onMsgClick:function(Y){},_onMsgDoubleclick:function(){},syncUI:function(){this._uiSetStrings(this.get("strings"));this._uiSetColumnset(this.get("columnset"));this._uiSetRecordset(this.get("recordset"));},_afterStringsChange:function(Y){this._uiSetStrings(Y.newVal);},_uiSetStrings:function(Y){this._uiSetSummary(Y.summary);this._uiSetCaption(Y.caption);},_uiSetSummary:function(Y){this._tableNode.set("summary",Y);},_uiSetCaption:function(Y){this._captionNode.setContent(Y);},_afterColumnsetChange:function(Y){this._uiSetColumnset(Y.newVal);},_uiSetColumnset:function(o){var k=o.get("tree"),l=this._theadNode,n=0,Y=k.length,m;l.get("children").remove(true);for(;n<Y;++n){this.addTheadTr(l,k[n],n,(n===Y-1));}},addTheadTr:function(Y,l,k,n){var m=H(this._getTheadTrMarkup(l));if(k===0){m.addClass(Z);}if(n){m.addClass(S);}this.fire("addTheadTr",{columns:l,thead:Y,tr:m});},_defAddTheadTrFn:function(q){var l=q.columns,p=q.thead,o=q.tr,k=0,Y=l.length,m,n;for(;k<Y;++k){m=l[k];n=H(this._getTheadThMarkup({value:m.get("label")},m));this.fire("addTheadTh",{column:m,tr:o,th:n});}p.appendChild(o);},_getTheadTrMarkup:function(Y){return T(this.get("trTemplate"),{});},_defAddTheadThFn:function(Y){Y.tr.appendChild(Y.th);},_getTheadThMarkup:function(k,Y){k.column=Y;k.id=Y.get("id");k.value=T(this.get("thValueTemplate"),k);k.colspan=Y.get("colspan");k.rowspan=Y.get("rowspan");return T(this.thTemplate,k);},_afterRecordsetChange:function(Y){this._uiSetRecordset(Y.newVal);},_uiSetRecordset:function(k){var l=0,Y=3;for(;l<Y;++l){this.fire("addTr",{record:k.getRecord(l),index:l});}},_defAddTrFn:function(o){var Y=o.record,k=o.index,l=this._tbodyNode,n=l.get("children").item(k)||null,m=l.one("#"+Y.get("id"))||this._createBodyTr(Y);l.insertBefore(m,n);return m;},_createBodyTr:function(Y){var k=H(this._getDataTrMarkup(Y));this._createTdNodes(Y,k);return k;},_getDataTrMarkup:function(Y){return T(this.get("trTemplate"),{id:Y.get("id")});},_createTdNodes:function(k,o){var l=0,n=this.get("columnset").get("keys"),Y=n.length,m=[];for(;l<Y;++l){m.push(this._getTdNodeMarkup(k,n[l]));}o.appendChild(H(m.join("")));},_getTdNodeMarkup:function(Y,k){var l={};l.headers=k.get("headers");l.value=this.formatDataCell(Y,k);return T(this.tdTemplate,l);},formatDataCell:function(Y,k){var l={};l.data=Y.get("data");l.value=Y.getValue(k.get("key"));return T(this.get("tdValueTemplate"),l);}});B.namespace("DataTable").Base=i;},"@VERSION@",{lang:["en"],requires:["intl","substitute","widget","recordset"]});