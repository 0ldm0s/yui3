YUI.add("datatable-base",function(B){function L(S){L.superclass.constructor.apply(this,arguments);}L.NAME="column";L.ATTRS={id:{valueFn:"_defaultId",writeOnce:true},key:{valueFn:"_defaultKey"},field:{valueFn:"_defaultField"},label:{valueFn:"_defaultLabel"},keyIndex:{readOnly:true},parent:{readOnly:true},children:{},colspan:{readOnly:true},rowspan:{readOnly:true},thNode:{readOnly:true},thLinerNode:{readOnly:true},thLabelNode:{readOnly:true},abbr:{value:null},className:{},editor:{},formatter:{},resizeable:{},sortable:{},hidden:{},width:{},minWidth:{},maxAutoWidth:{}};B.extend(L,B.Widget,{_defaultId:function(){return B.guid();},_defaultKey:function(S){return S||B.guid();},_defaultField:function(S){return S||this.get("key");},_defaultLabel:function(S){return S||this.get("key");},initializer:function(){},destructor:function(){},syncUI:function(){this._uiSetAbbr(this.get("abbr"));},_afterAbbrChange:function(S){this._uiSetAbbr(S.newVal);},_uiSetAbbr:function(S){this._thNode.set("abbr",S);}});B.Column=L;var D=B.Lang;function E(S){E.superclass.constructor.apply(this,arguments);}E.NAME="columnset";E.ATTRS={columns:{setter:"_setColumns"},tree:{readOnly:true,value:[]},flat:{readOnly:true,value:[]},hash:{readOnly:true,value:{}},keys:{readOnly:true,value:[]}};B.extend(E,B.Base,{_setColumns:function(S){return B.clone(S);},initializer:function(){var S=[],Y=[],X={},W=[],V=this.get("columns"),T=this;function U(g,b,f){var d=0,a=b.length,c,e,Z;g++;if(!S[g]){S[g]=[];}for(;d<a;++d){c=b[d];c=D.isString(c)?{key:c}:c;e=new B.Column(c);c.yuiColumnId=e.get("id");Y.push(e);X[e.get("id")]=e;if(f){e._set("parent",f);}if(D.isArray(c.children)){Z=c.children;e._set("children",Z);T._setColSpans(e,c);T._cascadePropertiesToChildren(e,Z);if(!S[g+1]){S[g+1]=[];}U(g,Z,e);}else{e._set("keyIndex",W.length);e._set("colspan",1);W.push(e);}S[g].push(e);}g--;}U(-1,V);this._set("tree",S);this._set("flat",Y);this._set("hash",X);this._set("keys",W);this._setRowSpans();this._setHeaders();},destructor:function(){},_cascadePropertiesToChildren:function(V,T){var U=0,S=T.length,W;for(;U<S;++U){W=T[U];if(V.get("className")&&(W.className===undefined)){W.className=V.get("className");}if(V.get("editor")&&(W.editor===undefined)){W.editor=V.get("editor");}if(V.get("formatter")&&(W.formatter===undefined)){W.formatter=V.get("formatter");}if(V.get("resizeable")&&(W.resizeable===undefined)){W.resizeable=V.get("resizeable");}if(V.get("sortable")&&(W.sortable===undefined)){W.sortable=V.get("sortable");}if(V.get("hidden")){W.hidden=true;}if(V.get("width")&&(W.width===undefined)){W.width=V.get("width");}if(V.get("minWidth")&&(W.minWidth===undefined)){W.minWidth=V.get("minWidth");}if(V.get("maxAutoWidth")&&(W.maxAutoWidth===undefined)){W.maxAutoWidth=V.get("maxAutoWidth");}}},_setColSpans:function(V,T){var U=0;function S(Y){var Z=Y.children,X=0,W=Z.length;for(;X<W;++X){if(D.isArray(Z[X].children)){S(Z[X]);}else{U++;}}}S(T);V._set("colspan",U);},_setRowSpans:function(){function S(U){var V=1,X,W,T,Z;function Y(e,d){d=d||1;var c=0,a=e.length,b;for(;c<a;++c){b=e[c];if(D.isArray(b.children)){d++;Y(b.children,d);d--;}else{if(b.get&&D.isArray(b.get("children"))){d++;Y(b.get("children"),d);d--;}else{if(d>V){V=d;}}}}}for(T=0;T<U.length;T++){X=U[T];Y(X);for(Z=0;Z<X.length;Z++){W=X[Z];if(!D.isArray(W.get("children"))){W._set("rowspan",V);}else{W._set("rowspan",1);}}V=1;}}S(this.get("tree"));},_setHeaders:function(){var X,V,U=this.get("keys"),T=0,S=U.length;function W(Z,Y){Z.push(Y.get("key"));if(Y.get("parent")){W(Z,Y.get("parent"));}}for(;T<S;++T){X=[];V=U[T];W(X,V);V._set("headers",X.reverse().join(" "));}},getColumn:function(){}});B.Columnset=E;var G=B.Lang,R=B.Node,P=B.ClassNameManager.getClassName,F=B.bind,H="datatable",A=P(H,"data"),C=P(H,"msg"),M=P(H,"first"),J=P(H,"last"),N='<th id="{id}" rowspan="{rowspan}" colspan="{colspan}">{value}</th>',I='<tr id="{id}"></tr>',O='<td headers="{headers}">{value}</td>',K="{value}";function Q(S){Q.superclass.constructor.apply(this,arguments);}Q.NAME="baseDataTable";Q.ATTRS={columnset:{setter:"_setColumnset"},recordset:{setter:"_setRecordset"},state:{value:new B.State(),readOnly:true},strings:{valueFn:function(){return B.Intl.get("datatable-base");}},thValueTemplate:{value:K},tdValueTemplate:{value:K},trTemplate:{value:I}};Q.HTML_PARSER={attrA:function(S){}};B.extend(Q,B.Widget,{thTemplate:N,tdTemplate:O,_theadNode:null,_tbodyNode:null,_msgNode:null,_setColumnset:function(S){return G.isArray(S)?new B.Columnset({columns:S}):S;},_setRecordset:function(S){if(G.isArray(S)){S=new B.Recordset({records:S});}S.addTarget(this);return S;},initializer:function(){this.publish("addTr",{defaultFn:F("_defAddTrFn",this),queuable:true});this.publish("theadCellClick",{emitFacade:false,defaultFn:F("_defTheadCellClickFn",this),queuable:true});this.publish("theadRowClick",{emitFacade:false,defaultFn:F("_defTheadRowClickFn",this),queuable:true});this.publish("theadClick",{emitFacade:false,defaultFn:F("_defTheadClickFn",this),queuable:true});},destructor:function(){this.get("recordset").removeTarget(this);},renderUI:function(){var S=this._createTableNode();S=S?this._createColgroupNode(this._tableNode):false;S=S?this._createTheadNode(this._tableNode):false;S=S?this._createTbodyNode(this._tableNode):false;S=S?this._createMessageNode(this._tableNode):false;S=S?this._createCaptionNode(this._tableNode):false;return S;},_createTableNode:function(){if(!this._tableNode){this._tableNode=this.get("contentBox").appendChild(R.create("<table></table>"));}return this._tableNode;},_createColgroupNode:function(V){var U=this.get("columnset").get("keys"),T=0,S=U.length,W=["<colgroup>"];for(;T<S;++T){W.push("<col></col>");}W.push("</colgroup>");this._colgroupNode=V.insertBefore(R.create(W.join("")),V.get("firstChild"));return this._colgroupNode;},_createTheadNode:function(S){if(S){this._theadNode=S.insertBefore(R.create("<thead class='"+A+"'></thead>"),this._colgroupNode.next());return this._theadNode;}},_createTbodyNode:function(S){this._tbodyNode=S.appendChild(R.create("<tbody class='"+A+"'></tbody>"));
return this._tbodyNode;},_createMessageNode:function(S){this._msgNode=S.insertBefore(R.create("<tbody class='"+C+"'></tbody>"),this._tbodyNode);return this._msgNode;},_createCaptionNode:function(S){this._captionNode=S.invoke("createCaption");return this._captionNode;},bindUI:function(){var U=this._theadNode,V=this._tbodyNode,T=this._msgNode,S=this.get("contentBox");this._tableNode.delegate("click",F(this._onTheadClick,this),"thead."+A+">tr>th");this._tableNode.delegate("click",F(this._onTbodyClick,this),"tbody."+A+">tr>td");this._tableNode.delegate("click",F(this._onMsgClick,this),"tbody."+C+">tr>td");},_onTheadFocus:function(){},_onTheadKeydown:function(){},_onTheadClick:function(U,T,S){this.fire("theadCellClick",U);this.fire("theadRowClick",U);this.fire("theadClick",U);},_onTbodyFocus:function(){},_onTbodyKeydown:function(){},_onTbodyClick:function(){},_onTableMouseover:function(){},_onTableMouseout:function(){},_onTableMousedown:function(){},_onTableMouseup:function(){},_onTableKeypress:function(){},_onTableFocus:function(){},_onTableDblclick:function(){},_defTheadCellClickFn:function(){},syncUI:function(){this._uiSetStrings(this.get("strings"));this._uiSetColumnset(this.get("columnset"));this._uiSetRecordset(this.get("recordset"));},_afterStringsChange:function(S){this._uiSetStrings(S.newVal);},_uiSetStrings:function(S){this._uiSetSummary(S.summary);this._uiSetCaption(S.caption);},_uiSetSummary:function(S){this._tableNode.set("summary",S);},_uiSetCaption:function(S){this._captionNode.set("innerHTML",S);},_afterColumnsetChange:function(S){this._uiSetColumnset(S.newVal);},_uiSetColumnset:function(W){var T=W.get("tree"),U=this._theadNode,X,V=0,S=T.length;for(;V<S;++V){X=this._createHeaderTr(T[V]);if(V===0){X.addClass(M);}if(V===(S-1)){X.addClass(J);}U.appendChild(X);}},_createHeaderTr:function(S){var T=R.create(this._getHeaderTrMarkup(S));this._createThNodes(S,T);this.fire("addHeaderTr",{record:S,tr:T});return T;},_getHeaderTrMarkup:function(S){return B.substitute(this.get("trTemplate"),{});},_createThNodes:function(X,W){var U=0,S=X.length,T=[],V,Y;for(;U<S;++U){V=X[U];T.push(this._getThNodeMarkup({value:V.get("label")},V));}W.appendChild(R.create(T.join("")));},_getThNodeMarkup:function(T,S){T.column=S;T.id=S.get("id");T.value=B.substitute(this.get("thValueTemplate"),T);T.colspan=S.get("colspan");T.rowspan=S.get("rowspan");return B.substitute(this.thTemplate,T);},_afterRecordsetChange:function(S){this._uiSetRecordset(S.newVal);},_uiSetRecordset:function(U){var W=this._tbodyNode,V=0,S=3,T,Y,X;for(;V<S;++V){T=U.getRecord(V);Y=W.one("#"+T.get("id"))||this._createBodyTr(T);X=W.get("children").item(V)||null;W.insertBefore(Y,X);}},_createBodyTr:function(S){var T=R.create(this._getDataTrMarkup(S));this._createTdNodes(S,T);this.fire("addDataTr",{record:S,tr:T});return T;},_getDataTrMarkup:function(S){return B.substitute(this.get("trTemplate"),{id:S.get("id")});},_createTdNodes:function(T,X){var U=0,W=this.get("columnset").get("keys"),S=W.length,V=[];for(;U<S;++U){V.push(this._getTdNodeMarkup(T,W[U]));}X.appendChild(R.create(V.join("")));},_getTdNodeMarkup:function(S,T){var U={};U.headers=T.get("headers");U.value=this.formatDataCell(S,T);return B.substitute(this.tdTemplate,U);},formatDataCell:function(S,T){var U={};U.data=S.get("data");U.value=S.getValue(T.get("key"));return B.substitute(this.get("tdValueTemplate"),U);}});B.namespace("DataTable").Base=Q;},"@VERSION@",{lang:["en"],requires:["intl","substitute","widget","recordset"]});YUI.add("datatable-sort",function(G){var A=G.ArraySort.compare,C="asc",B="desc",E='<a class="{link_class}" title="{link_title}" href="{link_href}">{value}</a>';function F(H,I,J){F.superclass.constructor.apply(this,arguments);}G.mix(F,{NS:"sort",NAME:"recordsetSort",ATTRS:{dt:{},defaultSorter:{value:function(J,H,K,L){var I=A(J.getValue(K),H.getValue(K),L);if(I===0){return A(J.get("id"),H.get("id"),L);}else{return I;}}}}});G.extend(F,G.Plugin.Base,{initializer:function(H){this.addTarget(this.get("dt"));this.publish("sort",{defaultFn:G.bind("_defSortFn",this)});},destructor:function(H){},_defSortFn:function(H){this.get("host").get("records").sort(function(J,I){return(H.sorter)(J,I,H.field,H.desc);});},sort:function(H,I,J){this.fire("sort",{field:H,desc:I,sorter:J||this.get("defaultSorter")});},custom:function(){alert("sort custom");},asc:function(){alert("sort asc");},desc:function(){alert("sort desc");},reverse:function(){alert("sort reverse");}});G.namespace("Plugin").RecordsetSort=F;function D(){D.superclass.constructor.apply(this,arguments);}G.mix(D,{NS:"sort",NAME:"dataTableSort",ATTRS:{sortedBy:{value:null}}});G.extend(D,G.Plugin.Base,{thLinkTemplate:E,initializer:function(H){var I=this.get("host");I.get("recordset").plug(F,{dt:I});I.on("theadCellClick",this._onEventSortColumn);I.after("recordsetSort:sort",function(){I._uiSetRecordset(I.get("recordset"));});I.after("sortedByChangeEvent",function(){alert("ok");});},_onEventSortColumn:function(L){L.halt();var J=this.get("columnset").get("hash")[L.target.get("id")],K=J.get("field"),I=this.get("sortedBy"),H=(I&&I.field===K&&I.dir===C)?B:C,M=J.get("sortFn");this.get("recordset").sort.sort(K,H===B,M);this.set("sortedBy",{field:K,dir:H});}});G.namespace("Plugin").DataTableSort=D;},"@VERSION@",{lang:["en"],requires:["plugin","datatable-base"]});YUI.add("datatable-colresize",function(E){var B=E.ClassNameManager.getClassName,F="datatable",A=B(F,"liner"),D='<div class="'+A+'">{value}</div>';function C(){C.superclass.constructor.apply(this,arguments);}E.mix(C,{NS:"colresize",NAME:"dataTableColResize",ATTRS:{}});E.extend(C,E.Plugin.Base,{thLinerTemplate:D,tdLinerTemplate:D,initializer:function(G){this.get("host").thTemplate=E.substitute(this.get("host").thTemplate,{value:this.thLinerTemplate});this.get("host").tdTemplate=E.substitute(this.get("host").tdTemplate,{value:this.tdLinerTemplate});}});E.namespace("Plugin").DataTableColResize=C;},"@VERSION@",{requires:["plugin","dd","datatable-base"]});YUI.add("datatable",function(A){},"@VERSION@",{use:["datatable-base","datatable-sort","datatable-colresize"]});
