YUI.add("selection",function(A){YUI.add("selection",function(C){var B="textContent",E="innerHTML",D="fontFamily";if(C.UA.ie){B="nodeValue";}C.Selection=function(K){var L,J,F,H,G,I;if(C.config.win.getSelection){L=C.config.win.getSelection();}else{if(C.config.doc.selection){L=C.config.doc.selection.createRange();}}this._selection=L;if(L.pasteHTML){this.isCollapsed=(L.compareEndPoints("StartToEnd",L))?false:true;if(this.isCollapsed){this.anchorNode=this.focusNode=C.one(L.parentElement());if(K){F=C.config.doc.elementFromPoint(K.clientX,K.clientY);}if(!F){J=L.parentElement();H=J.childNodes;G=L.duplicate();for(I=0;I<H.length;I++){if(G.inRange(L)){F=H[I];}}}this.ieNode=F;if(F){if(F.nodeType!==3){if(F.firstChild){F=F.firstChild;}}this.anchorNode=this.focusNode=C.Selection.resolve(F);this.anchorOffset=this.focusOffset=(this.anchorNode.nodeValue)?this.anchorNode.nodeValue.length:0;this.anchorTextNode=this.focusTextNode=C.one(F);}}}else{this.isCollapsed=L.isCollapsed;this.anchorNode=C.Selection.resolve(L.anchorNode);this.focusNode=C.Selection.resolve(L.focusNode);this.anchorOffset=L.anchorOffset;this.focusOffset=L.focusOffset;this.anchorTextNode=C.one(L.anchorNode);this.focusTextNode=C.one(L.focusNode);}if(C.Lang.isString(L.text)){this.text=L.text;}else{this.text=L.toString();}};C.Selection.filter=function(F){var I=(new Date()).getTime();var H=C.all(C.Selection.ALL),L=C.all("strong,em"),G={},J="",M;var K=(new Date()).getTime();H.each(function(Q){var P=C.Node.getDOMNode(Q);if(P.style[D]){G["."+Q._yuid]=P.style[D];Q.addClass(Q._yuid);P.style[D]="";P.removeAttribute("face");if(P.getAttribute("style")===""){P.removeAttribute("style");}if(P.getAttribute("style")){if(P.getAttribute("style").toLowerCase()==="font-family: "){P.removeAttribute("style");}}}});var O=(new Date()).getTime();C.each(G,function(Q,P){J+=P+" { font-family: "+Q.replace(/"/gi,"")+"; }";});C.StyleSheet(J,"editor");L.each(function(S,P){var Q=S.get("tagName").toLowerCase(),R="i";if(Q==="strong"){R="b";}C.Selection.prototype._swap(L.item(P),R);});M=C.all("ol,ul");M.each(function(Q,P){var R=Q.all("li");if(!R.size()){Q.remove();}});if(F){C.Selection.filterBlocks();}var N=(new Date()).getTime();};C.Selection.filterBlocks=function(){var G=(new Date()).getTime();var N=C.config.doc.body.childNodes,I,H,Q=false,K=true,F,R,S,P,M,O,T;if(N){for(I=0;I<N.length;I++){H=C.one(N[I]);if(!H.test(C.Selection.BLOCKS)){K=true;if(N[I].nodeType==3){O=N[I][B].match(C.Selection.REG_CHAR);T=N[I][B].match(C.Selection.REG_NON);if(O===null&&T){K=false;}}if(K){if(!Q){Q=[];}Q.push(N[I]);}}else{Q=C.Selection._wrapBlock(Q);}}Q=C.Selection._wrapBlock(Q);}R=C.all("p");if(R.size()===1){S=R.item(0).all("br");if(S.size()===1){S.item(0).remove();var J=R.item(0).get("innerHTML");if(J==""||J==" "){R.set("innerHTML",C.Selection.CURSOR);F=new C.Selection();F.focusCursor(true,true);}}}else{R.each(function(V){var U=V.get("innerHTML");if(U===""){V.remove();}});}if(!C.UA.ie){P=C.all("div, p");P.each(function(V){var U=V.get("innerHTML");if(U===""){V.remove();}else{if(V.get("childNodes").size()==1){if(V.ancestor("p")){V.replace(V.get("firstChild"));}}}});M=C.all(".Apple-style-span, .apple-style-span");M.each(function(U){U.setAttribute("style","");});}var L=(new Date()).getTime();};C.Selection.REG_CHAR=/[a-zA-Z-0-9_]/gi;C.Selection.REG_NON=/[\s\S|\n|\t]/gi;C.Selection._wrapBlock=function(G){if(G){var F=C.Node.create("<p></p>"),I=C.one(G[0]),H;for(H=1;H<G.length;H++){F.append(G[H]);}I.replace(F);F.prepend(I);}return false;};C.Selection.unfilter=function(){var G=C.all("body [class]"),H="",F,I;G.each(function(J){if(J.hasClass(J._yuid)){J.setStyle(D,J.getStyle(D));J.removeClass(J._yuid);if(J.getAttribute("class")===""){J.removeAttribute("class");}}});F=C.all(".yui-non");F.each(function(J){if(J.get("innerHTML")===""){J.remove();}else{J.removeClass("yui-non");}});I=C.all("body [id]");I.each(function(J){if(J.get("id").indexOf("yui_3_")===0){J.removeAttribute("id");J.removeAttribute("_yuid");}});H=C.one("body").get("innerHTML");G.each(function(J){J.addClass(J._yuid);J.setStyle(D,"");if(J.getAttribute("style")===""){J.removeAttribute("style");}});return H;};C.Selection.resolve=function(F){if(F&&F.nodeType===3){F=F.parentNode;}return C.one(F);};C.Selection.getText=function(H){var F=H.get("innerHTML").replace(C.Selection.STRIP_HTML,""),I=F.match(C.Selection.REG_CHAR),G=F.match(C.Selection.REG_NON);if(I===null&&G){F="";}return F;};C.Selection.ALL="[style],font[face]";C.Selection.STRIP_HTML=/<\S[^><]*>/g;C.Selection.BLOCKS="p,div,ul,ol,table,style";C.Selection.TMP="yui-tmp";C.Selection.DEFAULT_TAG="span";C.Selection.CURID="yui-cursor";C.Selection.CUR_WRAPID="yui-cursor-wrapper";C.Selection.CURSOR='<span id="'+C.Selection.CURID+'"><span id="'+C.Selection.CUR_WRAPID+'">&nbsp;</span></span>';C.Selection.cleanCursor=function(){var F=C.config.doc.getElementById(C.Selection.CUR_WRAPID);if(F){F.id="";if(F.innerHTML=="&nbsp;"||F.innerHTML=="<br>"){if(F.parentNode){F.parentNode.removeChild(F);}}}};C.Selection.prototype={text:null,isCollapsed:null,anchorNode:null,anchorOffset:null,anchorTextNode:null,focusNode:null,focusOffset:null,focusTextNode:null,_selection:null,_wrap:function(H,F){var G=C.Node.create("<"+F+"></"+F+">");G.set(E,H.get(E));H.set(E,"");H.append(G);return C.Node.getDOMNode(G);},_swap:function(H,F){var G=C.Node.create("<"+F+"></"+F+">");G.set(E,H.get(E));H.replace(G,H);return C.Node.getDOMNode(G);},getSelected:function(){C.Selection.filter();C.config.doc.execCommand("fontname",null,C.Selection.TMP);var G=C.all(C.Selection.ALL),F=[];G.each(function(I,H){if(I.getStyle(D,C.Selection.TMP)){I.setStyle(D,"");I.removeAttribute("face");if(I.getAttribute("style")===""){I.removeAttribute("style");}if(!I.test("body")){F.push(C.Node.getDOMNode(G.item(H)));}}});return C.all(F);},insertContent:function(F){return this.insertAtCursor(F,this.anchorTextNode,this.anchorOffset,true);},insertAtCursor:function(L,G,I,O){var Q=C.Node.create("<"+C.Selection.DEFAULT_TAG+' class="yui-non"></'+C.Selection.DEFAULT_TAG+">"),F,J,H,P,K=this.createRange(),N;
if(G&&G.test("body")){N=C.Node.create("<span></span>");G.append(N);G=N;}if(K.pasteHTML){P=C.Node.create(L);try{K.pasteHTML('<span id="rte-insert"></span>');}catch(M){}F=C.one("#rte-insert");if(F){F.set("id","");F.replace(P);return P;}else{C.on("available",function(){F.set("id","");F.replace(P);},"#rte-insert");}}else{if(I>0){F=G.get(B);J=C.one(C.config.doc.createTextNode(F.substr(0,I)));H=C.one(C.config.doc.createTextNode(F.substr(I)));G.replace(J,G);P=C.Node.create(L);if(P.get("nodeType")===11){N=C.Node.create("<span></span>");N.append(P);P=N;}J.insert(P,"after");if(H){P.insert(Q,"after");Q.insert(H,"after");this.selectNode(Q,O);}}else{if(G.get("nodeType")===3){G=G.get("parentNode");}P=C.Node.create(L);G.insert(P,"before");}}return P;},wrapContent:function(G){G=(G)?G:C.Selection.DEFAULT_TAG;if(!this.isCollapsed){var I=this.getSelected(),L=[],H,J,K,F;I.each(function(O,M){var N=O.get("tagName").toLowerCase();if(N==="font"){L.push(this._swap(I.item(M),G));}else{L.push(this._wrap(I.item(M),G));}},this);H=this.createRange();K=L[0];J=L[L.length-1];if(this._selection.removeAllRanges){H.setStart(L[0],0);H.setEnd(J,J.childNodes.length);this._selection.removeAllRanges();this._selection.addRange(H);}else{H.moveToElementText(C.Node.getDOMNode(K));F=this.createRange();F.moveToElementText(C.Node.getDOMNode(J));H.setEndPoint("EndToEnd",F);H.select();}L=C.all(L);return L;}else{return C.all([]);}},replace:function(L,J){var G=this.createRange(),K,F,H,I;if(G.getBookmark){H=G.getBookmark();F=this.anchorNode.get("innerHTML").replace(L,J);this.anchorNode.set("innerHTML",F);G.moveToBookmark(H);I=C.one(G.parentElement());}else{K=this.anchorTextNode;F=K.get(B);H=F.indexOf(L);F=F.replace(L,"");K.set(B,F);I=this.insertAtCursor(J,K,H,true);}return I;},remove:function(){this._selection.removeAllRanges();return this;},createRange:function(){if(C.config.doc.selection){return C.config.doc.selection.createRange();}else{return C.config.doc.createRange();}},selectNode:function(I,K,F){F=F||0;I=C.Node.getDOMNode(I);var G=this.createRange();if(G.selectNode){G.selectNode(I);this._selection.removeAllRanges();this._selection.addRange(G);if(K){try{this._selection.collapse(I,F);}catch(H){this._selection.collapse(I,0);}}}else{if(I.nodeType===3){I=I.parentNode;}try{G.moveToElementText(I);}catch(J){}if(K){G.collapse(((F)?false:true));}G.select();}return this;},setCursor:function(){return this.insertContent(C.Selection.CURSOR);},getCursor:function(){return C.one("#"+C.Selection.CURID);},removeCursor:function(F){var G=this.getCursor();if(G){if(F){G.removeAttribute("id");G.set("innerHTML",'<span id="'+C.Selection.CUR_WRAPID+'">&nbsp;</span>');}else{G.remove();}}return G;},focusCursor:function(H,F){if(H!==false){H=true;}if(F!==false){F=true;}var G=this.removeCursor(true);if(G){this.selectNode(G,H,F);}},toString:function(){return"Selection Object";}};});},"@VERSION@",{requires:["node"],skinnable:false});