YUI.add("editor-base",function(A){YUI.add("editor-base",function(C){var B=function(){B.superclass.constructor.apply(this,arguments);};C.extend(B,C.Base,{frame:null,initializer:function(){var D=new C.Frame({designMode:true,title:B.STRINGS.title,use:B.USE,dir:this.get("dir"),extracss:this.get("extracss"),host:this}).plug(C.Plugin.ExecCommand);D.after("ready",C.bind(this._afterFrameReady,this));this.frame=D;this.publish("nodeChange",{emitFacade:true,bubbles:true,defaultFn:this._defNodeChangeFn});},destructor:function(){this.frame.destroy();this.detachAll();},copyStyles:function(G,F){var D=["color","fontSize","fontFamily","backgroundColor","fontStyle"],E={};C.each(D,function(H){E[H]=G.getStyle(H);});if(G.ancestor("b,strong")){E.fontWeight="bold";}F.setStyles(E);},_defNodeChangeFn:function(Q){var H=(new Date()).getTime();var O=this.getInstance();switch(Q.changedType){case"keydown":O.Selection.cleanCursor();break;case"enter":if(C.UA.webkit){if(Q.changedEvent.shiftKey){this.execCommand("insertbr");Q.changedEvent.preventDefault();}}break;case"tab":if(!Q.changedNode.test("li, li *")&&!Q.changedEvent.shiftKey){Q.changedEvent.preventDefault();var G=new O.Selection();G.setCursor();var R=G.getCursor();R.insert(B.TABKEY,"before");G.focusCursor();}break;case"enter-up":if(Q.changedNode.test("p")){var K=Q.changedNode.previous(),F,S,T=false;if(K){F=K.one(":last-child");while(!T){if(F){S=F.one(":last-child");if(S){F=S;}else{T=true;}}else{T=true;}}if(F){this.copyStyles(F,Q.changedNode);}}}break;}var N=this.getDomPath(Q.changedNode,false),D={},M,E,J=[],L="",I="";if(Q.commands){D=Q.commands;}C.each(N,function(b){var Z=O.Node.getDOMNode(b),V=Z.tagName.toLowerCase(),a=B.TAG2CMD[V];if(a){D[a]=1;}var Y=Z.currentStyle||Z.style;if((""+Y.fontWeight)=="bold"){D.bold=1;}if(Y.fontStyle=="italic"){D.italic=1;}if(Y.textDecoration=="underline"){D.underline=1;}if(Y.textDecoration=="line-through"){D.strikethrough=1;}if(Y.fontFamily){var X=Y.fontFamily.split(",")[0].toLowerCase();if(X){M=X;}if(M){M=M.replace(/'/g,"").replace(/"/g,"");}}E=Y.fontSize;var W=Z.className.split(" ");C.each(W,function(c){if(c!==""&&(c.substr(0,4)!=="yui_")){J.push(c);}});L=B.FILTER_RGB(Y.color);var U=B.FILTER_RGB(Y.backgroundColor);if(U!=="transparent"){I=U;}});Q.dompath=O.all(N);Q.classNames=J;Q.commands=D;if(!Q.fontFamily){Q.fontFamily=M;}if(!Q.fontSize){Q.fontSize=E;}if(!Q.fontColor){Q.fontColor=L;}if(!Q.backgroundColor){Q.backgroundColor=I;}var P=(new Date()).getTime();},getDomPath:function(F,D){var H=[],E,G=this.frame.getInstance();E=G.Node.getDOMNode(F);while(E!==null){if((E===G.config.doc.documentElement)||(E===G.config.doc)||!E.tagName){E=null;break;}if(!G.DOM.inDoc(E)){E=null;break;}if(E.nodeName&&E.nodeType&&(E.nodeType==1)){H.push(E);}if(E==G.config.doc.body){E=null;break;}E=E.parentNode;}if(H.length===0){H[0]=G.config.doc.body;}if(D){return G.all(H.reverse());}else{return H.reverse();}},_afterFrameReady:function(){var D=this.frame.getInstance();this.frame.on("dom:mouseup",C.bind(this._onFrameMouseUp,this));this.frame.on("dom:mousedown",C.bind(this._onFrameMouseDown,this));this.frame.on("dom:keydown",C.bind(this._onFrameKeyDown,this));this.frame.on("dom:keyup",C.throttle(C.bind(this._onFrameKeyUp,this),500));this.frame.on("dom:keypress",C.throttle(C.bind(this._onFrameKeyPress,this),500));D.Selection.filter();this.fire("ready");},_onFrameMouseUp:function(D){this.fire("nodeChange",{changedNode:D.frameTarget,changedType:"mouseup",changedEvent:D.frameEvent});},_onFrameMouseDown:function(D){this.fire("nodeChange",{changedNode:D.frameTarget,changedType:"mousedown",changedEvent:D.frameEvent});},_currentSelection:null,_currentSelectionTimer:null,_currentSelectionClear:null,_onFrameKeyDown:function(F){if(!this._currentSelection){if(this._currentSelectionTimer){this._currentSelectionTimer.cancel();}this._currentSelectionTimer=C.later(850,this,function(){this._currentSelectionClear=true;});var E=this.frame.getInstance(),D=new E.Selection(F);this._currentSelection=D;}else{var D=this._currentSelection;}var E=this.frame.getInstance(),D=new E.Selection();this._currentSelection=D;if(D&&D.anchorNode){this.fire("nodeChange",{changedNode:D.anchorNode,changedType:"keydown",changedEvent:F.frameEvent});if(B.NC_KEYS[F.keyCode]){this.fire("nodeChange",{changedNode:D.anchorNode,changedType:B.NC_KEYS[F.keyCode],changedEvent:F.frameEvent});this.fire("nodeChange",{changedNode:D.anchorNode,changedType:B.NC_KEYS[F.keyCode]+"-down",changedEvent:F.frameEvent});}}},_onFrameKeyPress:function(E){var D=this._currentSelection;if(D&&D.anchorNode){this.fire("nodeChange",{changedNode:D.anchorNode,changedType:"keypress",changedEvent:E.frameEvent});if(B.NC_KEYS[E.keyCode]){this.fire("nodeChange",{changedNode:D.anchorNode,changedType:B.NC_KEYS[E.keyCode]+"-press",changedEvent:E.frameEvent});}}},_onFrameKeyUp:function(E){var D=this._currentSelection;if(D&&D.anchorNode){this.fire("nodeChange",{changedNode:D.anchorNode,changedType:"keyup",selection:D,changedEvent:E.frameEvent});if(B.NC_KEYS[E.keyCode]){this.fire("nodeChange",{changedNode:D.anchorNode,changedType:B.NC_KEYS[E.keyCode]+"-up",selection:D,changedEvent:E.frameEvent});}}if(this._currentSelectionClear){this._currentSelectionClear=this._currentSelection=null;}},execCommand:function(H,J){var E=this.frame.execCommand(H,J),G=this.frame.getInstance(),F=new G.Selection(),D={},I={changedNode:F.anchorNode,changedType:"execcommand",nodes:E};switch(H){case"forecolor":I.fontColor=J;break;case"backcolor":I.backgroundColor=J;break;case"fontsize":I.fontSize=J;break;case"fontname":I.fontFamily=J;break;}D[H]=1;I.commands=D;this.fire("nodeChange",I);return E;},getInstance:function(){return this.frame.getInstance();},render:function(D){this.frame.set("content",this.get("content"));this.frame.render(D);return this;},focus:function(D){this.frame.focus(D);return this;},show:function(){this.frame.show();return this;},hide:function(){this.frame.hide();return this;},getContent:function(){var D="",E=this.getInstance();if(E&&E.Selection){D=E.Selection.unfilter();
}D=D.replace(/ _yuid="([^>]*)"/g,"");return D;}},{TABKEY:'<span class="tab">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>',FILTER_RGB:function(F){if(F.toLowerCase().indexOf("rgb")!=-1){var I=new RegExp("(.*?)rgb\\s*?\\(\\s*?([0-9]+).*?,\\s*?([0-9]+).*?,\\s*?([0-9]+).*?\\)(.*?)","gi");var E=F.replace(I,"$1,$2,$3,$4,$5").split(",");if(E.length==5){var H=parseInt(E[1],10).toString(16);var G=parseInt(E[2],10).toString(16);var D=parseInt(E[3],10).toString(16);H=H.length==1?"0"+H:H;G=G.length==1?"0"+G:G;D=D.length==1?"0"+D:D;F="#"+H+G+D;}}return F;},TAG2CMD:{"b":"bold","strong":"bold","i":"italic","em":"italic","u":"underline","sup":"superscript","sub":"subscript","img":"insertimage","a":"createlink","ul":"insertunorderedlist","ol":"insertorderedlist"},NC_KEYS:{8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},USE:["substitute","node","selector-css3","selection","stylesheet"],NAME:"editorBase",STRINGS:{title:"Rich Text Editor"},ATTRS:{content:{value:"<br>",setter:function(D){if(D.substr(0,1)==="\n"){D=D.substr(1);}if(D===""){D="<br>";}return this.frame.set("content",D);},getter:function(){return this.frame.get("content");}},dir:{writeOnce:true,value:"ltr"},extracss:{value:false,setter:function(D){if(this.frame){this.frame.set("extracss",D);}return D;}}}});C.EditorBase=B;},"@VERSION@",{requires:["base","frame","node","exec-command"],skinnable:false});},"@VERSION@",{requires:["base","frame","node","exec-command"],skinnable:false});