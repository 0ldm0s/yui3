<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>API: node   Node.js  (YUI Library)</title>
	<link rel="stylesheet" type="text/css" href="assets/api.css">
    <script type="text/javascript" src="assets/api-js"></script>
    <script type="text/javascript" src="assets/ac-js"></script>
</head>

<body id="yahoo-com">

<div id="doc3" class="yui-t2">

	<div id="hd">
        <a href="http://developer.yahoo.com/yui/"><h1>Yahoo! UI Library</h1></a>
        <h3>node&nbsp; <span class="subtitle">3.00pre</span></h3>
        <p>
        <a href="./index.html">Yahoo! UI Library</a> 
            &gt; <a href="./module_node.html">node</a>
                
                 &gt; Node.js (source view) 
            </p>

	</div>

	<div id="bd">
		<div id="yui-main">
			<div class="yui-b">
            <form name="yui-classopts-form">
    <span id="classopts"><input type="checkbox" name="showprivate" id="showprivate" /> Show Private</span>
    <span id="classopts"><input type="checkbox" name="showprotected" id="showprotected" /> Show Protected</span>
    <span id="classopts"><input type="checkbox" name="showdeprecated" id="showdeprecated" /> Show Deprecated</span>
            </form>

                    <div id="srcout">
                        <style>
                            #doc3 #classopts { display:none; }
                        </style>
<div class="highlight" ><pre><span class="c">/**</span>
<span class="c"> * DOM Abstractions.</span>
<span class="c"> * @module node</span>
<span class="c"> */</span>

<span class="nx">YUI</span><span class="o">.</span><span class="nx">add</span><span class="o">(</span><span class="s1">&#39;node&#39;</span><span class="o">,</span> <span class="k">function</span><span class="o">(</span><span class="nx">Y</span><span class="o">)</span> <span class="o">{</span>

    <span class="c">/**</span>
<span class="c">     * A wrapper for DOM Nodes.</span>
<span class="c">     * Node properties can be accessed via the set/get methods.</span>
<span class="c">     * With the exception of the noted properties,</span>
<span class="c">     * only strings, numbers, and booleans are passed through. </span>
<span class="c">     * Use Y.get() or Y.Doc.get() to create Node instances.</span>
<span class="c">     *</span>
<span class="c">     * @class Node</span>
<span class="c">     */</span>

    <span class="k">var</span> <span class="nx">BASE_NODE</span>                   <span class="o">=</span> <span class="m">0</span><span class="o">,</span> 
        <span class="nx">ELEMENT_NODE</span>                <span class="o">=</span> <span class="m">1</span><span class="o">,</span>
        <span class="nx">ATTRIBUTE_NODE</span>              <span class="o">=</span> <span class="m">2</span><span class="o">,</span>
        <span class="nx">TEXT_NODE</span>                   <span class="o">=</span> <span class="m">3</span><span class="o">,</span>
        <span class="nx">CDATA_SECTION_NODE</span>          <span class="o">=</span> <span class="m">4</span><span class="o">,</span>
        <span class="nx">ENTITY_REFERENCE_NODE</span>       <span class="o">=</span> <span class="m">5</span><span class="o">,</span>
        <span class="nx">ENTITY_NODE</span>                 <span class="o">=</span> <span class="m">6</span><span class="o">,</span>
        <span class="nx">PROCESSING_INSTRUCTION_NODE</span> <span class="o">=</span> <span class="m">7</span><span class="o">,</span>
        <span class="nx">COMMENT_NODE</span>                <span class="o">=</span> <span class="m">8</span><span class="o">,</span>
        <span class="nx">DOCUMENT_NODE</span>               <span class="o">=</span> <span class="m">9</span><span class="o">,</span>
        <span class="nx">DOCUMENT_TYPE_NODE</span>          <span class="o">=</span> <span class="m">10</span><span class="o">,</span>
        <span class="nx">DOCUMENT_FRAGMENT_NODE</span>      <span class="o">=</span> <span class="m">11</span><span class="o">,</span>
        <span class="nx">NOTATION_NODE</span>               <span class="o">=</span> <span class="m">12</span><span class="o">;</span>


    <span class="k">var</span> <span class="nx">RE_VALID_PROP_TYPES</span> <span class="o">=</span> <span class="sr">/(?:string|boolean|number)/</span><span class="o">;</span>

    <span class="nx">Y</span><span class="o">.</span><span class="nx">use</span><span class="o">(</span><span class="s1">&#39;selector&#39;</span><span class="o">);</span> <span class="c">// TODO: need this?  should be able to &quot;use&quot; from &quot;add&quot;</span>
<span class="c"></span>    <span class="k">var</span> <span class="nx">Selector</span> <span class="o">=</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">Selector</span><span class="o">;</span>
    <span class="k">var</span> <span class="nx">_cache</span> <span class="o">=</span> <span class="o">{};</span>

    <span class="c">// private factory</span>
<span class="c"></span>    <span class="k">var</span> <span class="nx">create</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(!</span><span class="nx">node</span><span class="o">.</span><span class="nx">nodeName</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="o">.</span><span class="nx">get</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="o">;</span> <span class="c">// Node instance</span>
<span class="c"></span>        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="nx">node</span><span class="o">.</span><span class="nx">item</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;length&#39;</span> <span class="k">in</span> <span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">NodeList</span><span class="o">(</span><span class="nx">node</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nx">switch</span><span class="o">(</span><span class="nx">node</span><span class="o">.</span><span class="nx">nodeType</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">case</span> <span class="nx">ELEMENT_NODE</span><span class="o">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nx">Element</span><span class="o">(</span><span class="nx">node</span><span class="o">);</span>

            <span class="nx">case</span> <span class="nx">DOCUMENT_NODE</span><span class="o">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nx">Doc</span><span class="o">(</span><span class="nx">node</span><span class="o">);</span>

            <span class="nx">default</span><span class="o">:</span> <span class="c">// BASIC NODE (TEXT_NODE, etc.)</span>
<span class="c"></span>                <span class="k">return</span> <span class="k">new</span> <span class="nx">Node</span><span class="o">(</span><span class="nx">node</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="c">// returns HTMLElement</span>
<span class="c"></span>    <span class="k">var</span> <span class="nx">getDOMNode</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">root</span><span class="o">,</span> <span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">typeof</span> <span class="nx">node</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nx">Selector</span><span class="o">.</span><span class="nx">query</span><span class="o">(</span><span class="nx">node</span><span class="o">,</span> <span class="nx">root</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span>      <span class="o">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">)</span> <span class="o">?</span> <span class="nx">_cache</span><span class="o">[</span><span class="nx">node</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">]</span> <span class="o">:</span>
                    <span class="o">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="o">.</span><span class="nx">nodeName</span><span class="o">)</span> <span class="o">?</span>  <span class="nx">node</span> <span class="o">:</span>
                    <span class="kc">null</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="c">/** </span>
<span class="c">     * Wraps the inputs value of the method in a node instance</span>
<span class="c">     * Wraps the return value of the method in a node instance</span>
<span class="c">     * For use with methods that accept and return nodes</span>
<span class="c">     */</span>
    <span class="k">var</span> <span class="nx">nodeInOut</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">method</span><span class="o">,</span> <span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="nx">a</span><span class="o">)</span> <span class="o">{</span> <span class="c">// first 2 may be Node instances or strings</span>
<span class="c"></span>            <span class="nx">a</span> <span class="o">=</span> <span class="o">(!</span><span class="nx">a</span><span class="o">.</span><span class="nx">nodeName</span><span class="o">)</span> <span class="o">?</span> <span class="nx">getDOMNode</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">],</span> <span class="nx">a</span><span class="o">)</span> <span class="o">:</span> <span class="nx">a</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">b</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">b</span> <span class="o">=</span> <span class="o">(!</span><span class="nx">b</span><span class="o">.</span><span class="nx">nodeName</span><span class="o">)</span> <span class="o">?</span> <span class="nx">getDOMNode</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">],</span> <span class="nx">b</span><span class="o">)</span> <span class="o">:</span> <span class="nx">b</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="nx">create</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">][</span><span class="nx">method</span><span class="o">](</span><span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">));</span>
    <span class="o">};</span>

    <span class="c">/** </span>
<span class="c">     * Wraps the return value of the method in a node instance</span>
<span class="c">     * For use with methods that return nodes</span>
<span class="c">     */</span>
    <span class="k">var</span> <span class="nx">nodeOut</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">method</span><span class="o">,</span> <span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="nx">node</span> <span class="o">=</span> <span class="nx">create</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">][</span><span class="nx">method</span><span class="o">](</span><span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">));</span>
        <span class="k">return</span> <span class="nx">node</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="c">/** </span>
<span class="c">     * Passes method directly to HTMLElement</span>
<span class="c">     */</span>
    <span class="k">var</span> <span class="nx">rawOut</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">method</span><span class="o">,</span> <span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">][</span><span class="nx">method</span><span class="o">](</span><span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">);</span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">PROPS_WRAP</span> <span class="o">=</span> <span class="o">{</span>

        <span class="c">/**</span>
<span class="c">         * Returns a Node instance. </span>
<span class="c">         * @property parentNode</span>
<span class="c">         * @type Node</span>
<span class="c">         */</span>
        <span class="s1">&#39;parentNode&#39;</span><span class="o">:</span> <span class="nx">BASE_NODE</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Returns a wrapper instance. </span>
<span class="c">         * @property childNodes</span>
<span class="c">         * @type NodeList</span>
<span class="c">         */</span>
        <span class="s1">&#39;childNodes&#39;</span><span class="o">:</span> <span class="nx">BASE_NODE</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Returns a wrapper instance. </span>
<span class="c">         * @property firstChild</span>
<span class="c">         * @type Node</span>
<span class="c">         */</span>
        <span class="s1">&#39;firstChild&#39;</span><span class="o">:</span> <span class="nx">BASE_NODE</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Returns a wrapper instance. </span>
<span class="c">         * @property lastChild</span>
<span class="c">         * @type Node</span>
<span class="c">         */</span>
        <span class="s1">&#39;lastChild&#39;</span><span class="o">:</span> <span class="nx">BASE_NODE</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Returns a wrapper instance. </span>
<span class="c">         * @property previousSibling</span>
<span class="c">         * @type Node</span>
<span class="c">         */</span>
        <span class="s1">&#39;previousSibling&#39;</span><span class="o">:</span> <span class="nx">BASE_NODE</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Returns a wrapper instance. </span>
<span class="c">         * @property previousSibling</span>
<span class="c">         * @type Node</span>
<span class="c">         */</span>
        <span class="s1">&#39;nextSibling&#39;</span><span class="o">:</span> <span class="nx">BASE_NODE</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Returns a wrapper instance. </span>
<span class="c">         * @property ownerDocument</span>
<span class="c">         * @type Doc</span>
<span class="c">         */</span>
        <span class="s1">&#39;ownerDocument&#39;</span><span class="o">:</span> <span class="nx">BASE_NODE</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Returns a wrapper instance. </span>
<span class="c">         * Only valid for HTMLElement nodes.</span>
<span class="c">         * @property offsetParent</span>
<span class="c">         * @type Node</span>
<span class="c">         */</span>
        <span class="s1">&#39;offsetParent&#39;</span><span class="o">:</span> <span class="nx">ELEMENT_NODE</span><span class="o">,</span>

        <span class="c">// form</span>
<span class="c"></span>        <span class="s1">&#39;elements&#39;</span><span class="o">:</span> <span class="nx">ELEMENT_NODE</span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">PROPS_READ</span> <span class="o">=</span> <span class="o">{</span> <span class="c">// white list (currently all strings|numbers|booleans are allowed)</span>
<span class="c"></span>    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">PROPS_WRITE</span> <span class="o">=</span> <span class="o">{</span> <span class="c">// white list (currently all strings|numbers|booleans are allowed)</span>
<span class="c"></span>    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">SETTERS</span> <span class="o">=</span> <span class="o">{</span> <span class="c">// custom setters for specific properties</span>
<span class="c"></span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">GETTERS</span> <span class="o">=</span> <span class="o">{};</span>
    <span class="nx">GETTERS</span><span class="o">[</span><span class="nx">ELEMENT_NODE</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="c">// custom getters for specific properties</span>
<span class="c"></span>        <span class="c">/**</span>
<span class="c">         * Normalizes nodeInnerText and textContent. </span>
<span class="c">         * @property text</span>
<span class="c">         * @type String</span>
<span class="c">         */</span>
        <span class="s1">&#39;text&#39;</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="o">.</span><span class="nx">innerText</span> <span class="o">||</span> <span class="nx">node</span><span class="o">.</span><span class="nx">textContent</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * A NodeList containing only HTMLElement child nodes </span>
<span class="c">         * @property child</span>
<span class="c">         * @type NodeList</span>
<span class="c">         */</span>
        <span class="nx">children</span><span class="o">:</span> <span class="k">function</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="nx">queryAll</span><span class="o">(</span><span class="s1">&#39;&gt; *&#39;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nx">GETTERS</span><span class="o">[</span><span class="nx">DOCUMENT_NODE</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="c">// custom getters for specific properties</span>
<span class="c"></span>        <span class="c">/**</span>
<span class="c">         * Document height </span>
<span class="c">         * @property height</span>
<span class="c">         * @type Number</span>
<span class="c">         */</span>
        <span class="s1">&#39;height&#39;</span><span class="o">:</span>  <span class="k">function</span><span class="o">(</span><span class="nx">doc</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">defaultView</span> <span class="o">||</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">parentWindow</span><span class="o">;</span>
            <span class="k">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="o">(</span><span class="nx">doc</span><span class="o">.</span><span class="nx">compatMode</span> <span class="o">!=</span> <span class="s1">&#39;CSS1Compat&#39;</span><span class="o">)</span> <span class="o">?</span>
                    <span class="nx">doc</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">scrollHeight</span> <span class="o">:</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">documentElement</span><span class="o">.</span><span class="nx">scrollHeight</span><span class="o">;</span> <span class="c">// body first for safari</span>
<span class="c"></span>            <span class="k">return</span> <span class="nb">Math</span><span class="o">.</span><span class="nx">max</span><span class="o">(</span><span class="nx">h</span><span class="o">,</span> <span class="nx">WIN_GETTERS</span><span class="o">[</span><span class="s1">&#39;height&#39;</span><span class="o">](</span><span class="nx">win</span><span class="o">));</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Document width </span>
<span class="c">         * @property width</span>
<span class="c">         * @type Number</span>
<span class="c">         */</span>
        <span class="s1">&#39;width&#39;</span><span class="o">:</span>  <span class="k">function</span><span class="o">(</span><span class="nx">doc</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">defaultView</span> <span class="o">||</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">parentWindow</span><span class="o">;</span>
            <span class="k">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="o">(</span><span class="nx">doc</span><span class="o">.</span><span class="nx">compatMode</span> <span class="o">!=</span> <span class="s1">&#39;CSS1Compat&#39;</span><span class="o">)</span> <span class="o">?</span>
                    <span class="nx">doc</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">scrollWidth</span> <span class="o">:</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">documentElement</span><span class="o">.</span><span class="nx">scrollWidth</span><span class="o">;</span> <span class="c">// body first for safari</span>
<span class="c"></span>            <span class="k">return</span> <span class="nb">Math</span><span class="o">.</span><span class="nx">max</span><span class="o">(</span><span class="nx">w</span><span class="o">,</span> <span class="nx">WIN_GETTERS</span><span class="o">[</span><span class="s1">&#39;width&#39;</span><span class="o">](</span><span class="nx">win</span><span class="o">));</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Amount page has been scroll vertically </span>
<span class="c">         * @property width</span>
<span class="c">         * @type Number</span>
<span class="c">         */</span>
        <span class="s1">&#39;scrollTop&#39;</span><span class="o">:</span>  <span class="k">function</span><span class="o">(</span><span class="nx">doc</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nb">Math</span><span class="o">.</span><span class="nx">max</span><span class="o">(</span><span class="nx">doc</span><span class="o">.</span><span class="nx">documentElement</span><span class="o">.</span><span class="nx">scrollTop</span><span class="o">,</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">scrollTop</span><span class="o">);</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Amount page has been scroll horizontally </span>
<span class="c">         * @property width</span>
<span class="c">         * @type Number</span>
<span class="c">         */</span>
        <span class="s1">&#39;scrollLeft&#39;</span><span class="o">:</span>  <span class="k">function</span><span class="o">(</span><span class="nx">doc</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nb">Math</span><span class="o">.</span><span class="nx">max</span><span class="o">(</span><span class="nx">doc</span><span class="o">.</span><span class="nx">documentElement</span><span class="o">.</span><span class="nx">scrollLeft</span><span class="o">,</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">scrollLeft</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">METHODS</span> <span class="o">=</span> <span class="o">{};</span>

    <span class="nx">METHODS</span><span class="o">[</span><span class="nx">BASE_NODE</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method insertBefore</span>
<span class="c">         * @param {String | HTMLElement | Node} node Node to be inserted </span>
<span class="c">         * @param {String | HTMLElement | Node} refNode Node to be inserted before</span>
<span class="c">         */</span>
        <span class="nx">insertBefore</span><span class="o">:</span> <span class="nx">nodeInOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method replaceChild</span>
<span class="c">         * @param {String | HTMLElement | Node} node Node to be inserted </span>
<span class="c">         * @param {String | HTMLElement | Node} refNode Node to be replaced </span>
<span class="c">         * @return {Node} The replaced node </span>
<span class="c">         */</span>
        <span class="nx">replaceChild</span><span class="o">:</span> <span class="nx">nodeInOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method removeChild</span>
<span class="c">         * @param {String | HTMLElement | Node} node Node to be removed </span>
<span class="c">         * @return {Node} The removed node </span>
<span class="c">         */</span>
        <span class="nx">removeChild</span><span class="o">:</span> <span class="nx">nodeInOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method appendChild</span>
<span class="c">         * @param {String | HTMLElement | Node} node Node to be appended </span>
<span class="c">         * @return {Node} The appended node </span>
<span class="c">         */</span>
        <span class="nx">appendChild</span><span class="o">:</span> <span class="nx">nodeInOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method cloneNode</span>
<span class="c">         * @param {String | HTMLElement | Node} node Node to be cloned </span>
<span class="c">         * @return {Node} The clone </span>
<span class="c">         */</span>
        <span class="nx">cloneNode</span><span class="o">:</span> <span class="nx">nodeOut</span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">METHODS_INVOKE</span> <span class="o">=</span> <span class="o">{</span>
        <span class="s1">&#39;getBoundingClientRect&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
        <span class="s1">&#39;contains&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
        <span class="s1">&#39;compareDocumentPosition&#39;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">Node</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="nx">node</span> <span class="o">||</span> <span class="o">!</span><span class="nx">node</span><span class="o">.</span><span class="nx">nodeName</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="o">(</span><span class="s1">&#39;Node: invalid node&#39;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nx">_cache</span><span class="o">[</span><span class="nx">Y</span><span class="o">.</span><span class="nx">stamp</span><span class="o">(</span><span class="k">this</span><span class="o">)]</span> <span class="o">=</span> <span class="nx">node</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="nx">Node</span><span class="o">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Set the value of the property/attribute on the HTMLElement bound to this Node.</span>
<span class="c">         * Only strings/numbers/booleans are passed through unless a SETTER exists.</span>
<span class="c">         * @method set</span>
<span class="c">         * @param {String} prop Property to set </span>
<span class="c">         * @param {any} val Value to apply to the given property</span>
<span class="c">         */</span>
        <span class="nx">set</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">prop</span><span class="o">,</span> <span class="nx">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">SETTERS</span><span class="o">)</span> <span class="o">{</span> <span class="c">// use custom setter</span>
<span class="c"></span>                <span class="nx">SETTERS</span><span class="o">[</span><span class="nx">prop</span><span class="o">](</span><span class="nx">node</span><span class="o">,</span> <span class="nx">prop</span><span class="o">,</span> <span class="nx">val</span><span class="o">);</span> 
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nx">RE_VALID_PROP_TYPES</span><span class="o">.</span><span class="nx">test</span><span class="o">(</span><span class="k">typeof</span> <span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">])</span> <span class="o">||</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">PROPS_WRITE</span><span class="o">)</span> <span class="o">{</span> <span class="c">// safe to write</span>
<span class="c"></span>                <span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">]</span> <span class="o">=</span> <span class="nx">val</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Get the value of the property/attribute on the HTMLElement bound to this Node.</span>
<span class="c">         * Only strings/numbers/booleans are passed through unless a GETTER exists.</span>
<span class="c">         * @method get</span>
<span class="c">         * @param {String} prop Property to get </span>
<span class="c">         * @return {any} Current value of the property</span>
<span class="c">         */</span>
        <span class="nx">get</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">prop</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">val</span><span class="o">;</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">PROPS_WRAP</span><span class="o">)</span> <span class="o">{</span> <span class="c">// wrap DOM object (HTMLElement, HTMLCollection, Document, Window)</span>
<span class="c"></span>                <span class="nx">val</span> <span class="o">=</span> <span class="nx">create</span><span class="o">(</span><span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">]);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nx">GETTERS</span><span class="o">[</span><span class="nx">node</span><span class="o">.</span><span class="nx">nodeType</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nx">GETTERS</span><span class="o">[</span><span class="nx">node</span><span class="o">.</span><span class="nx">nodeType</span><span class="o">][</span><span class="nx">prop</span><span class="o">])</span> <span class="o">{</span> <span class="c">// use custom getter</span>
<span class="c"></span>                <span class="nx">val</span> <span class="o">=</span> <span class="nx">GETTERS</span><span class="o">[</span><span class="nx">node</span><span class="o">.</span><span class="nx">nodeType</span><span class="o">][</span><span class="nx">prop</span><span class="o">].</span><span class="nx">call</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">node</span><span class="o">,</span> <span class="nx">prop</span><span class="o">,</span> <span class="nx">val</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nx">RE_VALID_PROP_TYPES</span><span class="o">.</span><span class="nx">test</span><span class="o">(</span><span class="k">typeof</span> <span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">])</span> <span class="o">||</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">PROPS_READ</span><span class="o">)</span> <span class="o">{</span> <span class="c">// safe to read</span>
<span class="c"></span>                <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">];</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="nx">val</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Tests whether or not the bound HTMLElement has any child nodes. </span>
<span class="c">         * @method hasChildNodes</span>
<span class="c">         * @return {Boolean} Whether or not the HTMLElement has childNodes </span>
<span class="c">         */</span>
        <span class="nx">hasChildNodes</span><span class="o">:</span> <span class="k">function</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">!!</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">].</span><span class="nx">childNodes</span><span class="o">.</span><span class="nx">length</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="nx">invoke</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">method</span><span class="o">,</span> <span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">a</span><span class="o">)</span> <span class="o">{</span> <span class="c">// first 2 may be Node instances or strings</span>
<span class="c"></span>                <span class="nx">a</span> <span class="o">=</span> <span class="o">(</span><span class="nx">a</span><span class="o">.</span><span class="nx">nodeName</span><span class="o">)</span> <span class="o">?</span> <span class="nx">a</span> <span class="o">:</span> <span class="nx">getDOMNode</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">],</span> <span class="nx">a</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="nx">b</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nx">b</span> <span class="o">=</span> <span class="o">(</span><span class="nx">b</span><span class="o">.</span><span class="nx">nodeName</span><span class="o">)</span> <span class="o">?</span> <span class="nx">b</span> <span class="o">:</span> <span class="nx">getDOMNode</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">],</span> <span class="nx">b</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
           <span class="k">var</span>  <span class="nx">node</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">METHODS_INVOKE</span><span class="o">[</span><span class="nx">method</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="o">[</span><span class="nx">method</span><span class="o">])</span> <span class="o">{</span>
                <span class="k">return</span> <span class="nx">node</span><span class="o">[</span><span class="nx">method</span><span class="o">](</span><span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Tests whether or not the bound HTMLElement can use the given method. </span>
<span class="c">         * @method hasMethod</span>
<span class="c">         * @param {String} method The method to check for </span>
<span class="c">         * @return {Boolean} Whether or not the HTMLElement can use the method </span>
<span class="c">         */</span>
        <span class="nx">hasMethod</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">method</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">!!(</span><span class="nx">METHODS_INVOKE</span><span class="o">[</span><span class="nx">method</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">][</span><span class="nx">method</span><span class="o">]);</span>
        <span class="o">},</span>

        <span class="c">//normalize: function() {},</span>
<span class="c"></span>        <span class="c">//isSupported: function(feature, version) {},</span>
<span class="c"></span>        <span class="nx">toString</span><span class="o">:</span> <span class="k">function</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s1">&#39;id&#39;</span><span class="o">)</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s1">&#39;nodeName&#39;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nx">Y</span><span class="o">.</span><span class="nx">each</span><span class="o">(</span><span class="nx">METHODS</span><span class="o">[</span><span class="nx">BASE_NODE</span><span class="o">],</span> <span class="k">function</span><span class="o">(</span><span class="nx">fn</span><span class="o">,</span> <span class="nx">method</span><span class="o">)</span> <span class="o">{</span>
        <span class="nx">Node</span><span class="o">.</span><span class="nx">prototype</span><span class="o">[</span><span class="nx">method</span><span class="o">]</span> <span class="o">=</span> <span class="k">function</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="o">[].</span><span class="nx">slice</span><span class="o">.</span><span class="nx">call</span><span class="o">(</span><span class="nx">arguments</span><span class="o">,</span> <span class="m">0</span><span class="o">);</span>
            <span class="nx">args</span><span class="o">.</span><span class="nx">unshift</span><span class="o">(</span><span class="nx">method</span><span class="o">);</span>
            <span class="k">return</span> <span class="nx">fn</span><span class="o">.</span><span class="nx">apply</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">args</span><span class="o">);</span>
        <span class="o">};</span>
    <span class="o">});</span>

    <span class="nx">METHODS</span><span class="o">[</span><span class="nx">ELEMENT_NODE</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method getAttribute</span>
<span class="c">         * @param {String} attribute The attribute to retrieve </span>
<span class="c">         * @return {String} The current value of the attribute </span>
<span class="c">         */</span>
        <span class="nx">getAttribute</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method setAttribute</span>
<span class="c">         * @param {String} attribute The attribute to set </span>
<span class="c">         * @param {String} The value to apply to the attribute </span>
<span class="c">         */</span>
        <span class="nx">setAttribute</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method removeAttribute</span>
<span class="c">         * @param {String} attribute The attribute to be removed </span>
<span class="c">         */</span>
        <span class="nx">removeAttribute</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method hasAttribute</span>
<span class="c">         * @param {String} attribute The attribute to test for </span>
<span class="c">         * @return {Boolean} Whether or not the attribute is present </span>
<span class="c">         */</span>
        <span class="nx">hasAttribute</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method scrollIntoView</span>
<span class="c">         */</span>
        <span class="nx">scrollIntoView</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method getElementsByTagName</span>
<span class="c">         * @param {String} tagName The tagName to collect </span>
<span class="c">         * @return {NodeList} A NodeList representing the HTMLCollection</span>
<span class="c">         */</span>
        <span class="nx">getElementsByTagName</span><span class="o">:</span> <span class="nx">nodeOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method focus</span>
<span class="c">         */</span>
        <span class="nx">focus</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method blur</span>
<span class="c">         */</span>
        <span class="nx">blur</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * Only valid on FORM elements</span>
<span class="c">         * @method submit</span>
<span class="c">         */</span>
        <span class="nx">submit</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * Only valid on FORM elements</span>
<span class="c">         * @method reset</span>
<span class="c">         */</span>
        <span class="nx">reset</span><span class="o">:</span> <span class="nx">rawOut</span>

    <span class="o">};</span>


    
    <span class="k">var</span> <span class="nx">Element</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="nx">Element</span><span class="o">.</span><span class="nx">superclass</span><span class="o">.</span><span class="nx">constructor</span><span class="o">.</span><span class="nx">call</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">node</span><span class="o">);</span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">_createNode</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">config</span><span class="o">.</span><span class="nx">doc</span><span class="o">.</span><span class="nx">createElement</span><span class="o">(</span><span class="s1">&#39;div&#39;</span><span class="o">);</span>
        <span class="nx">frag</span><span class="o">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">_createHTML</span><span class="o">(</span><span class="nx">data</span><span class="o">);</span>
        <span class="k">return</span> <span class="nx">frag</span><span class="o">.</span><span class="nx">firstChild</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">_createHTML</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">jsonml</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="o">[];</span>
        <span class="k">var</span> <span class="nx">att</span> <span class="o">=</span> <span class="o">[];</span>

        <span class="k">if</span> <span class="o">(</span><span class="nx">Y</span><span class="o">.</span><span class="nx">lang</span><span class="o">.</span><span class="nx">isString</span><span class="o">(</span><span class="nx">jsonml</span><span class="o">))</span> <span class="o">{</span> <span class="c">// text node</span>
<span class="c"></span>            <span class="k">return</span> <span class="nx">jsonml</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(!</span><span class="nx">jsonml</span> <span class="o">||</span> <span class="o">!</span><span class="nx">jsonml</span><span class="o">.</span><span class="nx">push</span><span class="o">)</span> <span class="o">{</span> <span class="c">// isArray</span>
<span class="c"></span>            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">;</span> <span class="c">// expecting array </span>
<span class="c"></span>        <span class="o">}</span>

        <span class="k">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="nx">jsonml</span><span class="o">[</span><span class="m">0</span><span class="o">];</span>
        <span class="k">if</span> <span class="o">(!</span><span class="nx">Y</span><span class="o">.</span><span class="nx">lang</span><span class="o">.</span><span class="nx">isString</span><span class="o">(</span><span class="nx">tag</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span> <span class="c">// bad tag error</span>
<span class="c"></span>        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="k">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="m">1</span><span class="o">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">jsonml</span><span class="o">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">typeof</span> <span class="nx">jsonml</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="nx">jsonml</span><span class="o">[</span><span class="nx">i</span><span class="o">].</span><span class="nx">push</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">html</span><span class="o">[</span><span class="nx">html</span><span class="o">.</span><span class="nx">length</span><span class="o">]</span> <span class="o">=</span> <span class="nx">_createHTML</span><span class="o">(</span><span class="nx">jsonml</span><span class="o">[</span><span class="nx">i</span><span class="o">]);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">typeof</span> <span class="nx">jsonml</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="k">var</span> <span class="nx">attr</span> <span class="k">in</span> <span class="nx">jsonml</span><span class="o">[</span><span class="nx">i</span><span class="o">])</span> <span class="o">{</span>
                    <span class="nx">att</span><span class="o">[</span><span class="nx">att</span><span class="o">.</span><span class="nx">length</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">attr</span> <span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">jsonml</span><span class="o">[</span><span class="nx">i</span><span class="o">][</span><span class="nx">attr</span><span class="o">]</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">tag</span> <span class="o">+</span> <span class="nx">att</span><span class="o">.</span><span class="nx">join</span><span class="o">(</span><span class="s1">&#39;&#39;</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="nx">html</span><span class="o">.</span><span class="nx">join</span><span class="o">(</span><span class="s1">&#39;&#39;</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/&#39;</span> <span class="o">+</span> <span class="nx">tag</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">;</span>
        
    <span class="o">};</span>

    <span class="c">/** </span>
<span class="c">     *  Creates a node instance from an HTML string or jsonml</span>
<span class="c">     * @method create</span>
<span class="c">     * @param {String | Array} jsonml HTML string or jsonml</span>
<span class="c">     */</span>
    <span class="nx">Element</span><span class="o">.</span><span class="nx">create</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">jsonml</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Element</span><span class="o">(</span><span class="nx">_createNode</span><span class="o">(</span><span class="nx">jsonml</span><span class="o">));</span>
    <span class="o">};</span>

    <span class="nx">Y</span><span class="o">.</span><span class="nx">extend</span><span class="o">(</span><span class="nx">Element</span><span class="o">,</span> <span class="nx">Node</span><span class="o">,</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Retrieves a single node based on the given CSS selector. </span>
<span class="c">         * @method query</span>
<span class="c">         *</span>
<span class="c">         * @param {string} selector The CSS selector to test against.</span>
<span class="c">         * @return {Node} A Node instance for the matching HTMLElement.</span>
<span class="c">         */</span>
        <span class="nx">query</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">selector</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Element</span><span class="o">(</span><span class="nx">Selector</span><span class="o">.</span><span class="nx">query</span><span class="o">(</span><span class="nx">selector</span><span class="o">,</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">],</span> <span class="kc">true</span><span class="o">));</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Retrieves a nodeList based on the given CSS selector. </span>
<span class="c">         * @method queryAll</span>
<span class="c">         *</span>
<span class="c">         * @param {string} selector The CSS selector to test against.</span>
<span class="c">         * @return {NodeList} A NodeList instance for the matching HTMLCollection/Array.</span>
<span class="c">         */</span>
        <span class="nx">queryAll</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">selector</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">NodeList</span><span class="o">(</span><span class="nx">Selector</span><span class="o">.</span><span class="nx">query</span><span class="o">(</span><span class="nx">selector</span><span class="o">,</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">]));</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Test if the supplied node matches the supplied selector.</span>
<span class="c">         * @method test</span>
<span class="c">         *</span>
<span class="c">         * @param {string} selector The CSS selector to test against.</span>
<span class="c">         * @return {boolean} Whether or not the node matches the selector.</span>
<span class="c">         */</span>
        <span class="nx">test</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">selector</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nx">Selector</span><span class="o">.</span><span class="nx">test</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">],</span> <span class="nx">selector</span><span class="o">);</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Retrieves a style attribute from the given node.</span>
<span class="c">         * @method getStyle</span>
<span class="c">         * @param {String} attr The style attribute to retrieve. </span>
<span class="c">         * @return {String} The current value of the style property for the element.</span>
<span class="c">         */</span>
        <span class="nx">getStyle</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">attr</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="o">.</span><span class="nx">style</span><span class="o">[</span><span class="nx">attr</span><span class="o">];</span>
            <span class="k">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">node</span><span class="o">.</span><span class="nx">ownerDocument</span><span class="o">.</span><span class="nx">defaultView</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="o">)</span> <span class="o">{</span> <span class="c">// TODO: is empty string sufficient?</span>
<span class="c"></span>                <span class="k">if</span> <span class="o">(</span><span class="nx">view</span> <span class="o">&amp;&amp;</span> <span class="nx">view</span><span class="o">.</span><span class="nx">getComputedStyle</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nx">val</span> <span class="o">=</span> <span class="nx">view</span><span class="o">.</span><span class="nx">getComputedStyle</span><span class="o">(</span><span class="nx">node</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="o">)[</span><span class="nx">attr</span><span class="o">];</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nx">node</span><span class="o">.</span><span class="nx">currentStyle</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nx">val</span> <span class="o">=</span>  <span class="nx">node</span><span class="o">.</span><span class="nx">currentStyle</span><span class="o">[</span><span class="nx">attr</span><span class="o">];</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">undefined</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">;</span> <span class="c">// TODO: more robust</span>
<span class="c"></span>            <span class="o">}</span>
            <span class="k">return</span> <span class="nx">val</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Applies a CSS style to a given node.</span>
<span class="c">         * @method getStyle</span>
<span class="c">         * @param {String} attr The style attribute to retrieve. </span>
<span class="c">         * @return {String} The current value of the style property for the element.</span>
<span class="c">         */</span>
        <span class="nx">setStyle</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">attr</span><span class="o">,</span> <span class="nx">val</span><span class="o">)</span> <span class="o">{</span>
             <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">].</span><span class="nx">style</span><span class="o">[</span><span class="nx">attr</span><span class="o">]</span> <span class="o">=</span> <span class="nx">val</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Compares nodes to determine if they match.</span>
<span class="c">         * Node instances can be compared to each other and/or HTMLElements/selectors.</span>
<span class="c">         * @method compareTo</span>
<span class="c">         * @param {String | HTMLElement | Node} refNode The reference node to compare to the node.</span>
<span class="c">         * @return {Boolean} True if the nodes match, false if they do not. </span>
<span class="c">         */</span>
        <span class="nx">compareTo</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">refNode</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">refNode</span> <span class="o">=</span> <span class="nx">refNode</span><span class="o">.</span><span class="nx">nodeName</span> <span class="o">?</span> <span class="nx">refNode</span> <span class="o">:</span> <span class="nx">_cache</span><span class="o">[</span><span class="nx">refNode</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">return</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">]</span> <span class="o">===</span> <span class="nx">refNode</span><span class="o">;</span>
        <span class="o">},</span>

       <span class="c">/**</span>
<span class="c">         * Returns the nearest ancestor that passes the test applied by supplied boolean method.</span>
<span class="c">         * @method getAncestorBy</span>
<span class="c">         * @param {Function} method - A boolean method for testing elements which receives the element as its only argument.</span>
<span class="c">         * @return {Object} HTMLElement or null if not found</span>
<span class="c">         */</span>
        <span class="nx">ancestor</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">test</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">(</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s1">&#39;parentNode&#39;</span><span class="o">))</span> <span class="o">{</span> <span class="c">// NOTE: assignment</span>
<span class="c"></span>                <span class="k">if</span> <span class="o">(</span> <span class="nx">test</span><span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
                    <span class="nx">Y</span><span class="o">.</span><span class="nx">log</span><span class="o">(</span><span class="s1">&#39;getAncestorBy returning &#39;</span> <span class="o">+</span> <span class="nx">node</span><span class="o">,</span> <span class="s1">&#39;info&#39;</span><span class="o">,</span> <span class="s1">&#39;Dom&#39;</span><span class="o">);</span>
                    <span class="k">return</span> <span class="nx">node</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span> 

            <span class="nx">Y</span><span class="o">.</span><span class="nx">log</span><span class="o">(</span><span class="s1">&#39;ancestor returning null (no ancestor passed test)&#39;</span><span class="o">,</span> <span class="s1">&#39;error&#39;</span><span class="o">,</span> <span class="s1">&#39;Node&#39;</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">},</span>

       <span class="c">/**</span>
<span class="c">         * Attaches a handler for the given DOM event.</span>
<span class="c">         * @method addEventListener</span>
<span class="c">         * @param {String} type The type of DOM Event to listen for </span>
<span class="c">         * @param {Function} fn The handler to call when the event fires </span>
<span class="c">         * @param {Object} arg An argument object to pass to the handler </span>
<span class="c">         */</span>
        <span class="nx">addEventListener</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">type</span><span class="o">,</span> <span class="nx">fn</span><span class="o">,</span> <span class="nx">arg</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">Y</span><span class="o">.</span><span class="nx">Event</span><span class="o">.</span><span class="nx">nativeAdd</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">],</span> <span class="nx">type</span><span class="o">,</span> <span class="nx">fn</span><span class="o">,</span> <span class="nx">arg</span><span class="o">);</span>
        <span class="o">},</span>
        
       <span class="c">/**</span>
<span class="c">         * Attaches a handler for the given DOM event.</span>
<span class="c">         * @method removeEventListener</span>
<span class="c">         * @param {String} type The type of DOM Event</span>
<span class="c">         * @param {Function} fn The handler to call when the event fires </span>
<span class="c">         */</span>
        <span class="nx">removeEventListener</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">type</span><span class="o">,</span> <span class="nx">fn</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">Y</span><span class="o">.</span><span class="nx">Event</span><span class="o">.</span><span class="nx">nativeRemove</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">],</span> <span class="nx">type</span><span class="o">,</span> <span class="nx">fn</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">});</span>

    <span class="nx">Y</span><span class="o">.</span><span class="nx">each</span><span class="o">(</span><span class="nx">METHODS</span><span class="o">[</span><span class="nx">ELEMENT_NODE</span><span class="o">],</span> <span class="k">function</span><span class="o">(</span><span class="nx">fn</span><span class="o">,</span> <span class="nx">method</span><span class="o">)</span> <span class="o">{</span>
        <span class="nx">Element</span><span class="o">.</span><span class="nx">prototype</span><span class="o">[</span><span class="nx">method</span><span class="o">]</span> <span class="o">=</span> <span class="k">function</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="o">[].</span><span class="nx">slice</span><span class="o">.</span><span class="nx">call</span><span class="o">(</span><span class="nx">arguments</span><span class="o">,</span> <span class="m">0</span><span class="o">);</span>
            <span class="nx">args</span><span class="o">.</span><span class="nx">unshift</span><span class="o">(</span><span class="nx">method</span><span class="o">);</span>

            <span class="k">return</span> <span class="nx">fn</span><span class="o">.</span><span class="nx">apply</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">args</span><span class="o">);</span>
        <span class="o">};</span>
    <span class="o">});</span>


    <span class="c">/** </span>
<span class="c">     * A wrapper for interacting with DOM elements</span>
<span class="c">     * Usage:</span>
<span class="c">     * &lt;p&gt;Doc.get() // returns Doc instance for current document&lt;/p&gt;</span>
<span class="c">     * &lt;p&gt;Doc.get(document) // returns Doc instance for the given document&lt;/p&gt;</span>
<span class="c">     * &lt;p&gt;Doc.get(&#39;#foo&#39;) // returns Node instance&lt;/p&gt;</span>
<span class="c">     * </span>
<span class="c">     * @class Doc</span>
<span class="c">     */</span>
    <span class="k">var</span> <span class="nx">Doc</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span> <span class="o">||</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">config</span><span class="o">.</span><span class="nx">doc</span><span class="o">;</span>
        <span class="nx">Doc</span><span class="o">.</span><span class="nx">superclass</span><span class="o">.</span><span class="nx">constructor</span><span class="o">.</span><span class="nx">call</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">node</span><span class="o">);</span>
    <span class="o">};</span>

    
    <span class="nx">Doc</span><span class="o">.</span><span class="nx">get</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">doc</span><span class="o">,</span> <span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="nx">doc</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nx">create</span><span class="o">(</span><span class="nx">Y</span><span class="o">.</span><span class="nx">config</span><span class="o">.</span><span class="nx">doc</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="nx">doc</span><span class="o">.</span><span class="nx">nodeName</span> <span class="o">!=</span> <span class="s1">&#39;#document&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">doc</span><span class="o">;</span>
            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">config</span><span class="o">.</span><span class="nx">doc</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">node</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Selector</span><span class="o">.</span><span class="nx">query</span><span class="o">(</span><span class="nx">node</span><span class="o">,</span> <span class="nx">doc</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="nx">create</span><span class="o">(</span><span class="nx">node</span><span class="o">);</span>
    <span class="o">};</span>

    <span class="c">/**</span>
<span class="c">     * Retrieves a nodeList based on the given CSS selector. </span>
<span class="c">     * @method queryAll</span>
<span class="c">     *</span>
<span class="c">     * @param {HTMLDocument} document The document to search against.</span>
<span class="c">     * @param {string} selector The CSS selector to test against.</span>
<span class="c">     * @param {HTMLElement} root The root node to start from.</span>
<span class="c">     * @return {NodeList} A NodeList instance for the matching HTMLCollection/Array.</span>
<span class="c">     */</span>
    <span class="nx">Doc</span><span class="o">.</span><span class="nx">queryAll</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">doc</span><span class="o">,</span> <span class="nx">selector</span><span class="o">,</span> <span class="nx">root</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="nx">doc</span><span class="o">.</span><span class="nx">nodeName</span> <span class="o">!=</span> <span class="s1">&#39;#document&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">selector</span> <span class="o">=</span> <span class="nx">doc</span><span class="o">;</span>
            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">config</span><span class="o">.</span><span class="nx">doc</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="nx">doc</span><span class="o">;</span>
        <span class="nx">nodes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NodeList</span><span class="o">(</span><span class="nx">Selector</span><span class="o">.</span><span class="nx">query</span><span class="o">(</span><span class="nx">selector</span><span class="o">,</span> <span class="nx">root</span><span class="o">));</span>
        <span class="k">return</span> <span class="nx">nodes</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="c">/**</span>
<span class="c">     * Returns a wrapper instance. </span>
<span class="c">     * @property documentElement</span>
<span class="c">     * @type Node</span>
<span class="c">     */</span>
    <span class="nx">PROPS_WRAP</span><span class="o">.</span><span class="nx">documentElement</span> <span class="o">=</span> <span class="nx">DOCUMENT_NODE</span><span class="o">;</span>

    <span class="c">/**</span>
<span class="c">     * Returns a wrapper instance. </span>
<span class="c">     * @property body</span>
<span class="c">     * @type Node</span>
<span class="c">     */</span>
    <span class="nx">PROPS_WRAP</span><span class="o">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">DOCUMENT_NODE</span><span class="o">;</span>


    <span class="nx">METHODS</span><span class="o">[</span><span class="nx">DOCUMENT_NODE</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method createElement</span>
<span class="c">         * @param {String} tagName The type of element to create </span>
<span class="c">         * @return {Node} A Node instance bound to the HTMLElement </span>
<span class="c">         */</span>
        <span class="nx">createElement</span><span class="o">:</span> <span class="nx">nodeOut</span><span class="o">,</span>
        <span class="c">//createDocumentFragment: fragReturn,</span>
<span class="c"></span>
        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method createTextNode</span>
<span class="c">         * @param {String} text The text value of the node </span>
<span class="c">         * @return {Node} A Node instance bound to the TextNode </span>
<span class="c">         */</span>
        <span class="nx">createTextNode</span><span class="o">:</span> <span class="nx">nodeInOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method getElementsByTagName</span>
<span class="c">         * @param {String} text The text value of the node </span>
<span class="c">         * @return {Node} A Node instance bound to the TextNode </span>
<span class="c">         */</span>
        <span class="nx">getElementsByTagName</span><span class="o">:</span> <span class="nx">nodeOut</span><span class="o">,</span>

        <span class="c">//createElementNS: nodeOut,</span>
<span class="c"></span>        <span class="c">//getElementsByTagNameNS: nodeOut,</span>
<span class="c"></span>
        <span class="c">/**</span>
<span class="c">         * Passes through to DOM method.</span>
<span class="c">         * @method getElementsById</span>
<span class="c">         * @param {String} id The id to search for </span>
<span class="c">         * @return {Node} A Node instance bound to the HTMLElement </span>
<span class="c">         */</span>
        <span class="nx">getElementById</span><span class="o">:</span> <span class="nx">nodeOut</span>
    <span class="o">};</span>

    <span class="nx">Y</span><span class="o">.</span><span class="nx">extend</span><span class="o">(</span><span class="nx">Doc</span><span class="o">,</span> <span class="nx">Node</span><span class="o">,</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Retrieves a Node instance based on the given CSS selector. </span>
<span class="c">         * @method query</span>
<span class="c">         *</span>
<span class="c">         * @param {string} selector The CSS selector to test against.</span>
<span class="c">         * @return {NodeList} A NodeList instance for the matching HTMLCollection/Array.</span>
<span class="c">         */</span>
        <span class="nx">query</span><span class="o">:</span> <span class="nx">Element</span><span class="o">.</span><span class="nx">prototype</span><span class="o">.</span><span class="nx">query</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Retrieves a nodeList based on the given CSS selector. </span>
<span class="c">         * @method queryAll</span>
<span class="c">         *</span>
<span class="c">         * @param {string} selector The CSS selector to test against.</span>
<span class="c">         * @return {NodeList} A NodeList instance for the matching HTMLCollection/Array.</span>
<span class="c">         */</span>
        <span class="nx">queryAll</span><span class="o">:</span> <span class="nx">Element</span><span class="o">.</span><span class="nx">prototype</span><span class="o">.</span><span class="nx">queryAll</span><span class="o">,</span>

        <span class="nx">getElementsBy</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">method</span><span class="o">,</span> <span class="nx">test</span><span class="o">,</span> <span class="nx">tag</span><span class="o">,</span> <span class="nx">root</span><span class="o">,</span> <span class="nx">apply</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span> <span class="o">||</span> <span class="s1">&#39;*&#39;</span><span class="o">;</span>
            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">nodeName</span> <span class="o">?</span> <span class="k">new</span> <span class="nx">Doc</span><span class="o">(</span><span class="nx">doc</span><span class="o">)</span> <span class="o">:</span> <span class="nx">doc</span><span class="o">;</span>

            <span class="k">if</span> <span class="o">(</span><span class="nx">root</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">root</span> <span class="o">=</span> <span class="o">(</span><span class="nx">root</span><span class="o">.</span><span class="nx">tagName</span><span class="o">)</span> <span class="o">?</span> <span class="k">new</span> <span class="nx">Element</span><span class="o">(</span><span class="nx">root</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="nx">root</span><span class="o">.</span><span class="nx">get</span><span class="o">)</span> <span class="o">?</span> <span class="nx">root</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="nx">root</span> <span class="o">=</span> <span class="nx">doc</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="k">var</span> <span class="nx">elements</span><span class="o">;</span>

            <span class="k">if</span> <span class="o">(</span><span class="nx">root</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">elements</span> <span class="o">=</span> <span class="nx">root</span><span class="o">.</span><span class="nx">getElementsByTagName</span><span class="o">(</span><span class="nx">tag</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="nx">elements</span> <span class="o">=</span> <span class="o">[];</span>
            <span class="o">}</span>

            <span class="k">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="o">[],</span>
                <span class="nx">item</span><span class="o">;</span>
            
            <span class="k">for</span> <span class="o">(</span><span class="k">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="m">0</span><span class="o">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">elements</span><span class="o">.</span><span class="nx">length</span><span class="o">();</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">item</span> <span class="o">=</span> <span class="nx">elements</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">i</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span> <span class="nx">test</span><span class="o">(</span><span class="nx">item</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
                    <span class="nx">nodes</span><span class="o">[</span><span class="nx">nodes</span><span class="o">.</span><span class="nx">length</span><span class="o">]</span> <span class="o">=</span> <span class="nx">item</span><span class="o">;</span>
                    <span class="k">if</span> <span class="o">(</span><span class="nx">apply</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nx">apply</span><span class="o">(</span><span class="nx">item</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="nx">Y</span><span class="o">.</span><span class="nx">log</span><span class="o">(</span><span class="s1">&#39;getElementsBy returning &#39;</span> <span class="o">+</span> <span class="nx">nodes</span><span class="o">,</span> <span class="s1">&#39;info&#39;</span><span class="o">,</span> <span class="s1">&#39;Dom&#39;</span><span class="o">);</span>
            
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">NodeList</span><span class="o">(</span><span class="nx">nodes</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">});</span>

    <span class="nx">Y</span><span class="o">.</span><span class="nx">each</span><span class="o">(</span><span class="nx">METHODS</span><span class="o">[</span><span class="nx">DOCUMENT_NODE</span><span class="o">],</span> <span class="k">function</span><span class="o">(</span><span class="nx">fn</span><span class="o">,</span> <span class="nx">method</span><span class="o">)</span> <span class="o">{</span>
        <span class="nx">Doc</span><span class="o">.</span><span class="nx">prototype</span><span class="o">[</span><span class="nx">method</span><span class="o">]</span> <span class="o">=</span> <span class="k">function</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="o">[].</span><span class="nx">slice</span><span class="o">.</span><span class="nx">call</span><span class="o">(</span><span class="nx">arguments</span><span class="o">,</span> <span class="m">0</span><span class="o">);</span>
            <span class="nx">args</span><span class="o">.</span><span class="nx">unshift</span><span class="o">(</span><span class="nx">method</span><span class="o">);</span>
            <span class="k">return</span> <span class="nx">fn</span><span class="o">.</span><span class="nx">apply</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">args</span><span class="o">);</span>
        <span class="o">};</span>
    <span class="o">});</span>

    <span class="k">var</span> <span class="nx">NodeList</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">nodes</span><span class="o">)</span> <span class="o">{</span>
        <span class="nx">_cache</span><span class="o">[</span><span class="nx">Y</span><span class="o">.</span><span class="nx">stamp</span><span class="o">(</span><span class="k">this</span><span class="o">)]</span> <span class="o">=</span> <span class="nx">nodes</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="c">/** </span>
<span class="c">     * A wrapper for interacting with DOM elements</span>
<span class="c">     * @class NodeList</span>
<span class="c">     */</span>
    <span class="nx">NodeList</span><span class="o">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Retrieves the Node instance at the given index. </span>
<span class="c">         * @method item</span>
<span class="c">         *</span>
<span class="c">         * @param {Number} index The index of the target Node.</span>
<span class="c">         * @return {Node} The Node instance at the given index.</span>
<span class="c">         */</span>
        <span class="nx">item</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">][</span><span class="nx">index</span><span class="o">];</span>
            <span class="k">return</span> <span class="o">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="o">.</span><span class="nx">tagName</span><span class="o">)</span> <span class="o">?</span> <span class="nx">create</span><span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="o">.</span><span class="nx">get</span><span class="o">)</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Set the value of the property/attribute on all HTMLElements bound to this NodeList.</span>
<span class="c">         * Only strings/numbers/booleans are passed through unless a SETTER exists.</span>
<span class="c">         * @method set</span>
<span class="c">         * @param {String} prop Property to set </span>
<span class="c">         * @param {any} val Value to apply to the given property</span>
<span class="c">         * @see Node</span>
<span class="c">         */</span>
        <span class="nx">set</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">name</span><span class="o">,</span> <span class="nx">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">for</span> <span class="o">(</span><span class="k">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="m">0</span><span class="o">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">nodes</span><span class="o">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">Node</span><span class="o">.</span><span class="nx">set</span><span class="o">(</span><span class="nx">nodes</span><span class="o">[</span><span class="nx">i</span><span class="o">],</span> <span class="nx">name</span><span class="o">,</span> <span class="nx">val</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Get the value of the property/attribute for each of the HTMLElements bound to this NodeList.</span>
<span class="c">         * Only strings/numbers/booleans are passed through unless a GETTER exists.</span>
<span class="c">         * @method get</span>
<span class="c">         * @param {String} prop Property to get </span>
<span class="c">         * @return {Array} Array containing the current values mapped to the Node indexes </span>
<span class="c">         * @see Node</span>
<span class="c">         */</span>
        <span class="nx">get</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;length&#39;</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">].</span><span class="nx">length</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="o">[];</span>
            <span class="k">for</span> <span class="o">(</span><span class="k">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="m">0</span><span class="o">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">nodes</span><span class="o">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">ret</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span> <span class="o">=</span> <span class="nx">Node</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">nodes</span><span class="o">[</span><span class="nx">i</span><span class="o">],</span> <span class="nx">name</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="nx">ret</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Filters the NodeList instance down to only nodes matching the given selector.</span>
<span class="c">         * @method filter</span>
<span class="c">         * @param {String} selector The selector to filter against</span>
<span class="c">         * @return {NodeList} NodeList containing the updated collection </span>
<span class="c">         * @see Selector</span>
<span class="c">         */</span>
        <span class="nx">filter</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">selector</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">NodeList</span><span class="o">(</span><span class="nx">Selector</span><span class="o">.</span><span class="nx">filter</span><span class="o">(</span><span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">],</span> <span class="nx">selector</span><span class="o">));</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Applies the given function to each Node in the NodeList.</span>
<span class="c">         * @method each</span>
<span class="c">         * @param {Function} fn The function to apply </span>
<span class="c">         * @return {NodeList} NodeList containing the updated collection </span>
<span class="c">         * @see Y.each</span>
<span class="c">         */</span>
        <span class="nx">each</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">fn</span><span class="o">,</span> <span class="nx">context</span><span class="o">)</span> <span class="o">{</span>
            <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="k">this</span><span class="o">;</span>
            <span class="k">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">Doc</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">nodes</span><span class="o">[</span><span class="nx">i</span><span class="o">]);</span> <span class="c">// reusing single instance for each node</span>
<span class="c"></span>            <span class="k">for</span> <span class="o">(</span><span class="k">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="m">0</span><span class="o">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">nodes</span><span class="o">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">_cache</span><span class="o">[</span><span class="nx">node</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">]</span> <span class="o">=</span> <span class="nx">nodes</span><span class="o">[</span><span class="nx">i</span><span class="o">];</span> <span class="c">// remap Node instance to current node</span>
<span class="c"></span>                <span class="nx">fn</span><span class="o">.</span><span class="nx">call</span><span class="o">(</span><span class="nx">context</span><span class="o">,</span> <span class="nx">node</span><span class="o">,</span> <span class="nx">i</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nx">Y</span><span class="o">.</span><span class="nx">each</span><span class="o">(</span><span class="nx">Element</span><span class="o">.</span><span class="nx">prototype</span><span class="o">,</span> <span class="k">function</span><span class="o">(</span><span class="nx">fn</span><span class="o">,</span> <span class="nx">method</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">var</span> <span class="nx">ret</span><span class="o">;</span>
        <span class="k">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="o">[];</span>
        <span class="nx">NodeList</span><span class="o">.</span><span class="nx">prototype</span><span class="o">[</span><span class="nx">method</span><span class="o">]</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="k">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="m">0</span><span class="o">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">nodes</span><span class="o">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Element</span><span class="o">[</span><span class="nx">method</span><span class="o">].</span><span class="nx">call</span><span class="o">(</span><span class="nx">Element</span><span class="o">,</span> <span class="nx">nodes</span><span class="o">[</span><span class="nx">i</span><span class="o">],</span> <span class="nx">a</span><span class="o">,</span> <span class="nx">b</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">d</span><span class="o">,</span> <span class="nx">e</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="nx">ret</span> <span class="o">!==</span> <span class="nx">Element</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nx">a</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span> <span class="o">=</span> <span class="nx">ret</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="nx">a</span><span class="o">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">a</span> <span class="o">:</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">};</span>
    <span class="o">});</span>

    <span class="c">/**</span>
<span class="c">     * A wrapper for DOM Windows.</span>
<span class="c">     * Window properties can be accessed via the set/get methods.</span>
<span class="c">     * With the exception of the noted properties,</span>
<span class="c">     * only strings, numbers, and booleans are passed through. </span>
<span class="c">     * Use Win.get() to create new Win instances.</span>
<span class="c">     *</span>
<span class="c">     * @class Win</span>
<span class="c">     */</span>
    <span class="c">// TODO: merge with NODE statics?</span>
<span class="c"></span>    <span class="k">var</span> <span class="nx">WIN_PROPS_WRAP</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Returns a Doc instance wrapping the window.document </span>
<span class="c">         * @property document</span>
<span class="c">         * @type Doc</span>
<span class="c">         */</span>
        <span class="s1">&#39;document&#39;</span><span class="o">:</span> <span class="m">1</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Returns a Win instance wrapping the window.window </span>
<span class="c">         * @property window</span>
<span class="c">         * @type Doc</span>
<span class="c">         */</span>
        <span class="s1">&#39;window&#39;</span><span class="o">:</span> <span class="m">1</span><span class="o">,</span>
        <span class="c">//&#39;top&#39;: 1,</span>
<span class="c"></span>        <span class="c">//&#39;opener&#39;: 1,</span>
<span class="c"></span>        <span class="c">//&#39;parent&#39;: 1,</span>
<span class="c"></span>
        <span class="c">/**</span>
<span class="c">         * Returns a Node instance wrapping the window.frameElement </span>
<span class="c">         * @property frameElement</span>
<span class="c">         * @type Doc</span>
<span class="c">         */</span>
        <span class="s1">&#39;frameElement&#39;</span><span class="o">:</span> <span class="m">1</span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">WIN_GETTERS</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Returns the inner height of the viewport (exludes scrollbar). </span>
<span class="c">         * @property height</span>
<span class="c">         * @type String</span>
<span class="c">         */</span>
        <span class="s1">&#39;height&#39;</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">win</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">win</span><span class="o">.</span><span class="nx">innerHeight</span><span class="o">,</span> <span class="c">// Safari, Opera</span>
<span class="c"></span>            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">win</span><span class="o">.</span><span class="nb">document</span><span class="o">,</span>
            <span class="nx">mode</span> <span class="o">=</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">compatMode</span><span class="o">;</span>
        
            <span class="k">if</span> <span class="o">(</span> <span class="o">(</span><span class="nx">mode</span> <span class="o">||</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">ua</span><span class="o">.</span><span class="nx">ie</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="o">.</span><span class="nx">ua</span><span class="o">.</span><span class="nx">opera</span> <span class="o">)</span> <span class="o">{</span> <span class="c">// IE, Gecko</span>
<span class="c"></span>                <span class="nx">h</span> <span class="o">=</span> <span class="o">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;CSS1Compat&#39;</span><span class="o">)</span> <span class="o">?</span>
                        <span class="nx">doc</span><span class="o">.</span><span class="nx">documentElement</span><span class="o">.</span><span class="nx">clientHeight</span> <span class="o">:</span> <span class="c">// Standards</span>
<span class="c"></span>                        <span class="nx">doc</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">clientHeight</span><span class="o">;</span> <span class="c">// Quirks</span>
<span class="c"></span>            <span class="o">}</span>
        
            <span class="nx">Y</span><span class="o">.</span><span class="nx">log</span><span class="o">(</span><span class="s1">&#39;GETTERS:height returning &#39;</span> <span class="o">+</span> <span class="nx">h</span><span class="o">,</span> <span class="s1">&#39;info&#39;</span><span class="o">,</span> <span class="s1">&#39;Win&#39;</span><span class="o">);</span>
            <span class="k">return</span> <span class="nx">h</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Returns the inner width of the viewport (exludes scrollbar). </span>
<span class="c">         * @property width</span>
<span class="c">         * @type String</span>
<span class="c">         */</span>
        <span class="s1">&#39;width&#39;</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">win</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">win</span><span class="o">.</span><span class="nx">innerWidth</span><span class="o">,</span> <span class="c">// Safari, Opera</span>
<span class="c"></span>            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">win</span><span class="o">.</span><span class="nb">document</span><span class="o">,</span>
            <span class="nx">mode</span> <span class="o">=</span> <span class="nx">doc</span><span class="o">.</span><span class="nx">compatMode</span><span class="o">;</span>
        
            <span class="k">if</span> <span class="o">(</span> <span class="o">(</span><span class="nx">mode</span> <span class="o">||</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">ua</span><span class="o">.</span><span class="nx">ie</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="o">.</span><span class="nx">ua</span><span class="o">.</span><span class="nx">opera</span> <span class="o">)</span> <span class="o">{</span> <span class="c">// IE, Gecko</span>
<span class="c"></span>                <span class="nx">w</span> <span class="o">=</span> <span class="o">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;CSS1Compat&#39;</span><span class="o">)</span> <span class="o">?</span>
                        <span class="nx">doc</span><span class="o">.</span><span class="nx">documentElement</span><span class="o">.</span><span class="nx">clientWidth</span> <span class="o">:</span> <span class="c">// Standards</span>
<span class="c"></span>                        <span class="nx">doc</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">clientWidth</span><span class="o">;</span> <span class="c">// Quirks</span>
<span class="c"></span>            <span class="o">}</span>
        
            <span class="nx">Y</span><span class="o">.</span><span class="nx">log</span><span class="o">(</span><span class="s1">&#39;GETTERS:width returning &#39;</span> <span class="o">+</span> <span class="nx">w</span><span class="o">,</span> <span class="s1">&#39;info&#39;</span><span class="o">,</span> <span class="s1">&#39;Win&#39;</span><span class="o">);</span>
            <span class="k">return</span> <span class="nx">w</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="k">var</span> <span class="nx">WIN_SETTERS</span> <span class="o">=</span> <span class="o">{};</span>
    <span class="k">var</span> <span class="nx">WIN_PROPS_READ</span> <span class="o">=</span> <span class="o">{};</span>
    <span class="k">var</span> <span class="nx">WIN_PROPS_WRITE</span> <span class="o">=</span> <span class="o">{};</span>


    <span class="k">var</span> <span class="nx">Win</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">win</span><span class="o">)</span> <span class="o">{</span>
        <span class="nx">win</span> <span class="o">=</span> <span class="nx">win</span> <span class="o">||</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">config</span><span class="o">.</span><span class="nx">win</span><span class="o">;</span> <span class="c">// TODO: abstract window ref?</span>
<span class="c"></span>        <span class="nx">_cache</span><span class="o">[</span><span class="nx">Y</span><span class="o">.</span><span class="nx">stamp</span><span class="o">(</span><span class="k">this</span><span class="o">)]</span> <span class="o">=</span> <span class="nx">win</span><span class="o">;</span> 
    <span class="o">};</span>

    <span class="c">/**</span>
<span class="c">     * Returns a Win instance bound to the given or current window.</span>
<span class="c">     * @method get</span>
<span class="c">     * @param {Window} win optional window reference. Defaults to current window.</span>
<span class="c">     * @return {Win} A Win instance bound to the given window. </span>
<span class="c">     * @static</span>
<span class="c">     */</span>
    <span class="nx">Win</span><span class="o">.</span><span class="nx">get</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">win</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Win</span><span class="o">(</span><span class="nx">win</span><span class="o">);</span>
    <span class="o">};</span>

    <span class="nx">Win</span><span class="o">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c">/**</span>
<span class="c">         * Get the value of the property/attribute on the window bound to this Win.</span>
<span class="c">         * Only strings/numbers/booleans are passed through unless a GETTER exists.</span>
<span class="c">         * @method get</span>
<span class="c">         * @param {String} prop Property to get </span>
<span class="c">         * @return {any} Current value of the property</span>
<span class="c">         */</span>
        <span class="nx">get</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">prop</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">val</span><span class="o">;</span>
            <span class="k">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">WIN_PROPS_WRAP</span><span class="o">)</span> <span class="o">{</span> <span class="c">// wrap DOM object (HTMLElement, HTMLCollection, Document, Window)</span>
<span class="c"></span>                <span class="nx">val</span> <span class="o">=</span> <span class="nx">create</span><span class="o">(</span><span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">]);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">WIN_GETTERS</span><span class="o">)</span> <span class="o">{</span> <span class="c">// use custom setter</span>
<span class="c"></span>                <span class="nx">val</span> <span class="o">=</span> <span class="nx">WIN_GETTERS</span><span class="o">[</span><span class="nx">prop</span><span class="o">](</span><span class="nx">node</span><span class="o">,</span> <span class="nx">prop</span><span class="o">,</span> <span class="nx">val</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nx">RE_VALID_PROP_TYPES</span><span class="o">.</span><span class="nx">test</span><span class="o">(</span><span class="k">typeof</span> <span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">])</span> <span class="o">||</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">WIN_PROPS_READ</span><span class="o">)</span> <span class="o">{</span> <span class="c">// safe to read</span>
<span class="c"></span>                <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">];</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="nx">val</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Set the value of the property/attribute on the window bound to this Win.</span>
<span class="c">         * Only strings/numbers/booleans are passed through unless a SETTER exists.</span>
<span class="c">         * @method set</span>
<span class="c">         * @param {String} prop Property to set </span>
<span class="c">         * @param {any} val Value to apply to the given property</span>
<span class="c">         */</span>
        <span class="nx">set</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">prop</span><span class="o">,</span> <span class="nx">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">_cache</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="nx">_yuid</span><span class="o">];</span>
            <span class="k">if</span> <span class="o">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">WIN_SETTERS</span><span class="o">)</span> <span class="o">{</span> <span class="c">// use custom setter</span>
<span class="c"></span>                <span class="nx">WIN_SETTERS</span><span class="o">[</span><span class="nx">prop</span><span class="o">](</span><span class="nx">node</span><span class="o">,</span> <span class="nx">prop</span><span class="o">,</span> <span class="nx">val</span><span class="o">);</span> 
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nx">RE_VALID_PROP_TYPES</span><span class="o">.</span><span class="nx">test</span><span class="o">(</span><span class="k">typeof</span> <span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">])</span> <span class="o">||</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">WIN_PROPS_WRITE</span><span class="o">)</span> <span class="o">{</span> <span class="c">// safe to write</span>
<span class="c"></span>                <span class="nx">node</span><span class="o">[</span><span class="nx">prop</span><span class="o">]</span> <span class="o">=</span> <span class="nx">val</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">},</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM window.</span>
<span class="c">         * @method scrollTo</span>
<span class="c">         */</span>
        <span class="s1">&#39;scrollTo&#39;</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM window.</span>
<span class="c">         * @method scrollBy</span>
<span class="c">         */</span>
        <span class="s1">&#39;scrollBy&#39;</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM window.</span>
<span class="c">         * @method resizeTo</span>
<span class="c">         */</span>
        <span class="s1">&#39;resizeTo&#39;</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM window.</span>
<span class="c">         * @method resizeBy</span>
<span class="c">         */</span>
        <span class="s1">&#39;resizeBy&#39;</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM window.</span>
<span class="c">         * @method moveTo</span>
<span class="c">         */</span>
        <span class="s1">&#39;moveTo&#39;</span><span class="o">:</span> <span class="nx">rawOut</span><span class="o">,</span>

        <span class="c">/**</span>
<span class="c">         * Passes through to DOM window.</span>
<span class="c">         * @method moveBy</span>
<span class="c">         */</span>
        <span class="s1">&#39;moveBy&#39;</span><span class="o">:</span> <span class="nx">rawOut</span>


<span class="c">/* TODO: allow?</span>
<span class="c">        &#39;focus&#39;: rawOut,</span>
<span class="c">        &#39;blur&#39;: rawOut,</span>
<span class="c"></span>
<span class="c">        &#39;close&#39;: rawOut,</span>
<span class="c">        &#39;open&#39;: nodeInOut,</span>
<span class="c"></span>
<span class="c">        &#39;forward&#39;: rawOut,</span>
<span class="c">        &#39;back&#39;: rawOut,</span>
<span class="c">*/</span>
    <span class="o">};</span>


    <span class="nx">Y</span><span class="o">.</span><span class="nx">Node</span> <span class="o">=</span> <span class="nx">Element</span><span class="o">;</span>
    <span class="nx">Y</span><span class="o">.</span><span class="nx">NodeList</span> <span class="o">=</span> <span class="nx">NodeList</span><span class="o">;</span>
    <span class="nx">Y</span><span class="o">.</span><span class="nx">Doc</span> <span class="o">=</span> <span class="nx">Doc</span><span class="o">;</span>
    <span class="nx">Y</span><span class="o">.</span><span class="nx">Win</span> <span class="o">=</span> <span class="nx">Win</span><span class="o">;</span>
<span class="o">},</span> <span class="s1">&#39;3.0.0&#39;</span><span class="o">);</span>
</pre></div>
                    </div>
			</div>
		</div>
		<div class="yui-b">
            <div class="nav">

                    <div class="module">
                        <h4>Modules</h4>
                        <ul class="content">

                                <li class=""><a href="module_json.html">json</a></li>

                                <li class="selected"><a href="module_node.html">node</a></li>

                                <li class=""><a href="module_nodeextras.html">nodeextras</a></li>

                                <li class=""><a href="module_selector.html">selector</a></li>

                                <li class=""><a href="module_yui.html">yui</a></li>
                        </ul>
                    </div>

                    <div class="module">
                        <h4>Classes</h4>
                        <ul class="content">
                                <li class=""><a href="Doc.html">Doc</a></li>
                                <li class=""><a href="Node.html">Node</a></li>
                                <li class=""><a href="NodeList.html">NodeList</a></li>
                                <li class=""><a href="Win.html">Win</a></li>
                        </ul>
                    </div>

                    <div class="module">
                        <h4>Files</h4>
                        <ul class="content">        
                                <li class="selected"><a href="Node.js.html">Node.js</a></li>
                                <li class=""><a href="NodeExtras.js.html">NodeExtras.js</a></li>
                        </ul>
                    </div>





            </div>
		</div>
	</div>
	<div id="ft">
        <hr />
        Copyright &copy; 2008 Yahoo! Inc. All rights reserved.
	</div>
</div>
</body>
</html>
