<!doctype html>
<html>
<head>
    <title>Test Page</title>
    <link type="text/css" rel="stylesheet" href="/assets/dpSyntaxHighlighter.css">
    <link type="text/css" rel="stylesheet" href="../../../build/console/assets/skins/sam/console-filters.css">
    <style type="text/css">
.yui-table {
    display: inline;
    float: left;
    font-family: arial, sans-serif;
    margin: 2em;
}
.yui-table caption {
    font-weight: bold;
    color: #c60;
}
.yui-table table {
    border-collapse: collapse;
    border: 1px solid #ccc;
}
.yui-table thead {
    background: #684;
    color: #fff;
}
.yui-table thead th {
    padding: 3px 4px;
}
.yui-table tfoot {
    background: #ac8;
}
.yui-table tfoot td {
    padding: 3px 6px;
    font-weight: bold;
}
.yui-table tbody td {
    border: 1px solid #ccc;
    padding: 3px 6px;
}
.yui-table td+td {
    text-align: right;
}
.markup { 
    clear: both;
}
.yui-skin-sam #c .yui-console {
    position: relative;
    top: auto;
    right: auto;
}
#c {
    margin-bottom: 1em;
}
    </style>
</head>
<body class="yui-skin-sam">
<div class="markup">
<form action=''>
    <h3>Form used for field value extraction, stringification</h3>
    <input type="text" id="empty_text">
    <input type="text" id="text" value="text">
    <input type="radio" name="radio" id="unchecked_radio" value="unchecked">
    <input type="radio" name="radio" id="checked_radio" value="radio" checked="checked">
    <input type="checkbox" name="box" id="unchecked_box" value="unchecked">
    <input type="checkbox" name="box" id="checked_box" value="box" checked="checked">
    <textarea id="empty_textarea"></textarea>
    <textarea id="textarea">textarea</textarea>
    <select id="select">
        <option value="unselected">Unselected</option>
        <option value="selected" selected="selected">Selected</option>
    </select>
    <select id="multiple_select" multiple="multiple" size="3">
        <option value="unselected">Unselected</option>
        <option value="selected" selected="selected">Selected</option>
        <option value="selected also" selected="selected">Selected also</option>
    </select>
    <button id="button" type="button">content; no value</button>
    <button id="button_with_value" type="button" value="button value">content and value</button>
    <button id="button_submit" type="submit">content; no value</button>
    <button id="button_submit_with_value" type="submit" value="submit button value">content and value</button>
    <input type="button" id="input_button" value="input button">
    <input type="submit" id="input_submit" value="input submit">
    <input type="image" id="input_image" src="404.png" value="input image">
</form>
</div>

<script type="text/javascript" src="../../../build/yui/yui.js"></script>
<!--script type="text/javascript" src="../../../build/console/console-filters.js"></script-->
<script type="text/javascript">
YUI.add('table',function (Y) {

    function Table() {
        Table.superclass.constructor.apply(this,arguments);
    }

    Table.NAME = 'table';

    Table.ATTRS = {
        columns : {
            value : [],
            validator : Y.Lang.isArray
        },

        caption : {
            value : null,
            validator : function (v) {
                return Y.Lang.isString(v) || Y.Lang.isNull(v);
            }
        },

        data : {
            value : [],
            validator : Y.Lang.isArray
        },

        totals : {
            value : null,
            validator : function (v) {
                return Y.Lang.isArray(v) || Y.Lang.isNull(v);
            }
        }
    };

    Y.extend(Table, Y.Widget, {
        renderUI : function () {
            this._table = Y.Node.create(
                '<table>' +
                    this._captionHTML() +
                    this._theadHTML() +
                    this._tfootHTML() +
                    this._tbodyHTML() +
                '<table>');

            this.get('contentBox').appendChild(this._table);
        },

        _captionHTML : function () {
            var cap = this.get('caption');
            return cap ? '<caption>' + cap + '</caption>' : '';
        },

        _theadHTML : function () {
            return '<thead><tr><th>' +
                this.get('columns').join('</th><th>') +
                '</th></tr></thead>';
        },

        _tfootHTML : function () {
            var totals = this.get('totals'),
                cols = this.get('columns'),
                data = this.get('data'),
                html,total,i,len;

            if (totals) {
                html = '<tfoot><tr>';

                for (i = 0, len = cols.length; i < len; ++i) {
                    if (totals[i]) {
                        total = 0;
                        Y.Array.each(data, function (rec) {
                            total += +(rec[cols[i]]) || 0;
                        });
                        html += '<td>' + total + '</td>';
                    } else {
                        html += '<td></td>';
                    }
                }

                return html + '</tr></tfoot>';
            }

            return '';
        },

        _tbodyHTML : function () {
            var cols = this.get('columns'),
                data = this.get('data'),
                rows = [], r,
                i, len,
                j, jlen;

            for (i = 0, len = data.length; i < len; ++i) {
                r = '';
                for (j = 0, jlen = cols.length; j < jlen; ++j) {
                    r += '<td>' + data[i][cols[j]] + '</td>';
                }
                if (r) {
                    rows.push('<tr>' + r + '</tr>');
                }
            }

            return '<tbody>' + rows.join('') + '</tbody>';
        }
    });

    Y.Table = Table;

},'@VERSION@',{requires:['widget']});

YUI({
    base: '../../../build/',
    //filter: 'debug',
    //logInclude : { global: true },
    useBrowserConsole:false
}).use('event','table','json','profiler', 'io-base',function (Y) {

var P = Y.Profiler;

function normalizeProfilerData() {
    var raw = P.getFullReport(function (x) { return x.calls > 0; }),
        data = [], name, rpt, i, total;

    for (name in raw) {
        rpt = raw[name];

        total = 0;
        for (i = rpt.points.length - 1; i >=0 ; --i) {
            total += rpt.points[i];
        }

        data.push({
            fn : name.replace(/.*\./,''),
            min : rpt.min.toFixed(2),
            max : rpt.max.toFixed(2),
            avg : rpt.avg.toFixed(2),
            calls : rpt.calls,
            total : total.toFixed(2)
        });
    }

    return data;
}

function report(caption) {
    new Y.Table({
        caption : caption,
        columns : ['fn','calls','min','max','avg','total'],
        data : normalizeProfilerData(),
        totals : [false, true, false, false, false, true]
    }).render();

    P.clear();
}

/****************************************************************************/
/***********************  Testing area begins here **************************/
/****************************************************************************/
P.registerFunction('parse',Y.JSON);
P.registerFunction('stringify',Y.JSON);

Y.io('flickr.json', {on:{success: function (id,o) {
    var x = Y.JSON.parse(o.responseText);
    report("parse flickr.json");

    // Stringify
    Y.JSON.stringify(x);
    report("stringify flickr.json");
}}});

Y.io('bbc.json', {on:{success: function (id,o) {
    var x = Y.JSON.parse(o.responseText);
    report("parse bbc.json");

    // Stringify
    Y.JSON.stringify(x);
    report("stringify bbc.json");
}}});

function $(id) { return document.getElementById(id); }

Y.JSON.stringify({
    empty_text              : $('empty_text').value,
    text                    : $('text').value,
    unchecked_radio         : $('unchecked_radio').value,
    checked_radio           : $('checked_radio').value,
    unchecked_box           : $('unchecked_box').value,
    checked_box             : $('checked_box').value,
    empty_textarea          : $('empty_textarea').value,
    textarea                : $('textarea').value,
    select                  : $('select').value,
    multiple_select         : $('multiple_select').value,
    button                  : $('button').value,
    button_with_value       : $('button_with_value').value,
    button_submit           : $('button_submit').value,
    button_submit_with_value: $('button_submit_with_value').value,
    input_button            : $('input_button').value,
    input_submit            : $('input_submit').value,
    input_image             : $('input_image').value
});
report("stringify form data");

/*
Y.JSON.stringify({
    foo : [
        1,2,3,{
            foo : "FOO",
            baz : true
        }
    ],
    bar : [
        1,2,3,{
            foo : "FOO",
            baz : true
        }
    ],
    baz : true},["foo","baz"]);
report("stringify with whitelist");

Y.JSON.stringify({
    foo : [ 2, {
        bar : [ 4, {
            baz : [ 6, {
                "deep enough" : 7
            }]
        }]
    }]
},null,"Xo");
report("stringify with whitelist");

Y.JSON.parse(JSON_STRING, function (k,v) {
    switch (k) {
        case "alpha" : return "LOWER CASE";
        case "ALPHA" : return "upper case";
        case "true"  :
        case "false" :
        case "null"  : return undefined;
    }

    if (typeof v === 'number') {
        return -(Math.abs(v|0));
    }

    if (Y.Lang.isArray(v)) {
        v[99] = "NEW ITEM";
    }

    return v;
});
report("parse with reviver");

Y.JSON.stringify({
        num: 1,
        alpha: "abc",
        ignore: "me",
        change: "to a function",
        toUpper: true,
        obj: {
            nested_num: 50,
            undef: undefined,
            alpha: "abc"
        },
        arr: [1, 7, 2]
    }
    ,function (k,v) {
        var t = typeof v;

        if (k === 'change') {
            // this property should then be ignored
            return function () {};
        } else if (k === 'ignore') {
            // this property should then be ignored
            return undefined;
        } else if (t === 'number') {
            // undefined returned to arrays should become null
            return v % 7 ? v * 2 : undefined;

        // this refers to the object containing the key:value
        } else if (t === 'string' && (this.toUpper)) {
            // modify the object during stringification
            delete this.toUpper;
            return v.toUpperCase();
        } else {
            return v;
        }
    },'_');

report("stringify with replacer");
*/
});
</script>
<script type="text/javascript" src="/assets/dpSyntaxHighlighter.js"></script>
<script type="text/javascript" src="/assets/dpSyntaxHighlightExample.js"></script>
</body>
</html>
